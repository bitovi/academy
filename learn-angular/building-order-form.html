<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/angular/14-building-order-form/building-order-form.md
	@page learn-angular/building-order-form
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Building the Order Form 
">
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P9MQVJS');</script>
  <!-- End Google Tag Manager -->

  <title>Bitovi Academy - Binding Component Data</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9MQVJS"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget. We strongly suggest finishing learn-advanced-javascript prior to starting this course.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building a feature-rich Tic-Tac-Toe game in this beginner React guide. This hands-on course will introduce both fundamental and more advanced React concepts! By the end of this course, you will have mastered functional components, hooks, and component optimization.">
							Learn React
						</a>
						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-agile-program-management-with-jira.html"
							title="Learn how to build, maintain, and report on accurate multi-team plans with Jira.">
							Agile Program Management With Jira
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to move beyond writing code to be an excellent technology consultant!">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-ngrx.html"
							title="Learn how to manage state in an Angular application using NgRx.">
							Learn NgRx
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-graphql.html"
							title="Build a backend application for property rentals using Node JS, GraphQL and Apollo Server.         Learn about using ORMs like Mongoose and Prisma with a NoSQL Mongo database!
Write testcases testing created endpoints.">
							Learn Graphql
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a Node.js app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="why-angular.html"
							title="Discover why Angular is a great choice for modern web application development.">
							Why Angular?
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-our-first-app.html"
							title="Learn how to generate an Angular 17 application with its command line interface (CLI).">
							Generate an App
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-components.html"
							title="Learn how to create basic components in Angular and iterate through data using an Angular for loop.">
							Creating Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-pipes.html"
							title="Learn how to create a custom pipe in Angular that returns a modified version of a string.">
							Creating Pipes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="adding-routing.html"
							title="Learn how to add basic routing to components in an Angular application.">
							Adding Routing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-navigation.html"
							title="Learn how to create dynamic links with Angular that navigate to different parts of an application.">
							Creating Navigation
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="restaurant-service.html"
							title="Learn how to write an Angular service that gets data from the server.">
							Fetching Data with Services
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="pull-restaurant-data-into-view.html"
							title="Learn how to render API data into HTML with a view.">
							Rendering Data in Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="state-city-options.html"
							title="Learn how to create a Reactive Form with Angular. We will create a Reactive Form in the Restaurant component with city and state dropdown inputs.">
							Reactive Forms Data Binding
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="form-value-changes.html"
							title="Learn how to listen to form value changes with Angular.">
							Listening to Form Changes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="updating-service-params.html"
							title="Learn how to make a service take multiple parameters.">
							Multi-parameter Services
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="declarative-state.html"
							title="Modify Restaurants component to derive state via RxJS streams">
							Optional: Declarative State
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="writing-unit-tests.html"
							title="Write a unit test for a service in Angular.">
							Writing Unit Tests
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="nested-routes.html"
							title="Creating nested restaurant routes.">
							Creating Nested Routes
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="building-order-form.html"
							title="Building the Order Form">
							Binding Component Data
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-directive.html"
							title="Learn how to create Directives in Angular that can change the appearance or behavior of DOM Elements.">
							Creating Directive
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-service.html"
							title="Writing the Order Service">
							Order Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-history-component.html"
							title="Writing the Order History Component">
							Order History Component
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="item-total-pipe.html"
							title="Write an Item Total Pipe to help manage item total calculation across our application.">
							Item Total Pipe
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="real-time-connection.html"
							title="Updating Order History View with Real Time Connection">
							Real Time Connections
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="deploy-app.html"
							title="Deploying App">
							Deploy App
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../advanced-typescript.html"
							title="This is the second course in the TypeScript series. By the end, you will be comfortable with any types you come across and possess the knowledge to create your own advanced types. The only prerequisite is the first course in the TypeScript series found here.">
							Advanced TypeScript
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Binding Component Data <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Building the Order Form</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2>Overview</h2>
<p>In this part, we will:</p>
<ul>
<li>Create a new order component</li>
<li>Get the restaurant from route params</li>
<li>Add new route for ordering from a restaurant</li>
<li>Import a third-party lib</li>
<li>Create a custom component to handle item selection</li>
</ul>
<h2>Creating an order form component</h2>
<p>Our order form is how we can create new orders. We’ll use a reactive form to get data from the users, use a custom validation function to make sure at least one item has been selected, and calculate the order total every time a new item is selected or unselected.</p>
<h2>Problem 1: Create a new route for ordering from a restaurant</h2>
<h2>P1: What you need to know</h2>
<ul>
<li>How to create new components
<pre><code class="language-bash">ng g component order
</code></pre></li>
<li>You’ve created routes before! You got this!</li>
</ul>
<h2>P1: Technical requirements</h2>
<p>Create a new <code>order</code> component, and create a route for our new component! The path should be <code>/restaurants/{{slug}}/order</code>.</p>
<h2>P1: How to verify your solution is correct</h2>
<p>When you navigate to the <code>/order</code> path from a restaurant detail page you should see your new order component.</p>
<p>✏️ Update the spec file <strong>src/app/app.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { Location } from '@angular/common';
import { HttpClientModule } from '@angular/common/http';
import { NO_ERRORS_SCHEMA } from '@angular/core';
import {
  ComponentFixture,
  fakeAsync,
  flush,
  TestBed,
  tick,
} from '@angular/core/testing';
import { ReactiveFormsModule } from '@angular/forms';
import { Router } from '@angular/router';
import { of } from 'rxjs';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { HomeComponent } from './home/home.component';
import { ImageUrlPipe } from './image-url.pipe';
import { OrderComponent } from './order/order.component';
import { DetailComponent } from './restaurant/detail/detail.component';
import { RestaurantComponent } from './restaurant/restaurant.component';
import { RestaurantService } from './restaurant/restaurant.service';

class MockRestaurantService {
  getRestaurants() {
    return of({
      data: [
        {
          name: 'Poutine Palace',
          slug: 'poutine-palace',
          images: {
            thumbnail:
              'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
            owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
            banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
          },
          menu: {
            lunch: [
              {
                name: 'Crab Pancakes with Sorrel Syrup',
                price: 35.99,
              },
              {
                name: 'Steamed Mussels',
                price: 21.99,
              },
              {
                name: 'Spinach Fennel Watercress Ravioli',
                price: 35.99,
              },
            ],
            dinner: [
              {
                name: 'Gunthorp Chicken',
                price: 21.99,
              },
              {
                name: 'Herring in Lavender Dill Reduction',
                price: 45.99,
              },
              {
                name: 'Chicken with Tomato Carrot Chutney Sauce',
                price: 45.99,
              },
            ],
          },
          address: {
            street: '230 W Kinzie Street',
            city: 'Green Bay',
            state: 'WI',
            zip: '53205',
          },
          _id: '3ZOZyTY1LH26LnVw',
        },
        {
          name: 'Cheese Curd City',
          slug: 'cheese-curd-city',
          images: {
            thumbnail:
              'node_modules/place-my-order-assets/images/2-thumbnail.jpg',
            owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
            banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
          },
          menu: {
            lunch: [
              {
                name: 'Ricotta Gnocchi',
                price: 15.99,
              },
              {
                name: 'Gunthorp Chicken',
                price: 21.99,
              },
              {
                name: 'Garlic Fries',
                price: 15.99,
              },
            ],
            dinner: [
              {
                name: 'Herring in Lavender Dill Reduction',
                price: 45.99,
              },
              {
                name: 'Truffle Noodles',
                price: 14.99,
              },
              {
                name: 'Charred Octopus',
                price: 25.99,
              },
            ],
          },
          address: {
            street: '2451 W Washburne Ave',
            city: 'Green Bay',
            state: 'WI',
            zip: '53295',
          },
          _id: 'Ar0qBJHxM3ecOhcr',
        },
      ],
    });
  }

  getStates() {
    return of({
      data: [
        { short: 'MO', name: 'Missouri' },
        { short: 'CA  ', name: 'California' },
        { short: 'MI', name: 'Michigan' },
      ],
    });
  }

  getCities(state: string) {
    return of({
      data: [
        { name: 'Sacramento', state: 'CA' },
        { name: 'Oakland', state: 'CA' },
      ],
    });
  }

  getRestaurant(slug: string) {
    return of({
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    });
  }
}

describe('AppComponent', () =&gt; {
  let fixture: ComponentFixture&lt;AppComponent&gt;;
  let location: Location;
  let router: Router;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      imports: [AppRoutingModule, HttpClientModule, ReactiveFormsModule],
      declarations: [
        AppComponent,
        HomeComponent,
        RestaurantComponent,
        ImageUrlPipe,
        DetailComponent,
        OrderComponent,
      ],
      providers: [
        { provide: RestaurantService, useClass: MockRestaurantService },
      ],
      schemas: [NO_ERRORS_SCHEMA],
    })
      .overrideComponent(RestaurantComponent, {
        set: { template: '&lt;p&gt;I am a fake restaurant component&lt;/p&gt;' },
      })
      .compileComponents();

    fixture = TestBed.createComponent(AppComponent);
    location = TestBed.inject(Location);
    router = TestBed.inject(Router);
  });

  it('should create the app', () =&gt; {
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it(`should have as title 'place-my-order'`, () =&gt; {
    const app = fixture.componentInstance;
    expect(app.title).toEqual('place-my-order');
  });

  it('should render title in a h1 tag', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h1')?.textContent).toContain(
      'place-my-order.com'
    );
  });

  it('should render the HomeComponent with router navigates to &quot;/&quot; path', fakeAsync(() =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    router.navigate(['']).then(() =&gt; {
      expect(location.path()).toBe('');
      expect(compiled.querySelector('pmo-home')).not.toBe(null);
    });
  }));

  it('should render the RestaurantsComponent with router navigates to &quot;/restaurants&quot; path', fakeAsync(() =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    router.navigate(['restaurants']).then(() =&gt; {
      expect(location.path()).toBe('/restaurants');
      expect(compiled.querySelector('pmo-restaurant')).not.toBe(null);
    });
  }));

  it('should render the DetailComponent with router navigates to &quot;/restaurants/slug&quot; path', fakeAsync(() =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    router.navigate(['restaurants/crab-shack']).then(() =&gt; {
      expect(location.path()).toBe('/restaurants/crab-shack');
      expect(compiled.querySelector('pmo-detail')).not.toBe(null);
    });
  }));

  it('should render the OrderComponent with router navigates to &quot;/restaurants/slug/order&quot; path', fakeAsync(() =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    router.navigate(['restaurants/crab-shack/order']).then(() =&gt; {
      expect(location.path()).toBe('/restaurants/crab-shack/order');
      expect(compiled.querySelector('pmo-order')).not.toBe(null);
    });
  }));

  it('should have the home navigation link href set to &quot;/&quot;', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const homeLink = compiled.querySelector('li a');
    const href = homeLink?.getAttribute('href');
    expect(href).toEqual('/');
  });

  it('should have the restaurants navigation link href set to &quot;/restaurants&quot;', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const restaurantsLink = compiled.querySelector('li:nth-child(2) a');
    const href = restaurantsLink?.getAttribute('href');
    expect(href).toEqual('/restaurants');
  });

  it('should make the home navigation link class active when the router navigates to &quot;/&quot; path', fakeAsync(() =&gt; {
    const compiled = fixture.nativeElement as HTMLElement;
    router.navigate(['']);
    fixture.detectChanges();
    tick();

    const homeLinkLi = compiled.querySelector('li');
    expect(homeLinkLi?.classList).toContain('active');
    expect(compiled.querySelectorAll('.active').length).toBe(1);
    flush();
  }));

  it('should make the restaurants navigation link class active when the router navigates to &quot;/restaurants&quot; path', fakeAsync(() =&gt; {
    const compiled = fixture.nativeElement as HTMLElement;
    router.navigate(['restaurants']);
    fixture.detectChanges();
    tick();
    fixture.detectChanges();

    expect(location.path()).toBe('/restaurants');
    const restaurantsLinkLi = compiled.querySelector('li:nth-child(2)');
    expect(restaurantsLinkLi?.classList).toContain('active');
    expect(compiled.querySelectorAll('.active').length).toBe(1);
    flush();
  }));
});

</code></pre>
 <div line-highlight="18,208,270,273-276,308,312,319,only"></div>
<blockquote>
<p>If you’ve implemented the solution correctly, when you run <code>npm run test</code> all tests will pass!</p>
</blockquote>
<h2>P1: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/app-routing.module.ts</strong></p>
<pre><code class="language-ts">import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { HomeComponent } from './home/home.component';
import { OrderComponent } from './order/order.component';
import { DetailComponent } from './restaurant/detail/detail.component';
import { RestaurantComponent } from './restaurant/restaurant.component';

const routes: Routes = [
  {
    path: '',
    component: HomeComponent,
  },
  {
    path: 'restaurants',
    component: RestaurantComponent,
  },
  {
    path: 'restaurants/:slug',
    component: DetailComponent,
  },
  {
    path: 'restaurants/:slug/order',
    component: OrderComponent,
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}

</code></pre>
 <div line-highlight="4,21-24,only"></div>
<p></details></p>
<h2>Problem 2: Build out the order component</h2>
<p>We’ve covered a few concepts, like how to get the slug from the route, how to get a restaurant, how to create a form and subscribe to its changes. Let’s practice those concepts.</p>
<p>We’ve provided some starting code to get through this section to help you get the restaurant based on the route slug, create a new reactive form to collect order information, and update the order total whenever the <code>items</code> FormControl value changes.</p>
<h2>P2: What you need to know</h2>
<ul>
<li><p>How to get the restaurant from the route slug (you learned this in previous sections! ✔️)</p></li>
<li><p>Create a reactive form (you learned this in previous sections! ✔️)</p></li>
<li><p>Listen to form value changes (you learned this in previous sections! ✔️)</p></li>
<li><p>Add validation:</p>
<p>This time, our form will require <a href="https://angular.io/guide/form-validation#reactive-form-validation">validation</a>. Here’s an example of a form with form controls with different validation, and one whose value is set to an array.</p></li>
</ul>
<pre><code class="language-typescript">function validateLessThan(maxValue: number): ValidatorFn {
  return (control: AbstractControl): ValidationErrors | null =&gt; {
    if (control.value &lt; maxValue) {
      return null;
    }
    return { belowMax: { valid: false } };
  };
}

this.myValidatingForm = this.formBuilder.group({
  name: [null, Validators.required],
  age: [null, validateLessThan(18)],
  hobbies: [[]]
});
</code></pre>
<h2>P2: Technical requirements</h2>
<p>The order form component needs to get the restaurant from the route slug, and needs a reactive form to collect <code>restaurant</code>, <code>name</code>, <code>address</code>, <code>phone</code>, and <code>items</code>, and a way to update the order total when the items form control changes.</p>
<h2>P2: Setup</h2>
<p>✏️ Update the <strong>src/app/order/order.component.html</strong> file to be:</p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;&lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;ng-container *ngIf=&quot;restaurant?.menu?.lunch&quot;&gt;
        &lt;h4&gt;Lunch Menu&lt;/h4&gt;
        &lt;ul class=&quot;list-group&quot;&gt;
          &lt;li
            class=&quot;list-group-item&quot;
            *ngFor=&quot;let item of restaurant.menu.lunch&quot;
          &gt;
            &lt;label&gt;
              &lt;input type=&quot;checkbox&quot; formControlName=&quot;items&quot; /&gt;
              {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
            &lt;/label&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/ng-container&gt;
      &lt;ng-container *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
        &lt;h4&gt;Dinner Menu&lt;/h4&gt;
        &lt;ul class=&quot;list-group&quot;&gt;
          &lt;li
            class=&quot;list-group-item&quot;
            *ngFor=&quot;let item of restaurant.menu.dinner&quot;
          &gt;
            &lt;label&gt;
              &lt;input type=&quot;checkbox&quot; formControlName=&quot;items&quot; /&gt;
              {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
            &lt;/label&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/ng-container&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; formControlName=&quot;phone&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
<p>✏️ Update the <strong>src/app/order/order.component.ts</strong> file to be:</p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import {
  AbstractControl,
  FormBuilder,
  FormControl,
  FormGroup,
  ValidationErrors,
  ValidatorFn,
} from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { Restaurant } from '../restaurant/restaurant';
import { RestaurantService } from '../restaurant/restaurant.service';

export interface Item {
  name: string;
  price: number;
}

export interface OrderForm {
  restaurant: FormControl&lt;string&gt;;
  name: FormControl&lt;string&gt;;
  address: FormControl&lt;string&gt;;
  phone: FormControl&lt;string&gt;;
  items: FormControl&lt;Item[]&gt;;
}

// CUSTOM VALIDATION FUNCTION TO ENSURE THAT THE ITEMS FORM VALUE CONTAINS AT LEAST ONE ITEM.
function minLengthArray(min: number): ValidatorFn {
  return (c: AbstractControl): ValidationErrors | null =&gt; {
    if (c.value.length &gt;= min) {
      return null;
    }
    return { minLengthArray: { valid: false } };
  };
}

@Component({
  selector: 'pmo-order',
  templateUrl: './order.component.html',
  styleUrl: './order.component.less',
})
export class OrderComponent implements OnInit, OnDestroy {
  orderForm?: FormGroup&lt;OrderForm&gt;;
  restaurant?: Restaurant;
  isLoading = true;
  orderTotal = 0.0;
  completedOrder: any;
  orderComplete = false;
  orderProcessing = false;
  private onDestroy$ = new Subject&lt;void&gt;();

  constructor(
    private route: ActivatedRoute,
    private restaurantService: RestaurantService,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    // GET THE RESTAURANT FROM THE ROUTE SLUG
  }

  ngOnDestroy(): void {}

  createOrderForm(): void {
    // CREATE AN ORDER FORM TO COLLECT: RESTAURANT ID, NAME, ADDRESS, PHONE, AND ITEMS
    // ITEMS SHOULD USE THE CUSTOM MINLENGTH ARRAY VALIDATION
    this.orderForm = this.formBuilder.nonNullable.group({});
    this.onChanges();
  }

  onChanges(): void {
    // SUBSCRIBE TO THE ITEMS FORMCONTROL CHANGE TO CALCULATE A NEW TOTAL
  }

  onSubmit(): void {}

  startNewOrder(): void {
    this.orderComplete = false;
    this.completedOrder = undefined;
    // CLEAR THE ORDER FORM
    this.createOrderForm();
  }
}

</code></pre>
<h2>P2: How to verify your solution is correct</h2>
<p>✏️ Update the order spec file <strong>src/app/order/order.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ReactiveFormsModule } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant/restaurant.service';
import { OrderComponent } from './order.component';

class MockRestaurantService {
  getRestaurant(slug: string) {
    return of({
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    });
  }
}

const MockActivatedRoute = {
  snapshot: {
    paramMap: {
      get() {
        return 'poutine-palace';
      },
    },
  },
};

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [OrderComponent],
      imports: [ReactiveFormsModule, RouterTestingModule],
      providers: [
        {
          provide: RestaurantService,
          useClass: MockRestaurantService,
        },
        {
          provide: ActivatedRoute,
          useValue: MockActivatedRoute,
        },
      ],
    }).compileComponents();
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should get a restaurant based on route slug', () =&gt; {
    const mockRestaurant = {
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    };
    expect(fixture.componentInstance.restaurant).toEqual(mockRestaurant);
  });

  it('should have an orderForm formGroup', () =&gt; {
    expect(
      fixture.componentInstance.orderForm?.controls['restaurant']
    ).toBeTruthy();
    expect(
      fixture.componentInstance.orderForm?.controls['address']
    ).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['phone']).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['items']).toBeTruthy();
  });

  it('should have a validator on items formControl', () =&gt; {
    const itemFormControl =
      fixture.componentInstance.orderForm?.controls['items'];
    expect(itemFormControl?.valid).toEqual(false);
  });
});

</code></pre>
<div line-highlight='101-167, only'></div>
<h2>P2: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/order.component.ts</strong></p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import {
  AbstractControl,
  FormBuilder,
  FormControl,
  FormGroup,
  ValidationErrors,
  ValidatorFn,
  Validators,
} from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { Restaurant } from '../restaurant/restaurant';
import { RestaurantService } from '../restaurant/restaurant.service';

export interface Item {
  name: string;
  price: number;
}

export interface OrderForm {
  restaurant: FormControl&lt;string&gt;;
  name: FormControl&lt;string&gt;;
  address: FormControl&lt;string&gt;;
  phone: FormControl&lt;string&gt;;
  items: FormControl&lt;Item[]&gt;;
}

// CUSTOM VALIDATION FUNCTION TO ENSURE THAT THE ITEMS FORM VALUE CONTAINS AT LEAST ONE ITEM.
function minLengthArray(min: number): ValidatorFn {
  return (c: AbstractControl): ValidationErrors | null =&gt; {
    if (c.value.length &gt;= min) {
      return null;
    }
    return { minLengthArray: { valid: false } };
  };
}

@Component({
  selector: 'pmo-order',
  templateUrl: './order.component.html',
  styleUrl: './order.component.less',
})
export class OrderComponent implements OnInit, OnDestroy {
  orderForm?: FormGroup&lt;OrderForm&gt;;
  restaurant?: Restaurant;
  isLoading = true;
  orderTotal = 0.0;
  completedOrder: any;
  orderComplete = false;
  orderProcessing = false;
  private onDestroy$ = new Subject&lt;void&gt;();

  constructor(
    private route: ActivatedRoute,
    private restaurantService: RestaurantService,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    // GETTING THE RESTAURANT FROM THE ROUTE SLUG
    const slug = this.route.snapshot.paramMap.get('slug');

    if (slug) {
      this.restaurantService
        .getRestaurant(slug)
        .pipe(takeUntil(this.onDestroy$))
        .subscribe((data: Restaurant) =&gt; {
          this.restaurant = data;
          this.isLoading = false;
          this.createOrderForm();
        });
    }
  }

  ngOnDestroy(): void {
    this.onDestroy$.next();
    this.onDestroy$.complete();
  }

  createOrderForm(): void {
    this.orderForm = this.formBuilder.nonNullable.group({
      restaurant: [this.restaurant?._id ?? '', Validators.required],
      name: ['', Validators.required],
      address: ['', Validators.required],
      phone: ['', Validators.required],
      // PASSING OUR CUSTOM VALIDATION FUNCTION TO THIS FORM CONTROL
      items: [[] as Item[], minLengthArray(1)],
    });
    this.onChanges();
  }

  onChanges(): void {
    // WHEN THE ITEMS CHANGE WE WANT TO CALCULATE A NEW TOTAL
    this.orderForm?.controls.items.valueChanges
      .pipe(takeUntil(this.onDestroy$))
      .subscribe((value) =&gt; {
        let total = 0.0;
        if (value.length) {
          for (const item of value) {
            total += item.price;
          }
          this.orderTotal = Math.round(total * 100) / 100;
        } else {
          this.orderTotal = total;
        }
      });
  }

  onSubmit(): void {}

  startNewOrder(): void {
    this.orderComplete = false;
    this.completedOrder = undefined;
    // CLEAR THE ORDER FORM
    this.createOrderForm();
  }
}

</code></pre>
 <div line-highlight="9,62-63,65-74,77-79,83-90,95-108,118,only"></div>
<p></details></p>
<h2>Importing third-party plugins</h2>
<p>In our markup we would like to display our lunch and dinner menus in tabs. Instead of creating our own library, let’s import a well supported one, <a href="https://valor-software.com/ngx-bootstrap/#/documentation#getting-started">ngx-bootstrap</a>:</p>
<p>✏️ Run:</p>
<pre><code class="language-bash">ng add ngx-bootstrap
</code></pre>
<p>The <code>ng add</code> command is a convenient way to import third-party libs that will update <code>angular.json</code> and <code>package.json</code> with any changes we need.</p>
<p>✏️ Update <strong>src/app/app.module.ts</strong>. Once you’re done, don’t forget to restart the server!</p>
<pre><code class="language-ts">import { HttpClientModule } from '@angular/common/http';
import { NgModule } from '@angular/core';
import { ReactiveFormsModule } from '@angular/forms';
import { BrowserModule } from '@angular/platform-browser';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
import { TabsModule } from 'ngx-bootstrap/tabs';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { HomeComponent } from './home/home.component';
import { RestaurantComponent } from './restaurant/restaurant.component';
import { ImageUrlPipe } from './image-url.pipe';
import { DetailComponent } from './restaurant/detail/detail.component';
import { OrderComponent } from './order/order.component';

@NgModule({
  declarations: [
    AppComponent,
    HomeComponent,
    RestaurantComponent,
    ImageUrlPipe,
    DetailComponent,
    OrderComponent
  ],
  imports: [
    BrowserModule,
    AppRoutingModule,
    HttpClientModule,
    ReactiveFormsModule,
    BrowserAnimationsModule,
    TabsModule.forRoot()
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }

</code></pre>
<div line-highlight='5, 6, 29, 30, only'></div>
<p>Now let’s add the markup to our order component implementing the tabs widget.</p>
<p>✏️ Update <strong>src/app/order/order.component.html</strong></p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;&lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot; *ngIf=&quot;restaurant.menu.lunch&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;li
              class=&quot;list-group-item&quot;
              *ngFor=&quot;let item of restaurant?.menu?.lunch&quot;
            &gt;
              &lt;label&gt;
                &lt;input type=&quot;checkbox&quot; formControlName=&quot;items&quot; /&gt;
                {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
              &lt;/label&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner Menu&quot; *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;li
              class=&quot;list-group-item&quot;
              *ngFor=&quot;let item of restaurant.menu.dinner&quot;
            &gt;
              &lt;label&gt;
                &lt;input type=&quot;checkbox&quot; formControlName=&quot;items&quot; /&gt;
                {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
              &lt;/label&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; formControlName=&quot;phone&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
 <div line-highlight="10-37,only"></div>
<p>Now when we view the order form of our route, we’ll see a nice form and tabs for lunch and dinner menu options.</p>
<p><img src="../static/img/angular/pmo-tabs-working.gif" alt="Place My Order App tabs" title="Place My Order App tabs" /></p>
<h2>Problem 3: Create a <code>menu-items</code> component</h2>
<p>We’re going to build another component to use in our form to handle selecting order items. We use data-binding to pass data between components. We’ll use the <code>@Input()</code> to get our list of items from the restaurant to display in our child component, and eventually hook it into our Reactive Form using the <code>formControlName</code> attribute as shown below.</p>
<pre><code class="language-html">&lt;pmo-menu-items
  [data]=&quot;restaurant.menu.lunch&quot;
  formControlName=&quot;items&quot;
&gt;&lt;/pmo-menu-items&gt;
</code></pre>
<h2>P3: What you need to know</h2>
<h2>Component interaction</h2>
<p>Components in Angular can pass data back and forth to each other through the use of <a href="https://angular.io/api/core/Input">@Input</a> and <a href="https://angular.io/api/core/Output">@Output</a> decorations.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
// app.js
const { Component, VERSION, Input } = ng.core;

@Component({
  selector: 'my-child',
  template: `
    My parent’s name is {{parentName}}
  `
})
class ChildComponent {
  @Input() parentName: string;
  constructor() {
  }
}

@Component({
  selector: 'my-app',
  template: `
    &lt;my-child parentName=&quot;Bob&quot;&gt;&lt;/my-child&gt;

    &lt;my-child [parentName]=&quot;momName&quot;&gt;&lt;/my-child&gt;
  `
})
class AppComponent {
  momName = 'Sandy';

  constructor() {
  }
}

// main.js
const { BrowserModule } = ng.platformBrowser;
const { NgModule } = ng.core;
const { CommonModule } = ng.common;

@NgModule({
  imports: [
    BrowserModule,
    CommonModule,
  ],
  declarations: [AppComponent, ChildComponent],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='17,21,29,31,35,only'></div>
<ul>
<li>How to use *ngFor (you learned this in previous sections! ✔️)</li>
<li>How to use @Input to pass properties (you learned this in the section above! ✔️)</li>
</ul>
<h2>P3: Setup</h2>
<p>Create the new menu-items component inside the order component folder</p>
<p>✏️ Run:</p>
<pre><code class="language-bash">ng g component order/menu-items
</code></pre>
<p>✏️ Update <strong>src/app/order/menu-items/menu-items.component.html</strong></p>
<pre><code class="language-html">&lt;!--  Iterate over items and render the markup below for each item --&gt;
&lt;li class=&quot;list-group-item&quot;&gt;
  &lt;label&gt;
    &lt;input type=&quot;checkbox&quot; /&gt;
    ITEM_NAME &lt;span class=&quot;badge&quot;&gt;$ ITEM_PRICE&lt;/span&gt;
  &lt;/label&gt;
&lt;/li&gt;
</code></pre>
<p>Go ahead and put your new component in the order component.</p>
<p>✏️ Update <strong>src/app/order/order.component.html</strong></p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;&lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot; *ngIf=&quot;restaurant.menu.lunch&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items&gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner Menu&quot; *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items&gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; formControlName=&quot;phone&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
 <div line-highlight="13,18,only"></div>
<h2>P3: How to verify your solution is correct</h2>
<p>✏️ Update the order spec file <strong>src/app/order/order.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { NO_ERRORS_SCHEMA } from '@angular/core';
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ReactiveFormsModule } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant/restaurant.service';
import { OrderComponent } from './order.component';

class MockRestaurantService {
  getRestaurant(slug: string) {
    return of({
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    });
  }
}

const MockActivatedRoute = {
  snapshot: {
    paramMap: {
      get() {
        return 'poutine-palace';
      },
    },
  },
};

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [OrderComponent],
      imports: [ReactiveFormsModule, RouterTestingModule],
      providers: [
        {
          provide: RestaurantService,
          useClass: MockRestaurantService,
        },
        {
          provide: ActivatedRoute,
          useValue: MockActivatedRoute,
        },
      ],
      schemas: [NO_ERRORS_SCHEMA],
    }).compileComponents();
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should get a restaurant based on route slug', () =&gt; {
    const mockRestaurant = {
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    };
    expect(fixture.componentInstance.restaurant).toEqual(mockRestaurant);
  });

  it('should have an orderForm formGroup', () =&gt; {
    expect(
      fixture.componentInstance.orderForm?.controls['restaurant']
    ).toBeTruthy();
    expect(
      fixture.componentInstance.orderForm?.controls['address']
    ).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['phone']).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['items']).toBeTruthy();
  });

  it('should have a validator on items formControl', () =&gt; {
    const itemFormControl =
      fixture.componentInstance.orderForm?.controls['items'];
    expect(itemFormControl?.valid).toEqual(false);
  });
});

</code></pre>
 <div line-highlight="1,89,only"></div>
<p>✏️ Update the menu-items spec file <strong>src/app/order/menu-items/menu-items.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { ComponentFixture, TestBed } from '@angular/core/testing';

import { MenuItemsComponent } from './menu-items.component';

describe('MenuItemsComponent', () =&gt; {
  let component: MenuItemsComponent;
  let fixture: ComponentFixture&lt;MenuItemsComponent&gt;;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [MenuItemsComponent],
    }).compileComponents();
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(MenuItemsComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should display a list of inputs', () =&gt; {
    fixture.componentInstance.items = [
      { name: 'Charred Octopus', price: 25.99 },
      { name: 'Steamed Mussels', price: 21.99 },
      { name: 'Ricotta Gnocchi', price: 15.99 },
    ];
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement as HTMLElement;
    const itemLabels = compiled.getElementsByTagName('label');
    expect(itemLabels.length).toEqual(3);
  });
});

</code></pre>
<div line-highlight='25-36, only'></div>
<h2>P3: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/menu-items.component.html</strong></p>
<pre><code class="language-html">&lt;li class=&quot;list-group-item&quot; *ngFor=&quot;let item of items&quot;&gt;
  &lt;label&gt;
    &lt;input type=&quot;checkbox&quot; /&gt;
    {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
  &lt;/label&gt;
&lt;/li&gt;

</code></pre>
<div line-highlight='1-7, only'></div>
<p>✏️ Update <strong>src/app/order/menu-items.component.ts</strong></p>
<pre><code class="language-ts">import { Component, Input } from '@angular/core';
import { Item } from '../order.component';

@Component({
  selector: 'pmo-menu-items',
  templateUrl: './menu-items.component.html',
  styleUrl: './menu-items.component.less',
})
export class MenuItemsComponent {
  @Input() items: Item[] = [];
}

</code></pre>
<p>✏️ Update <strong>src/app/order/order.component.html</strong></p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;&lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot; *ngIf=&quot;restaurant.menu.lunch&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items [items]=&quot;restaurant.menu.lunch&quot;&gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner Menu&quot; *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items [items]=&quot;restaurant.menu.dinner&quot;&gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; formControlName=&quot;phone&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
 <div line-highlight="13,18,only"></div>
<p></details></p>
<h2>Problem 4: Attaching event handlers to item checkboxes</h2>
<p>Next, we want to know when a checkbox has been checked or unchecked, and update an array called <code>selectedItems</code> containing all checked items.</p>
<h2>P4: What you need to know</h2>
<h2>Event handlers in Angular</h2>
<p>Event binding in Angular follows a simple pattern - the event name in parenthesis and a function to call in quotes on the other side of an equal sign. <code>(event)=&quot;functionToCall()&quot;</code>. Any parameter(s) can be passed to the event function, but to capture the event itself use the parameter <code>$event</code></p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { ReactiveFormsModule, FormControl } = ng.forms;

@Component({
  selector: 'my-app',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;

    &lt;button (click)=&quot;willCallOnClick()&quot;&gt;Click me!&lt;/button&gt;
    {{ clickMessage }}
    &lt;button (click)=&quot;willCallWithParam(clickMessage)&quot;&gt;log click message&lt;/button&gt;
    &lt;p&gt;
      Value: {{ name.value }}
    &lt;/p&gt;
    &lt;label&gt;
      Name:
      &lt;input type=&quot;text&quot; [formControl]=&quot;name&quot; (change)=&quot;willCallOnBlur($event)&quot;&gt;
    &lt;/label&gt;
  `
})
class AppComponent {
  name = new FormControl('');

  constructor() {}

  willCallOnClick(): void {
    this.clickMessage = 'You are my hero!';
  }

  willCallWithParam(message: string): void {
    console.info(message + ' from my 1st click')
  }

  willCallOnBlur(event): void {
    console.info('value', event.target.value);
  }
}

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    CommonModule,
    ReactiveFormsModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='24,26,32,41-31,45-47,49-51,only'></div>
<h2>P4: Technical requirements</h2>
<p>Create a function in the <code>MenuItemsComponent</code> called <code>updateItems</code> that fires whenever a checkbox is checked and takes a parameter of the item that has been checked. In the <code>updateItems</code> function use the following code to update the <code>selectedItems</code> array:</p>
<pre><code class="language-typescript">let index = this.selectedItems.indexOf(item);
if (index &gt; -1) {
  this.selectedItems.splice(index, 1);
} else {
  this.selectedItems.push(item);
}
</code></pre>
<h2>P4: How to verify your solution is correct</h2>
<p>✏️ Update the menu-items spec file <strong>src/app/order/menu-items/menu-items.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { ComponentFixture, TestBed } from '@angular/core/testing';

import { MenuItemsComponent } from './menu-items.component';

describe('MenuItemsComponent', () =&gt; {
  let component: MenuItemsComponent;
  let fixture: ComponentFixture&lt;MenuItemsComponent&gt;;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [MenuItemsComponent],
    }).compileComponents();
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(MenuItemsComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should display a list of inputs', () =&gt; {
    fixture.componentInstance.items = [
      { name: 'Charred Octopus', price: 25.99 },
      { name: 'Steamed Mussels', price: 21.99 },
      { name: 'Ricotta Gnocchi', price: 15.99 },
    ];
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement as HTMLElement;
    const itemLabels = compiled.getElementsByTagName('label');
    expect(itemLabels.length).toEqual(3);
  });

  it('should call an updateItems function when a checkbox is selected or unselected', () =&gt; {
    fixture.componentInstance.items = [
      { name: 'Charred Octopus', price: 25.99 },
      { name: 'Steamed Mussels', price: 21.99 },
      { name: 'Ricotta Gnocchi', price: 15.99 },
    ];
    fixture.detectChanges();
    const changeSpy = spyOn(fixture.componentInstance, 'updateItems');
    const compiled = fixture.debugElement.nativeElement;
    const input = compiled.getElementsByTagName('input')[0];
    input.click();
    fixture.detectChanges();
    expect(changeSpy).toHaveBeenCalled();
  });
});

</code></pre>
 <div line-highlight="37-50,only"></div>
<h2>P4: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/menu-items/menu-items.component.html</strong></p>
<pre><code class="language-html">&lt;li class=&quot;list-group-item&quot; *ngFor=&quot;let item of items&quot;&gt;
  &lt;label&gt;
    &lt;input type=&quot;checkbox&quot; (change)=&quot;updateItems(item)&quot; /&gt;
    {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
  &lt;/label&gt;
&lt;/li&gt;

</code></pre>
 <div line-highlight="3,only"></div>
<p>✏️ Update <strong>src/app/order/menu-items/menu-items.component.ts</strong></p>
<pre><code class="language-ts">import { Component, Input } from '@angular/core';
import { Item } from '../order.component';

@Component({
  selector: 'pmo-menu-items',
  templateUrl: './menu-items.component.html',
  styleUrl: './menu-items.component.less',
})
export class MenuItemsComponent {
  @Input() items: Item[] = [];
  selectedItems: Item[] = [];

  updateItems(item: Item): void {
    const index = this.selectedItems.indexOf(item);
    if (index &gt; -1) {
      this.selectedItems.splice(index, 1);
    } else {
      this.selectedItems.push(item);
    }
  }
}

</code></pre>
 <div line-highlight="11,13-20,only"></div>
<p></details></p>
<h2>Problem 5: Update <code>OrderFormComponent</code> with the <code>selectedItems</code> array from <code>MenuItemsComponent</code></h2>
<p>Now we want to let the form know what the selected items are as they change so we can update the order total accordingly.</p>
<h2>P5: What you need to know</h2>
<h2>Emitting Data to Parent Components</h2>
<p>To pass data to parent components in Angular, the <a href="https://angular.io/api/core/EventEmitter">EventEmitter</a> class is used in combination with the <a href="https://angular.io/api/core/Output">Output decorator</a>. The Output decorator marks a property to be listened to during change detection, and we call the <code>emit</code> method to broadcast the property’s new value.</p>
<p>The parent component is listening for a change on the child component’s property and calls a function on that change that takes a parameter of the updated value.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;app-parent&gt;&lt;/app-parent&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Input, Output, EventEmitter } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { ReactiveFormsModule, FormControl } = ng.forms;

@Component({
  selector: 'app-parent',
  styles: [ `
    :host {
      border: solid 2px deeppink;
      display: block;
      overflow: hidden;
      padding: 2em;
    }`
  ],
  template: `
    &lt;p&gt;Parent component!&lt;/p&gt;
    &lt;p&gt;Message from child: {{ message }}&lt;/p&gt;
    &lt;child-component (sendMessage)=&quot;getMessage($event)&quot;&gt;&lt;/child-component&gt;
  `
})
class ParentComponent implements OnInit {
  message: string;
  constructor() {}

  ngOnInit(): void {

  }

  getMessage(event): void {
    this.message = event;
  }
}

@Component({
  selector: 'child-component',
  styles: [ `
    :host {
      border: solid 2px blue;
      display: block;
      overflow: hidden;
      padding: 2em;
    }`
  ],
  template: `
  &lt;p&gt;Child component&lt;/p&gt;
  &lt;label&gt;
    Name:
    &lt;input type=&quot;text&quot; [formControl]=&quot;childMessage&quot;&gt;
  &lt;/label&gt;
  &lt;button (click)=&quot;callToEmit()&quot;&gt;send child message&lt;/button&gt;
  `
})
class ChildComponent implements OnInit {
  childMessage = new FormControl('');
  @Output() sendMessage: EventEmitter&lt;any&gt; = new EventEmitter();
 
  constructor() {}

  ngOnInit(): void {

  }

  callToEmit(): void {
    this.sendMessage.emit(this.childMessage.value);
  }
}

@NgModule({
  declarations: [ParentComponent, ChildComponent],
  imports: [
    BrowserModule,
    CommonModule, 
    ReactiveFormsModule
  ],
  bootstrap: [ParentComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='31,32,43-45,69,77-79,only'></div>
<h2>Programmatically updating <code>FormArray</code> values</h2>
<p>When we have a FormArray we need to update programmatically with a value we can use the <a href="https://angular.io/api/forms/FormArray#patchvalue"><code>patchValue</code></a> or <a href="https://angular.io/api/forms/FormArray#setvalue"><code>setValue</code></a> methods on the <code>FormArray</code> class.</p>
<p>The difference between these two FormArray’s methods is that <code>setValue</code> replaces the current array with the new value, and <code>patchValue</code> updates the array with the new values, trying to update values where possible.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { ReactiveFormsModule, FormGroup, FormBuilder } = ng.forms;

@Component({
  selector: 'my-app',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;
    &lt;label&gt;
      Custom input:
      &lt;input type=&quot;text&quot; (change)=&quot;customChange($event)&quot;&gt;
    &lt;/label&gt;
    
    &lt;form [formGroup]=&quot;userForm&quot;&gt;
      &lt;label&gt;
        First name:
        &lt;input type=&quot;text&quot; formControlName=&quot;firstName&quot;&gt;
      &lt;/label&gt;
      &lt;label&gt;
        Last name:
        &lt;input type=&quot;text&quot; formControlName=&quot;lastName&quot;&gt;
      &lt;/label&gt;
      &lt;label&gt;
        Email:
        &lt;input type=&quot;text&quot; formControlName=&quot;email&quot;&gt;
      &lt;/label&gt;
    &lt;/form&gt;
  `
})
class AppComponent implements OnInit {
  userForm: FormGroup;

  constructor(private fb:FormBuilder) {}

  ngOnInit(): void {
    this.userForm = this.fb.group({
      firstName: {value: '', disabled: false},
      lastName: {value: '', disabled: false},
      email: {value: '', disabled: false}
    });
  }

  customChange(ev): void {
    const newVal = ev.currentTarget.value;
    const formControl = this.userForm.get('firstName');
    formControl.patchValue(newVal);
  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
AppComponent.parameters = [FormBuilder];

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    CommonModule,
    ReactiveFormsModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='25,57-61,only'></div>
<ul>
<li>How to emit a value to a parent component (you learned this in the section above! ✔️)</li>
<li>How to programmatically update a <code>FormArray</code>’s value (you learned this in the section above! ✔️)</li>
</ul>
<h2>P5: Technical requirements</h2>
<p>Create an <code>itemsChanged</code> EventEmitter property that emits the <code>selectedItems</code> value every time it changes, and in the parent OrderForm component update the <code>items</code> FormControl with the value.</p>
<h2>P5: How to verify your solution is correct</h2>
<p>✏️ Update the menu-items spec file <strong>src/app/order/order.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { NO_ERRORS_SCHEMA } from '@angular/core';
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ReactiveFormsModule } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant/restaurant.service';
import { MenuItemsComponent } from './menu-items/menu-items.component';
import { OrderComponent } from './order.component';

class MockRestaurantService {
  getRestaurant(slug: string) {
    return of({
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    });
  }
}

const MockActivatedRoute = {
  snapshot: {
    paramMap: {
      get() {
        return 'poutine-palace';
      },
    },
  },
};

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [OrderComponent, MenuItemsComponent],
      imports: [ReactiveFormsModule, RouterTestingModule],
      providers: [
        {
          provide: RestaurantService,
          useClass: MockRestaurantService,
        },
        {
          provide: ActivatedRoute,
          useValue: MockActivatedRoute,
        },
      ],
      schemas: [NO_ERRORS_SCHEMA],
    }).compileComponents();
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should get a restaurant based on route slug', () =&gt; {
    const mockRestaurant = {
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    };
    expect(fixture.componentInstance.restaurant).toEqual(mockRestaurant);
  });

  it('should have an orderForm formGroup', () =&gt; {
    expect(
      fixture.componentInstance.orderForm?.controls['restaurant']
    ).toBeTruthy();
    expect(
      fixture.componentInstance.orderForm?.controls['address']
    ).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['phone']).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['items']).toBeTruthy();
  });

  it('should have a validator on items formControl', () =&gt; {
    const itemFormControl =
      fixture.componentInstance.orderForm?.controls['items'];
    expect(itemFormControl?.valid).toEqual(false);
  });

  it('should get updated selected Items when child component changes', () =&gt; {
    fixture.detectChanges();
    const changeSpy = spyOn(fixture.componentInstance, 'getChange');
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    childInput.click();
    expect(changeSpy).toHaveBeenCalled();
  });

  it('should update items FormControl when updateItems is called', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    const formItems = fixture.componentInstance.orderForm?.get('items');
    childInput.click();
    fixture.detectChanges();
    expect(formItems?.value).toEqual([
      { name: 'Crab Pancakes with Sorrel Syrup', price: 35.99 },
    ]);
  });

  it('should update the order total when the items FormControl value changes', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput1 = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    const childInput2 = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[1];
    childInput1.click();
    childInput2.click();
    fixture.detectChanges();
    const orderText = compiled.querySelector('.submit h4');
    expect(orderText?.textContent).toEqual('Total: $57.98');
  });
});

</code></pre>
 <div line-highlight="8,78,171-180,182-194,196-210,only"></div>
<h2>P5: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/menu-items.component.ts</strong></p>
<pre><code class="language-ts">import { Component, EventEmitter, Input, Output } from '@angular/core';
import { Item } from '../order.component';

@Component({
  selector: 'pmo-menu-items',
  templateUrl: './menu-items.component.html',
  styleUrl: './menu-items.component.less',
})
export class MenuItemsComponent {
  @Input() items: Item[] = [];
  @Output() itemsChanged: EventEmitter&lt;Item[]&gt; = new EventEmitter();
  selectedItems: Item[] = [];

  updateItems(item: Item): void {
    const index = this.selectedItems.indexOf(item);
    if (index &gt; -1) {
      this.selectedItems.splice(index, 1);
    } else {
      this.selectedItems.push(item);
    }
    this.itemsChanged.emit(this.selectedItems);
  }
}

</code></pre>
 <div line-highlight="1,11,21,only"></div>
<p>✏️ Update <strong>src/app/order/order.component.html</strong></p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;&lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot; *ngIf=&quot;restaurant.menu.lunch&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items
              [items]=&quot;restaurant.menu.lunch&quot;
              (itemsChanged)=&quot;getChange($event)&quot;
            &gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner Menu&quot; *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items
              [items]=&quot;restaurant.menu.dinner&quot;
              (itemsChanged)=&quot;getChange($event)&quot;
            &gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; formControlName=&quot;phone&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
 <div line-highlight="13-16,21-24,only"></div>
<p>✏️ Update <strong>src/app/order/order.component.ts</strong></p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import {
  AbstractControl,
  FormBuilder,
  FormControl,
  FormGroup,
  ValidationErrors,
  ValidatorFn,
  Validators,
} from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { Restaurant } from '../restaurant/restaurant';
import { RestaurantService } from '../restaurant/restaurant.service';

export interface Item {
  name: string;
  price: number;
}

export interface OrderForm {
  restaurant: FormControl&lt;string&gt;;
  name: FormControl&lt;string&gt;;
  address: FormControl&lt;string&gt;;
  phone: FormControl&lt;string&gt;;
  items: FormControl&lt;Item[]&gt;;
}

// CUSTOM VALIDATION FUNCTION TO ENSURE THAT THE ITEMS FORM VALUE CONTAINS AT LEAST ONE ITEM.
function minLengthArray(min: number): ValidatorFn {
  return (c: AbstractControl): ValidationErrors | null =&gt; {
    if (c.value.length &gt;= min) {
      return null;
    }
    return { minLengthArray: { valid: false } };
  };
}

@Component({
  selector: 'pmo-order',
  templateUrl: './order.component.html',
  styleUrl: './order.component.less',
})
export class OrderComponent implements OnInit, OnDestroy {
  orderForm?: FormGroup&lt;OrderForm&gt;;
  restaurant?: Restaurant;
  isLoading = true;
  orderTotal = 0.0;
  completedOrder: any;
  orderComplete = false;
  orderProcessing = false;
  private onDestroy$ = new Subject&lt;void&gt;();

  constructor(
    private route: ActivatedRoute,
    private restaurantService: RestaurantService,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    // GETTING THE RESTAURANT FROM THE ROUTE SLUG
    const slug = this.route.snapshot.paramMap.get('slug');

    if (slug) {
      this.restaurantService
        .getRestaurant(slug)
        .pipe(takeUntil(this.onDestroy$))
        .subscribe((data: Restaurant) =&gt; {
          this.restaurant = data;
          this.isLoading = false;
          this.createOrderForm();
        });
    }
  }

  ngOnDestroy(): void {
    this.onDestroy$.next();
    this.onDestroy$.complete();
  }

  createOrderForm(): void {
    this.orderForm = this.formBuilder.nonNullable.group({
      restaurant: [this.restaurant?._id ?? '', Validators.required],
      name: ['', Validators.required],
      address: ['', Validators.required],
      phone: ['', Validators.required],
      // PASSING OUR CUSTOM VALIDATION FUNCTION TO THIS FORM CONTROL
      items: [[] as Item[], minLengthArray(1)],
    });
    this.onChanges();
  }

  getChange(newItems: Item[]): void {
    this.orderForm?.controls.items.patchValue(newItems);
  }

  onChanges(): void {
    // WHEN THE ITEMS CHANGE WE WANT TO CALCULATE A NEW TOTAL
    this.orderForm?.controls.items.valueChanges
      .pipe(takeUntil(this.onDestroy$))
      .subscribe((value) =&gt; {
        let total = 0.0;
        if (value.length) {
          for (const item of value) {
            total += item.price;
          }
          this.orderTotal = Math.round(total * 100) / 100;
        } else {
          this.orderTotal = total;
        }
      });
  }

  onSubmit(): void {}

  startNewOrder(): void {
    this.orderComplete = false;
    this.completedOrder = undefined;
    // CLEAR THE ORDER FORM
    this.createOrderForm();
  }
}

</code></pre>
 <div line-highlight="94-95,122,only"></div>
<p></details></p>
<h2>Control Value Accessor</h2>
<p>Using inputs and event emitters is a great way to pass data between components in a general sense. However this can be a very messy way to approach handling custom form situations. Some times a better approach can be to write a custom component that implements the <a href="https://angular.io/api/forms/ControlValueAccessor">Control Value Accessor</a> interface to just write the value straight to the form. Classes implementing the CVA must have 3 methods - <code>onChange</code>, <code>onTouched</code>, <code>setValue</code>. We call these methods when the user interacts with our checkboxes to let the parent form know that values have been touched, when they change, and what the value is.</p>
<p>✏️ Update <strong>src/app/order/menu-items.component.ts</strong></p>
<pre><code class="language-ts">import { Component, forwardRef, Input } from '@angular/core';
import { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';
import { Item } from '../order.component';

@Component({
  selector: 'pmo-menu-items',
  templateUrl: './menu-items.component.html',
  styleUrl: './menu-items.component.less',
  providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() =&gt; MenuItemsComponent),
      multi: true,
    },
  ],
})
export class MenuItemsComponent implements ControlValueAccessor {
  @Input() items: Item[] = [];
  @Input('value') _value: Item[] = [];

  onChange: any = () =&gt; {};
  onTouched: any = () =&gt; {};

  get value() {
    return this._value;
  }

  set value(value) {
    this._value = value;
    this.onChange(value);
    this.onTouched();
  }

  registerOnChange(fn: any): void {
    this.onChange = fn;
  }

  registerOnTouched(fn: any): void {
    this.onTouched = fn;
  }

  writeValue(value: Item[]) {
    this.value = value;
  }

  updateItems(item: Item): void {
    const index = this._value?.indexOf(item) ?? -1;
    if (index !== -1) {
      this._value?.splice(index, 1);
    } else {
      this._value?.push(item);
    }
    this.writeValue(this._value);
  }
}

</code></pre>
 <div line-highlight="1-2,9-15,17,19,21-22,24-25,28-32,34-36,38-40,42-44,47-49,51,53-54,only"></div>
<p>Other concepts used here:</p>
<h3>forwardRef</h3>
<p><a href="https://angular.io/api/core/forwardRef">forwardRef</a> is used to reference a token that may not be defined when we need it.</p>
<h3>NG_VALUE_ACCESSOR</h3>
<p><a href="https://angular.io/api/forms/NG_VALUE_ACCESSOR">NG_VALUE_ACCESSOR</a> is used to provide the control value accessor for a form control.</p>
<h3>Use New Menu Items Component in Order Form</h3>
<p>✏️ Update <strong>src/app/order/order.component.html</strong></p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;&lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot; *ngIf=&quot;restaurant.menu.lunch&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items
              [items]=&quot;restaurant.menu.lunch&quot;
              formControlName=&quot;items&quot;
            &gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner Menu&quot; *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items
              [items]=&quot;restaurant.menu.dinner&quot;
              formControlName=&quot;items&quot;
            &gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; formControlName=&quot;phone&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
 <div line-highlight="15,23,only"></div>
<p>We now have a form that updates the <code>items</code> formControl when items are selected and shows the user an updated total!</p>
<h3>Update order component Tests</h3>
<p>✏️ Update the order spec file <strong>src/app/order/order.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { NO_ERRORS_SCHEMA } from '@angular/core';
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ReactiveFormsModule } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant/restaurant.service';
import { MenuItemsComponent } from './menu-items/menu-items.component';
import { OrderComponent } from './order.component';

class MockRestaurantService {
  getRestaurant(slug: string) {
    return of({
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    });
  }
}

const MockActivatedRoute = {
  snapshot: {
    paramMap: {
      get() {
        return 'poutine-palace';
      },
    },
  },
};

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [OrderComponent, MenuItemsComponent],
      imports: [ReactiveFormsModule, RouterTestingModule],
      providers: [
        {
          provide: RestaurantService,
          useClass: MockRestaurantService,
        },
        {
          provide: ActivatedRoute,
          useValue: MockActivatedRoute,
        },
      ],
      schemas: [NO_ERRORS_SCHEMA],
    }).compileComponents();
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should get a restaurant based on route slug', () =&gt; {
    const mockRestaurant = {
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    };
    expect(fixture.componentInstance.restaurant).toEqual(mockRestaurant);
  });

  it('should have an orderForm formGroup', () =&gt; {
    expect(
      fixture.componentInstance.orderForm?.controls['restaurant']
    ).toBeTruthy();
    expect(
      fixture.componentInstance.orderForm?.controls['address']
    ).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['phone']).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['items']).toBeTruthy();
  });

  it('should have a validator on items formControl', () =&gt; {
    const itemFormControl =
      fixture.componentInstance.orderForm?.controls['items'];
    expect(itemFormControl?.valid).toEqual(false);
  });

  it('should update items FormControl when setUpdatesItems is called', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    const formItems = fixture.componentInstance.orderForm?.get('items');
    childInput.click();
    fixture.detectChanges();
    expect(formItems?.value).toEqual([
      { name: 'Crab Pancakes with Sorrel Syrup', price: 35.99 },
    ]);
  });

  it('should update the order total when the items FormControl value changes', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput1 = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    const childInput2 = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[1];
    childInput1.click();
    childInput2.click();
    fixture.detectChanges();
    const orderText = compiled.querySelector('.submit h4');
    expect(orderText?.textContent).toEqual('Total: $57.98');
  });
});

</code></pre>
 <div line-highlight="171,only"></div>

</section>

  			
  			<bit-prev-next class="footer" list-selector=".sidebar-left ul li.parent.expanded ul"></bit-prev-next>
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout discord">
          <h6>Get help</h6>
          <p>If you need <a href="https://discord.gg/J7ejFsZnJ4">help</a> with an exercise, please reach out to us on
             <a href="https://discord.gg/J7ejFsZnJ4">Discord</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com</a></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/angular/14-building-order-form/building-order-form.md"},"description":"Building the Order Form \n","name":"learn-angular/building-order-form","title":"Binding Component Data","type":"page","parent":"learn-angular","order":14,"comment":" ","codepen":[["\"can\"","\"//unpkg.com/can@5/core.mjs\""],["\"can/everything\"","\"//unpkg.com/can@5/everything.mjs\""]],"pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
  <div id="email-modal" role="dialog" aria-modal="true" aria-labelledby="dialog_label" style="display: none;">
    <div aria-hidden="true" class="email-modal-backdrop"></div>
    <div role="region" class="email-modal-content">
      <h2 id="dialog_label">Join the Bitovi Newsletter</h2>
      <p>
        Do you want to receive updates about new Bitovi Academy courses, Bitovi open source projects, and dev community news? If so, please provide your email. We won’t spam you or give it away for any reason!<br />
        <i style="font-size: 0.8rem;">By providing your email you agree to receive communications from Bitovi</i>
      </p>
      <div id="academy-hubspot-form-embed"></div>
      <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
      <button id="email-modal-close" title="dismiss"><img src="../static/img/close.svg" height="24" width="24"></button>
    </div>
  </div>
</body>
</html>
