<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/angular/18-item-total-pipe/item-total-pipe.md
	@page learn-angular/item-total-pipe
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Write an Item Total Pipe to help manage item total calculation across our application. ">
  <title>Bitovi Academy - Item Total Pipe</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building a feature-rich Tic-Tac-Toe game in this beginner React guide. This hands-on course will introduce both fundamental and more advanced React concepts! By the end of this course, you will have mastered functional components, hooks, and component optimization.">
							Learn React
						</a>
						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a NodeJS app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to perform technology consulting.">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="why-angular.html"
							title="Why Angular is a great choice for modern web application development.">
							Why Angular
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-our-first-app.html"
							title="Learn how to generate an Angular 11 application with it&#x27;s command line interface (CLI).">
							Generate an App
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-components.html"
							title="Learn how to create basic components in Angular and iterate through data using an Angular for loop.">
							Creating Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-pipes.html"
							title="Learn how to create a custom pipe in Angular that returns a modified version of a string.">
							Creating Pipes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="adding-routing.html"
							title="Learn how to add basic routing to components in an Angular application.">
							Adding Routing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-navigation.html"
							title="Learn how to create dynamic links with Angular that navigate to different parts of an application.">
							Creating Navigation
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="restaurant-service.html"
							title="Learn how to write an Angular service that gets data from the server.">
							Writing a Restaurant Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="pull-restaurant-data-into-view.html"
							title="Learn how to render API data into HTML with a view.">
							Use Restaurant API data
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="state-city-options.html"
							title="Learn how to create a Reactive Form with Angular. We will create a Reactive Form in the Restaurant component with city and state dropdown inputs.">
							City &amp; State Options
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="form-value-changes.html"
							title="Learn how to listen to form value changes with Angular.">
							Filter Cities by State
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="updating-service-params.html"
							title="Learn  how to make a service take multiple parameters.">
							Filter Restaurants by City
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="declarative-state.html"
							title="Modify Restaurants component to derive state via RxJS streams">
							Optional: Declarative State
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="writing-unit-tests.html"
							title="Write a unit test for a service in Angular">
							Writing Unit Tests
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="nested-routes.html"
							title="Creating nested restaurant routes">
							Nested Restaurant Routes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-order-form.html"
							title="Building the Order Form">
							Building the Order Form
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-directive.html"
							title="Learn how to create Directives in Angular that can change the appearance or behavior of DOM Elements.">
							Creating Directive
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-service.html"
							title="Writing the Order Service">
							Order Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-history-component.html"
							title="Writing the Order History Component">
							Order History Component
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="item-total-pipe.html"
							title="Write an Item Total Pipe to help manage item total calculation across our application.">
							Item Total Pipe
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="real-time-connection.html"
							title="Updating Order History View with Real Time Connection">
							Real Time Connections
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="deploy-app.html"
							title="Deploying App">
							Deploy App
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Item Total Pipe <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Write an Item Total Pipe to help manage item total calculation across our application.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2>Overview</h2>
<p>In this part, we will:</p>
<ul>
<li>Create a new Pipe called Item Totals</li>
<li>Use Angular Default Currency Pipe</li>
</ul>
<h2>Problem</h2>
<p>Now that our application is coming together nicely, you might have noticed we are repeating the same code to calculate the total prices of our items.
We can simplify this by creating an Item Total Pipe which we will use in <code>order-component.ts</code> file and in the <code>order-history-component.html</code> file. The pipe will transform an array of items and return the total sum of the price of each item.</p>
<h1>What You Need to Know</h1>
<p>How to:</p>
<ul>
<li>Generate a Pipe using Angular Cli  (you previously learned this in the <a href="/academy/academy/learn-angular/creating-pipes.html">Creating Pipes</a> section! ✔️)</li>
<li>Provide a Pipe globally to the entire application, so it can be used in any component</li>
</ul>
<h2>Generating Pipe</h2>
<p>✏️ Run the following to generate the <strong>Pipe</strong> and the test files:</p>
<pre><code class="language-bash">ng g pipe itemTotal
</code></pre>
<h2>Provide Pipe Globally</h2>
<p>Unlike services, Pipes are not readily injectable into our components. In order to be able to use Pipes in a component, it has to be provided in the app module.
To provide the <strong>Pipe</strong> just created in the app module, simply add the Pipe to the provider array in the <code>app.module.ts</code> file. <a href="https://angular.io/guide/providers">Learn More</a></p>
<p>✏️ Update <strong>src/app/app.module.ts</strong></p>
<pre><code class="language-ts">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';
import { ReactiveFormsModule } from '@angular/forms';
import { TabsModule } from 'ngx-bootstrap/tabs';

import { MenuItemsComponent } from './order/menu-items/menu-items.component';
import { HistoryComponent } from './order/history/history.component';
import { ListComponent } from './order/list/list.component';

import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { HomeComponent } from './home/home.component';
import { RestaurantComponent } from './restaurant/restaurant.component';
import { ImageUrlPipe } from './image-url.pipe';
import { DetailComponent } from './restaurant/detail/detail.component';
import { OrderComponent } from './order/order.component';
import { OnlyNumbersDirective } from './only-numbers.directive';
import { ItemTotalPipe } from './item-total.pipe';

@NgModule({
    declarations: [
        AppComponent,
        HomeComponent,
        RestaurantComponent,
        ImageUrlPipe,
        DetailComponent,
        OrderComponent,
        MenuItemsComponent,
        HistoryComponent,
        ListComponent,
        OnlyNumbersDirective,
        ItemTotalPipe
    ],
    imports: [
        BrowserModule,
        AppRoutingModule,
        HttpClientModule,
        ReactiveFormsModule,
        TabsModule.forRoot()
    ],
    providers: [ItemTotalPipe],
    bootstrap: [AppComponent]
})
export class AppModule { }

</code></pre>
<div line-highlight='42, only'></div>
<p>Now the Pipe is available to be used in components across the application <a href="https://angular.io/guide/providers" target="\_blank">Providers</a>.</p>
<p>The example below shows how to provide a Pipe globally in Angular. The Pipe being created will transform two separate words into one compound word. It will take a string value, then a parameter, that is used as a prefix to the string value.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
// app.js
const { Component, VERSION, Pipe, PipeTransform} = ng.core;

@Pipe({name: 'prefix'})
class PrefixPipe implements PipeTransform {
  transform(value: string, prefix: string): string {
  if(prefix &amp;&amp; value ) {
    return `${prefix}-${value}`;
    }
    return value;
  }
}

@Component({
  selector: 'my-app',
  template: `
  &lt;h2&gt;{{word}}&lt;/h2&gt;
  &lt;br&gt;
   &lt;h2&gt;{{word2 | prefix: 'long'}}&lt;/h2&gt;
  `
})
class AppComponent implements OnInit {
  word = 'two';
  word2 = 'term';
  constructor(private prefixPipe: PrefixPipe) {
  }

  ngOnInit() {
    this.word = this.prefixPipe.transform(this.word, 'seventy');
  }
}

// main.js
const { BrowserModule } = ng.platformBrowser;
const { NgModule } = ng.core;
const { CommonModule } = ng.common;

@NgModule({
  imports: [ BrowserModule,
  CommonModule],
  declarations: [AppComponent, PrefixPipe],
  bootstrap: [AppComponent],
  providers: [PrefixPipe]
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='14-22, 27, 29, 39, 51, 53, only'></div>
<h2>How to Verify Your Solution is Correct</h2>
<p>✏️ Update the order spec file <strong>src/app/order/order.component.spec.ts</strong> to include and provide the new Pipe:</p>
<pre><code class="language-ts">import { waitForAsync, ComponentFixture, TestBed } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';
import { ActivatedRoute } from '@angular/router';
import { of } from 'rxjs'; 

import { OrderComponent } from './order.component';
import { ReactiveFormsModule } from '@angular/forms';
import { RestaurantService } from '../restaurant/restaurant.service';
import { NO_ERRORS_SCHEMA } from '@angular/core';
import { MenuItemsComponent } from './menu-items/menu-items.component';
import { OrderService } from './order.service';
import {ItemTotalPipe} from &quot;../item-total.pipe&quot;;

class MockRestaurantService {
  getRestaurant(slug:string) {
    return of({
        &quot;name&quot;: &quot;Poutine Palace&quot;,
        &quot;slug&quot;: &quot;poutine-palace&quot;,
        &quot;images&quot;: {
          &quot;thumbnail&quot;: &quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
          &quot;owner&quot;: &quot;node_modules/place-my-order-assets/images/3-owner.jpg&quot;,
          &quot;banner&quot;: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
        },
        &quot;menu&quot;: {
          &quot;lunch&quot;: [
            {
              &quot;name&quot;: &quot;Crab Pancakes with Sorrel Syrup&quot;,
              &quot;price&quot;: 35.99
            },
            {
              &quot;name&quot;: &quot;Steamed Mussels&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Spinach Fennel Watercress Ravioli&quot;,
              &quot;price&quot;: 35.99
            }
          ],
          &quot;dinner&quot;: [
            {
              &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Herring in Lavender Dill Reduction&quot;,
              &quot;price&quot;: 45.99
            },
            {
              &quot;name&quot;: &quot;Chicken with Tomato Carrot Chutney Sauce&quot;,
              &quot;price&quot;: 45.99
            }
          ]
        },
        &quot;address&quot;: {
          &quot;street&quot;: &quot;230 W Kinzie Street&quot;,
          &quot;city&quot;: &quot;Green Bay&quot;,
          &quot;state&quot;: &quot;WI&quot;,
          &quot;zip&quot;: &quot;53205&quot;
        },
        &quot;_id&quot;: &quot;3ZOZyTY1LH26LnVw&quot;
      })
  }
}

class MockOrderService {
  createOrder(order) {
    return of({
      &quot;address&quot;: null,
      &quot;items&quot;: [{&quot;name&quot;: &quot;Onion fries&quot;, &quot;price&quot;: 15.99}, {&quot;name&quot;: &quot;Roasted Salmon&quot;, &quot;price&quot;: 23.99}],
      &quot;name&quot;: &quot;Jennifer Hungry&quot;,
      &quot;phone&quot;: null,
      &quot;restaurant&quot;: &quot;uPkA2jiZi24tCvXh&quot;,
      &quot;status&quot;: &quot;preparing&quot;,
      &quot;_id&quot;: &quot;0awcHyo3iD6CpvhX&quot;,
    })
  }
}

const MockActivatedRoute = {
  snapshot: {
    paramMap: {
      get() {
        return 'poutine-palace'
      }
    }
  }
}

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;
  let injectedOrderService;

  beforeEach(waitForAsync(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ OrderComponent, MenuItemsComponent ], 
      imports: [  ReactiveFormsModule, RouterTestingModule ],
      providers: [{
        provide: RestaurantService,
        useClass: MockRestaurantService
      }, {
        provide: ActivatedRoute,
        useValue: MockActivatedRoute
      },
      {
        provide: OrderService,
        useClass: MockOrderService
      },
        ItemTotalPipe],
      schemas: [ NO_ERRORS_SCHEMA ]
    })
    .compileComponents();
    injectedOrderService = TestBed.inject(OrderService);
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should get a restaurant based on route slug', () =&gt; {
    let mockRestaurant = {
      &quot;name&quot;: &quot;Poutine Palace&quot;,
      &quot;slug&quot;: &quot;poutine-palace&quot;,
      &quot;images&quot;: {
        &quot;thumbnail&quot;: &quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
        &quot;owner&quot;: &quot;node_modules/place-my-order-assets/images/3-owner.jpg&quot;,
        &quot;banner&quot;: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
      },
      &quot;menu&quot;: {
        &quot;lunch&quot;: [
          {
            &quot;name&quot;: &quot;Crab Pancakes with Sorrel Syrup&quot;,
            &quot;price&quot;: 35.99
          },
          {
            &quot;name&quot;: &quot;Steamed Mussels&quot;,
            &quot;price&quot;: 21.99
          },
          {
            &quot;name&quot;: &quot;Spinach Fennel Watercress Ravioli&quot;,
            &quot;price&quot;: 35.99
          }
        ],
        &quot;dinner&quot;: [
          {
            &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
            &quot;price&quot;: 21.99
          },
          {
            &quot;name&quot;: &quot;Herring in Lavender Dill Reduction&quot;,
            &quot;price&quot;: 45.99
          },
          {
            &quot;name&quot;: &quot;Chicken with Tomato Carrot Chutney Sauce&quot;,
            &quot;price&quot;: 45.99
          }
        ]
      },
      &quot;address&quot;: {
        &quot;street&quot;: &quot;230 W Kinzie Street&quot;,
        &quot;city&quot;: &quot;Green Bay&quot;,
        &quot;state&quot;: &quot;WI&quot;,
        &quot;zip&quot;: &quot;53205&quot;
      },
      &quot;_id&quot;: &quot;3ZOZyTY1LH26LnVw&quot;
    }
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    expect(fixture.componentInstance.restaurant).toEqual(mockRestaurant)
  });

  it('should have an orderForm formGroup', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    expect(fixture.componentInstance.orderForm.controls.restaurant).toBeTruthy();
    expect(fixture.componentInstance.orderForm.controls.address).toBeTruthy();
    expect(fixture.componentInstance.orderForm.controls.phone).toBeTruthy();
    expect(fixture.componentInstance.orderForm.controls.items).toBeTruthy();
  });

  it('should have a validator on items formControl', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    let itemFormControl = fixture.componentInstance.orderForm.controls.items;
    expect(itemFormControl.valid).toEqual(false);
  });

  it('should update items FormControl when setUpdatesItems is called', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let childInput = compiled.getElementsByTagName('pmo-menu-items')[0].getElementsByTagName('input')[0];
    let formItems = fixture.componentInstance.orderForm.get('items');
    childInput.click();
    fixture.detectChanges();
    expect(formItems.value).toEqual([{&quot;name&quot;: &quot;Crab Pancakes with Sorrel Syrup&quot;,&quot;price&quot;: 35.99}])
  });

  it('should update the order total when the items FormControl value changes', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    let compiled = fixture.debugElement.nativeElement;
    let childInput1 = compiled.getElementsByTagName('pmo-menu-items')[0].getElementsByTagName('input')[0];
    let childInput2 = compiled.getElementsByTagName('pmo-menu-items')[0].getElementsByTagName('input')[1];
    childInput1.click();
    childInput2.click();
    fixture.detectChanges();
    let orderText = compiled.querySelector('.submit h4');
    expect(orderText.textContent).toEqual('Total: $57.98')
  });

  it('should call the orderService createOrder on form submit with form values', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    let createOrderSpy = spyOn(injectedOrderService, 'createOrder').and.callThrough();
    let expectedOrderValue = {
      restaurant: '12345',
      name: 'Jennifer Hungry',
      address:  '123 Main St',
      phone: &quot;555-555-5555&quot;,
      items: [{name: &quot;Onion fries&quot;, price: 15.99}, {name: &quot;Roasted Salmon&quot;, price: 23.99}]
    };
    let compiled = fixture.debugElement.nativeElement;
    fixture.componentInstance.orderForm.setValue(expectedOrderValue);
    fixture.detectChanges();
    compiled.querySelector('button[type=&quot;submit&quot;]').click();
    expect(createOrderSpy).toHaveBeenCalledWith(expectedOrderValue);
  });

  it('should show completed order when order is complete', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    let expectedOrderValue = {
      restaurant: '12345',
      name: 'Jennifer Hungry',
      address:  '123 Main St',
      phone: &quot;555-555-5555&quot;,
      items: [{name: &quot;Onion fries&quot;, price: 15.99}, {name: &quot;Roasted Salmon&quot;, price: 23.99}]
    };
    let compiled = fixture.debugElement.nativeElement;
    fixture.componentInstance.orderForm.setValue(expectedOrderValue);
    fixture.detectChanges();
    compiled.querySelector('button[type=&quot;submit&quot;]').click();
    fixture.detectChanges();
    let displayedOrder = compiled.querySelector('h3');
    expect(displayedOrder.textContent).toEqual('Thanks for your order Jennifer Hungry!');
  });

  it('should clear the form values when create new order is clicked', () =&gt; {
    const fixture = TestBed.createComponent(OrderComponent);
    fixture.detectChanges();
    let expectedOrderValue = {
      restaurant: '12345',
      name: 'Jennifer Hungry',
      address:  '123 Main St',
      phone: &quot;555-555-5555&quot;,
      items: [{name: &quot;Onion fries&quot;, price: 15.99}, {name: &quot;Roasted Salmon&quot;, price: 23.99}]
    };
    let compiled = fixture.debugElement.nativeElement;
    fixture.componentInstance.orderForm.setValue(expectedOrderValue);
    fixture.detectChanges();
    compiled.querySelector('button[type=&quot;submit&quot;]').click();
    fixture.detectChanges();
    compiled.querySelector('button:nth-child(1)').click();
    let emptyform = {
      restaurant: '3ZOZyTY1LH26LnVw',
      name: null,
      address: null,
      phone: null,
      items: []
    }
    expect(fixture.componentInstance.orderForm.value).toEqual(emptyform);
  });

});
</code></pre>
<div line-highlight='12, 109, only'></div>
<p>✏️ Update the spec file  <strong>item-total.pipe.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { ItemTotalPipe } from './item-total.pipe';
import { Item } from &quot;./order/order.service&quot;;

describe('ItemTotalPipe', () =&gt; {

  let mockItemList: Item[] = [
   {name: &quot;Truffle Noodles&quot;, price: 14.99},
   {name: &quot;Garlic Fries&quot;, price: 15.99}
  ]
  const pipe =  new ItemTotalPipe();

  it('create an instance', () =&gt; {
    expect(pipe).toBeTruthy();
  });

  it('transform Item[] and return the sum of each item price, total price should be 30.98', () =&gt; {
    const total = pipe.transform(mockItemList);
    expect(total).toEqual(30.98);
  });

  it('expect empty array to be 0', () =&gt; {
    const total = pipe.transform([]);
    expect(total).toEqual(0);
  });

});

</code></pre>
<blockquote>
<p>If you've implemented the solution correctly, when you run <code>npm run test</code> all tests will pass!</p>
</blockquote>
<h2>Solution</h2>
<p>✏️ Update <strong>src/app/item-total.pipe.ts</strong> to:</p>
<pre><code class="language-ts">import { Pipe, PipeTransform } from '@angular/core';
import {Item} from &quot;./order/order.service&quot;;

@Pipe({
  name: 'itemTotal'
})
export class ItemTotalPipe implements PipeTransform {

  transform(items: Item[]): number {
    let itemTotal = 0.0;
    if (items.length) {
      for (const item of items) {
        itemTotal += item.price;
      }
      return Math.round(itemTotal * 100) / 100;
    }
    return itemTotal;
  }

}

</code></pre>
<p>✏️ Update <strong>src/app/order/order.component.ts</strong> to use the item total Pipe:</p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { FormGroup, FormBuilder, FormArray, AbstractControl, Validators } from '@angular/forms';

import { RestaurantService } from '../restaurant/restaurant.service';
import { Restaurant } from '../restaurant/restaurant';
import { OrderService, Order, Item } from './order.service';
import { Subject } from 'rxjs';
import { takeUntil } from &quot;rxjs/operators&quot;;
import {ItemTotalPipe} from &quot;../item-total.pipe&quot;;


function minLengthArray(min: number) {
  return (c: AbstractControl): {[key: string]: any} =&gt; {
      if (c.value.length &gt;= min)
          return null;
      return { 'minLengthArray': {valid: false }};
  }
}

@Component({
  selector: 'pmo-order',
  templateUrl: './order.component.html',
  styleUrls: ['./order.component.less']
})
export class OrderComponent implements OnInit, OnDestroy {
  orderForm: FormGroup;
  restaurant: Restaurant;
  isLoading = true;
  items: FormArray;
  orderTotal = 0.0;
  completedOrder: Order;
  orderComplete = false;
  orderProcessing = false;
  private unSubscribe = new Subject&lt;void&gt;();

  constructor(
    private route: ActivatedRoute, 
    private restaurantService: RestaurantService,
    private orderService: OrderService,
    private formBuilder: FormBuilder,
    private itemTotal: ItemTotalPipe
  ) { 
  }

  ngOnInit() {
    const slug = this.route.snapshot.paramMap.get('slug');

    this.restaurantService.getRestaurant(slug).subscribe((data:Restaurant) =&gt; {
      this.restaurant = data;
      this.isLoading = false;      
      this.createOrderForm();
    })
  }

  ngOnDestroy(): void {
    this.unSubscribe.next();
    this.unSubscribe.complete();
  }

  createOrderForm() {
    this.orderForm = this.formBuilder.group({
      restaurant: [this.restaurant._id],
      name: [null, Validators.required],
      address:  [null, Validators.required],
      phone: [null, Validators.required],
      items: [[], minLengthArray(1)]
    });
    this.onChanges();
  }

  onChanges() {
    this.orderForm.get('items').valueChanges.pipe(takeUntil(this.unSubscribe)).subscribe((val: Item[])=&gt; {

      this.orderTotal = this.itemTotal.transform(val);

    });
  }

  onSubmit() {
    this.orderProcessing = true;
    this.orderService.createOrder(this.orderForm.value).subscribe((res: Order) =&gt; {
      this.completedOrder = res;
      this.orderComplete = true;
      this.orderProcessing = false;
    });
  }

  startNewOrder() {
    this.orderComplete = false;
    this.orderTotal = 0.0;
    this.createOrderForm();
  }

}

</code></pre>
<div line-highlight='10, 42, 75, only'></div>
<p>✏️ Update <strong>src/app/order/list/list.component.html</strong> to use the item total Pipe:</p>
<pre><code class="language-html">&lt;h4&gt;{{listTitle}}&lt;/h4&gt;
&lt;ng-container *ngFor=&quot;let order of orders&quot;&gt;
  &lt;div [ngClass]=&quot;['order', order.status? order.status: '']&quot;&gt;
    &lt;address&gt;
      {{order.name}} &lt;br /&gt;{{order.address}} &lt;br /&gt;{{order.phone}}
    &lt;/address&gt;
  
    &lt;div class=&quot;items&quot;&gt;
      &lt;ul&gt;
        &lt;li *ngFor=&quot;let item of order.items&quot;&gt;{{item.name}}&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;

    &lt;div class=&quot;total&quot;&gt;{{(order.items | itemTotal)}}&lt;/div&gt;
  
    &lt;div class=&quot;actions&quot;&gt;
      &lt;span class=&quot;badge&quot;&gt;{{statusTitle}}&lt;/span&gt;
        &lt;p class=&quot;action&quot; *ngIf=&quot;action&quot;&gt;
          Mark as:
          &lt;a href=&quot;javascript://&quot; (click)=&quot;markAs(order, action)&quot;&gt;
            {{actionTitle}}
          &lt;/a&gt;
        &lt;/p&gt;
  
      &lt;p class=&quot;action&quot;&gt;
        &lt;a href=&quot;javascript://&quot;  (click)=&quot;delete(order._id)&quot;&gt;Delete&lt;/a&gt;
      &lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/ng-container&gt;

&lt;div class=&quot;order empty&quot;&gt;{{emptyMessage}}&lt;/div&gt;

</code></pre>
 <div line-highlight="14,only"></div>
<h2>Using Currency Pipe</h2>
<p>Now that we have finished implementing our Item Total Pipe, this is a good time for us to talk about using Currency Pipe. You might have noticed that our prices are in USD, which is a currency, and is a perfect use for the Currency Pipe.
Angular provides us with a <a href="https://angular.io/api/common/CurrencyPipe">Currency Pipe</a> that formats a number as currency using locale rules. Locale Rules refers to a user's country or region specific details like currency, language and more.</p>
<h1>What You Need to Know</h1>
<p>How to:</p>
<ul>
<li>Apply a Pipe (you previously learned this ✔️)</li>
<li>Set a default Currency Code</li>
</ul>
<p>Like all the other Pipe we have created, the Currency Pipe can be used the exact same way.
Add the Currency Pipe to the <code>order.component.html</code> , <code>menu-items.component.html</code> and <code>list.component.html</code>:</p>
<p>✏️ Update <strong>src/app/order/order.component.html</strong> to use the Currency Pipe:</p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete; else showOrderForm&quot;&gt;
    &lt;h3&gt;Thanks for your order {{completedOrder.name}}!&lt;/h3&gt;
    &lt;div&gt;&lt;label class=&quot;control-label&quot;&gt;
      Confirmation Number: {{completedOrder._id}}&lt;/label&gt;
    &lt;/div&gt;

    &lt;h4&gt;Items ordered:&lt;/h4&gt;
    &lt;ul class=&quot;list-group panel&quot;&gt;
      &lt;li class=&quot;list-group-item&quot; *ngFor=&quot;let item of completedOrder.items&quot;&gt;
        &lt;label&gt;
          {{item.name}} &lt;span class=&quot;badge&quot;&gt;{{item.price | currency}}&lt;/span&gt;
        &lt;/label&gt;
      &lt;/li&gt;

      &lt;li class=&quot;list-group-item&quot;&gt;
        &lt;label&gt;
          Total &lt;span class=&quot;badge&quot;&gt;{{orderTotal | currency}}&lt;/span&gt;
        &lt;/label&gt;
      &lt;/li&gt;
    &lt;/ul&gt;

    &lt;div&gt;&lt;label class=&quot;control-label&quot;&gt;
      Phone: {{completedOrder.phone}}
    &lt;/label&gt;&lt;/div&gt;
    &lt;div&gt;&lt;label class=&quot;control-label&quot;&gt;
      Address: {{completedOrder.address}}
      &lt;/label&gt;&lt;/div&gt;
    &lt;p&gt;
      &lt;button (click)=&quot;startNewOrder()&quot;&gt;
        Place another order
      &lt;/button&gt;
    &lt;/p&gt;
  &lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form *ngIf=&quot;orderForm&quot; [formGroup]=&quot;orderForm&quot; (ngSubmit)=&quot;onSubmit()&quot;&gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items [items]=&quot;restaurant.menu.lunch&quot; formControlName=&quot;items&quot;&gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner menu&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items [items]=&quot;restaurant.menu.dinner&quot; formControlName=&quot;items&quot;&gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; class=&quot;form-control&quot; formControlName=&quot;name&quot;&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; class=&quot;form-control&quot; formControlName=&quot;address&quot;&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input name=&quot;phone&quot; type=&quot;text&quot; pmoOnlyNumbers class=&quot;form-control&quot; formControlName=&quot;phone&quot;&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: {{orderTotal | currency}}&lt;/h4&gt;
          &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
          &lt;button type=&quot;submit&quot; [disabled]=&quot;!orderForm.valid || orderProcessing&quot; class=&quot;btn&quot;&gt;
            Place My Order!
          &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;
</code></pre>
 <div line-highlight="12,18,66,only"></div>
<p>✏️ Update <strong>src/app/order/list/list.component.html</strong> to use the currency Pipe:</p>
<pre><code class="language-html">&lt;h4&gt;{{listTitle}}&lt;/h4&gt;
&lt;ng-container *ngFor=&quot;let order of orders&quot;&gt;
  &lt;div [ngClass]=&quot;['order', order.status? order.status: '']&quot;&gt;
    &lt;address&gt;
      {{order.name}} &lt;br /&gt;{{order.address}} &lt;br /&gt;{{order.phone}}
    &lt;/address&gt;
  
    &lt;div class=&quot;items&quot;&gt;
      &lt;ul&gt;
        &lt;li *ngFor=&quot;let item of order.items&quot;&gt;{{item.name}}&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;

    &lt;div class=&quot;total&quot;&gt;{{(order.items | itemTotal) | currency}}&lt;/div&gt;
  
    &lt;div class=&quot;actions&quot;&gt;
      &lt;span class=&quot;badge&quot;&gt;{{statusTitle}}&lt;/span&gt;
        &lt;p class=&quot;action&quot; *ngIf=&quot;action&quot;&gt;
          Mark as:
          &lt;a href=&quot;javascript://&quot; (click)=&quot;markAs(order, action)&quot;&gt;
            {{actionTitle}}
          &lt;/a&gt;
        &lt;/p&gt;
  
      &lt;p class=&quot;action&quot;&gt;
        &lt;a href=&quot;javascript://&quot;  (click)=&quot;delete(order._id)&quot;&gt;Delete&lt;/a&gt;
      &lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/ng-container&gt;

&lt;div class=&quot;order empty&quot;&gt;{{emptyMessage}}&lt;/div&gt;

</code></pre>
 <div line-highlight="14,only"></div>
<p>✏️ Update <strong>src/app/order/menu-items/menu-items.component.html</strong> to use the Currency Pipe:</p>
<pre><code class="language-html">&lt;li class=&quot;list-group-item&quot; *ngFor=&quot;let item of items&quot;&gt;
  &lt;label&gt;
    &lt;input type=&quot;checkbox&quot; (change)=&quot;updateItems(item)&quot; &gt;
    {{item.name}} &lt;span class=&quot;badge&quot;&gt;{{item.price | currency}}&lt;/span&gt;
  &lt;/label&gt;
&lt;/li&gt;
</code></pre>
 <div line-highlight="4,only"></div>
<h2>Set Default Currency Code</h2>
<p>In our application we want to have a default currency regardless of what country or language the user is accessing our application from.
To do this, simply provide the default currency you want use in the entire application (we previously discussed how to implement this).</p>
<p>✏️ Update <strong>app.module.ts</strong> to provide currency code:</p>
<pre><code class="language-ts">import { BrowserModule } from '@angular/platform-browser';
import { DEFAULT_CURRENCY_CODE, NgModule } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';
import { ReactiveFormsModule } from '@angular/forms';
import { TabsModule } from 'ngx-bootstrap/tabs';

import { MenuItemsComponent } from './order/menu-items/menu-items.component';
import { HistoryComponent } from './order/history/history.component';
import { ListComponent } from './order/list/list.component';

import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { HomeComponent } from './home/home.component';
import { RestaurantComponent } from './restaurant/restaurant.component';
import { ImageUrlPipe } from './image-url.pipe';
import { DetailComponent } from './restaurant/detail/detail.component';
import { OrderComponent } from './order/order.component';
import { OnlyNumbersDirective } from './only-numbers.directive';
import { ItemTotalPipe } from './item-total.pipe';

@NgModule({
    declarations: [
        AppComponent,
        HomeComponent,
        RestaurantComponent,
        ImageUrlPipe,
        DetailComponent,
        OrderComponent,
        MenuItemsComponent,
        HistoryComponent,
        ListComponent,
        OnlyNumbersDirective,
        ItemTotalPipe
    ],
    imports: [
        BrowserModule,
        AppRoutingModule,
        HttpClientModule,
        ReactiveFormsModule,
        TabsModule.forRoot()
    ],
    providers: [ItemTotalPipe, {provide: DEFAULT_CURRENCY_CODE, useValue: 'USD'}],
    bootstrap: [AppComponent]
})
export class AppModule { }

</code></pre>
 <div line-highlight="2,42,only"></div>

</section>

  			
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout slack">
          <h6>Get help</h6>
          <p>If you need <a href="https://www.bitovi.com/community/slack">help</a> with an exercise, please reach out to us on
             <a href="https://www.bitovi.com/community/slack">Slack</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com<a/></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/angular/18-item-total-pipe/item-total-pipe.md"},"description":"Write an Item Total Pipe to help manage item total calculation across our application. ","name":"learn-angular/item-total-pipe","title":"Item Total Pipe","type":"page","parent":"learn-angular","order":18,"comment":" ","codepen":[["\"can\"","\"//unpkg.com/can@5/core.mjs\""],["\"can/everything\"","\"//unpkg.com/can@5/everything.mjs\""]],"pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
</body>
</html>
