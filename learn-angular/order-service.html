<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/angular/16-order-service/order-service.md
	@page learn-angular/order-service
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Writing the Order Service ">
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P9MQVJS');</script>
  <!-- End Google Tag Manager -->

  <title>Bitovi Academy - Order Service</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9MQVJS"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget. We strongly suggest finishing learn-advanced-javascript prior to starting this course.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building a feature-rich Tic-Tac-Toe game in this beginner React guide. This hands-on course will introduce both fundamental and more advanced React concepts! By the end of this course, you will have mastered functional components, hooks, and component optimization.">
							Learn React
						</a>
						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-agile-program-management-with-jira.html"
							title="Learn how to build, maintain, and report on accurate multi-team plans with Jira.">
							Agile Program Management With Jira
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to move beyond writing code to be an excellent technology consultant!">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-ngrx.html"
							title="Learn how to manage state in an Angular application using NgRx.">
							Learn NgRx
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-graphql.html"
							title="Build a backend application for property rentals using Node JS, GraphQL and Apollo Server.         Learn about using ORMs like Mongoose and Prisma with a NoSQL Mongo database!
Write testcases testing created endpoints.">
							Learn Graphql
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a Node.js app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="why-angular.html"
							title="Discover why Angular is a great choice for modern web application development.">
							Why Angular?
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-our-first-app.html"
							title="Learn how to generate an Angular 17 application with its command line interface (CLI).">
							Generate an App
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-components.html"
							title="Learn how to create basic components in Angular and iterate through data using an Angular for loop.">
							Creating Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-pipes.html"
							title="Learn how to create a custom pipe in Angular that returns a modified version of a string.">
							Creating Pipes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="adding-routing.html"
							title="Learn how to add basic routing to components in an Angular application.">
							Adding Routing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-navigation.html"
							title="Learn how to create dynamic links with Angular that navigate to different parts of an application.">
							Creating Navigation
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="restaurant-service.html"
							title="Learn how to write an Angular service that gets data from the server.">
							Writing a Restaurant Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="pull-restaurant-data-into-view.html"
							title="Learn how to render API data into HTML with a view.">
							Use Restaurant API data
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="state-city-options.html"
							title="Learn how to create a Reactive Form with Angular. We will create a Reactive Form in the Restaurant component with city and state dropdown inputs.">
							City &amp; State Options
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="form-value-changes.html"
							title="Learn how to listen to form value changes with Angular.">
							Filter Cities by State
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="updating-service-params.html"
							title="Learn how to make a service take multiple parameters.">
							Filter Restaurants by City
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="declarative-state.html"
							title="Modify Restaurants component to derive state via RxJS streams">
							Optional: Declarative State
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="writing-unit-tests.html"
							title="Write a unit test for a service in Angular">
							Writing Unit Tests
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="nested-routes.html"
							title="Creating nested restaurant routes">
							Nested Restaurant Routes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-order-form.html"
							title="Building the Order Form">
							Building the Order Form
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-directive.html"
							title="Learn how to create Directives in Angular that can change the appearance or behavior of DOM Elements.">
							Creating Directive
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="order-service.html"
							title="Writing the Order Service">
							Order Service
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-history-component.html"
							title="Writing the Order History Component">
							Order History Component
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="item-total-pipe.html"
							title="Write an Item Total Pipe to help manage item total calculation across our application.">
							Item Total Pipe
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="real-time-connection.html"
							title="Updating Order History View with Real Time Connection">
							Real Time Connections
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="deploy-app.html"
							title="Deploying App">
							Deploy App
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../advanced-typescript.html"
							title="This is the second course in the TypeScript series. By the end, you will be comfortable with any types you come across and possess the knowledge to create your own advanced types. The only prerequisite is the first course in the TypeScript series found here.">
							Advanced TypeScript
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Order Service <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Writing the Order Service</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2>Overview</h2>
<p>In this part, we will:</p>
<ul>
<li>Create a new order service</li>
<li>Write interfaces to describe orders and items in orders</li>
<li>Add data methods to our service</li>
<li>Import our new order service to our component &amp; create an order</li>
<li>Show completed order in UI</li>
</ul>
<h2>Problem 1: Create Order Service and Export Items and Order interfaces</h2>
<p>We need to create a new service to handle creating and updating orders. We’ll need three interfaces - one to describe the order form data, one to describe the order, and one to describe items in the order.</p>
<h2>P1: Technical Requirements</h2>
<p>Create a new service <code>order</code> in the order directory, and write and export <code>CreateOrderDto</code>, <code>Order</code> and <code>Item</code> interfaces representing these objects in the new service:</p>
<pre><code class="language-typescript">const createOrderDto = {
  restaurant: '12345',
  name: 'Jennifer',
  address: '123 Main st',
  phone: '867-5309',
  items: [
    {
      name: 'tacos',
      price: 6.99,
    },
  ],
};

const order = {
  _id: 'a123123bdd',
  restaurant: '12345',
  name: 'Jennifer',
  address: '123 Main st',
  phone: '867-5309',
  status: 'new',
  items: [
    {
      name: 'tacos',
      price: 6.99,
    },
  ],
};
</code></pre>
<h2>P1: What you Need to Know</h2>
<ul>
<li><p>How to create services (you learned this in previous sections! ✔️)</p></li>
<li><p>How to write interfaces (you learned this in previous sections! ✔️)</p>
<pre><code class="language-bash">  ng g service order/order
</code></pre></li>
</ul>
<h2>P1: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/order.service.ts</strong></p>
<pre><code class="language-ts">import { Injectable } from '@angular/core';

export interface Item {
  name: string;
  price: number;
}

export interface CreateOrderDto {
  restaurant: string;
  name: string;
  address: string;
  phone: string;
  items: Item[];
}

export interface Order {
  _id: string;
  restaurant: string;
  name: string;
  address: string;
  phone: string;
  status: string;
  items: Item[];
}

@Injectable({
  providedIn: 'root'
})
export class OrderService {

  constructor() { }
}

</code></pre>
<div line-highlight='3-6, 8-14, 16-24'></div>
<p></details></p>
<h2>Problem 2: Finish the Order Service</h2>
<p>With our order service we’ll want to be able to create new orders, updating existing orders, delete orders, and view all orders.</p>
<h2>P2: Setup</h2>
<p>✏️ Paste the following into <strong>src/app/order/order.service.spec.ts</strong>:</p>
<pre><code class="language-ts">import { HttpRequest } from '@angular/common/http';
import {
  HttpClientTestingModule,
  HttpTestingController,
} from '@angular/common/http/testing';
import { TestBed } from '@angular/core/testing';

import { OrderService } from './order.service';

describe('OrderService', () =&gt; {
  let httpMock: HttpTestingController;
  let orderService: OrderService;

  beforeEach(() =&gt; {
    TestBed.configureTestingModule({
      imports: [HttpClientTestingModule],
      providers: [OrderService],
    });
    httpMock = TestBed.inject(HttpTestingController);
    orderService = TestBed.inject(OrderService);
  });

  it('should make a get request to get orders', () =&gt; {
    const mockOrders = {
      data: [
        {
          _id: 'adsfsdf',
          name: 'Jennifer',
          restaurant: 'FoodLand',
          address: '123 main',
          phone: '555-555-5555',
          status: 'new',
          items: [
            {
              name: 'nummy fries',
              price: 2.56,
            },
          ],
        },
      ],
    };

    orderService.getOrders().subscribe((orders) =&gt; {
      expect(orders).toEqual(mockOrders);
    });

    const url = 'http://localhost:7070/orders';
    const req = httpMock.expectOne(url);

    expect(req.request.method).toEqual('GET');
    req.flush(mockOrders);

    httpMock.verify();
  });

  it('should make a post request to create an order', () =&gt; {
    const mockOrder = {
      _id: 'adsfsdf',
      restaurant: '12345',
      name: 'Jennifer',
      address: '123 main',
      phone: '555-555-5555',
      status: 'new',
      items: [
        {
          name: 'nummy fries',
          price: 2.56,
        },
      ],
    };

    const orderForm = {
      restaurant: '12345',
      name: 'Jennifer',
      address: '123 main',
      phone: '555-555-5555',
      items: [
        {
          name: 'nummy fries',
          price: 2.56,
        },
      ],
    };

    orderService.createOrder(orderForm).subscribe((order) =&gt; {
      expect(order).toEqual(mockOrder);
    });

    const url = 'http://localhost:7070/orders';
    httpMock
      .expectOne(
        (request: HttpRequest&lt;any&gt;) =&gt;
          request.method == 'POST' &amp;&amp;
          request.url == url &amp;&amp;
          JSON.stringify(request.body) ==
            JSON.stringify({ ...orderForm, status: 'new' })
      )
      .flush(mockOrder);

    httpMock.verify();
  });

  it('should make a put request to update an order', () =&gt; {
    const mockOrder = {
      _id: 'adsfsdf',
      restaurant: '12345',
      name: 'Jennifer',
      address: '123 main',
      phone: '555-555-5555',
      status: 'old',
      items: [
        {
          name: 'nummy fries',
          price: 2.56,
        },
      ],
    };

    const updatedOrder = {
      _id: 'adsfsdf',
      restaurant: '12345',
      name: 'Jennifer',
      address: '123 main',
      phone: '555-555-5555',
      status: 'delivered',
      items: [
        {
          name: 'nummy fries',
          price: 2.56,
        },
      ],
    };

    orderService.updateOrder(mockOrder, 'delivered').subscribe((order) =&gt; {
      expect(order).toEqual(updatedOrder);
    });

    const url = 'http://localhost:7070/orders/adsfsdf';
    httpMock
      .expectOne(
        (request: HttpRequest&lt;any&gt;) =&gt;
          request.method == 'PUT' &amp;&amp;
          request.url == url &amp;&amp;
          JSON.stringify(request.body) == JSON.stringify(updatedOrder)
      )
      .flush(updatedOrder);

    httpMock.verify();
  });

  it('should make a delete request to delete an order', () =&gt; {
    const mockOrder = {
      _id: 'adsfsdf',
      restaurant: '12345',
      name: 'Jennifer',
      address: '123 main',
      phone: '555-555-5555',
      status: 'old',
      items: [
        {
          name: 'nummy fries',
          price: 2.56,
        },
      ],
    };

    orderService.deleteOrder('adsfsdf').subscribe((order) =&gt; {
      expect(order).toEqual(mockOrder);
    });

    const url = 'http://localhost:7070/orders/adsfsdf';
    const req = httpMock.expectOne(url);

    expect(req.request.method).toEqual('DELETE');
    req.flush(mockOrder);

    httpMock.verify();
  });
});

</code></pre>
<p>Now, try to understand what this test is doing and
implement the remainder of <code>order.service.ts</code> to
get the tests to pass.</p>
<p>✏️ Run your tests with:</p>
<pre><code class="language-shell">ng test
</code></pre>
<h2>P2: What You Need to Know</h2>
<ul>
<li>The method signatures for the methods you’ll be adding to <code>OrderService</code>:
<ul>
<li><code>getOrders(): Observable&lt;{data: Order[]}&gt;</code> should make a <code>GET</code> request</li>
<li><code>createOrder(orderForm: CreateOrderDto): Observable&lt;Order&gt;</code> should make a <code>POST</code> request</li>
<li><code>updateOrder(order: Order, status: string): Observable&lt;Order&gt;</code> should make a <code>PUT</code> request to <code>/orders/&lt;order-id&gt;</code></li>
<li><code>deleteOrder(orderId: string): Observable&lt;Order&gt;</code> should make a <code>DELETE</code> request to <code>/orders/&lt;order-id&gt;</code></li>
</ul></li>
<li>You will need to make sure <code>HttpClient</code> is imported and
added as a property in the <code>OrderService</code> constructor.</li>
<li>You can pass a request <code>body</code> using the second argument of <code>HttpClient</code> <code>post</code> and <code>put</code> methods.</li>
</ul>
<h2>P2: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/order.service.ts</strong></p>
<pre><code class="language-ts">import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { environment } from '../../environments/environment';

export interface Item {
  name: string;
  price: number;
}

export interface CreateOrderDto {
  restaurant: string;
  name: string;
  address: string;
  phone: string;
  items: Item[];
}

export interface Order {
  _id: string;
  restaurant: string;
  name: string;
  address: string;
  phone: string;
  status: string;
  items: Item[];
}

@Injectable({
  providedIn: 'root',
})
export class OrderService {
  constructor(private httpClient: HttpClient) {}

  getOrders(): Observable&lt;{ data: Order[] }&gt; {
    return this.httpClient.get&lt;{ data: Order[] }&gt;(
      environment.apiUrl + '/orders'
    );
  }

  createOrder(order: CreateOrderDto): Observable&lt;Order&gt; {
    const orderData = {
      ...order,
      status: 'new',
    };
    return this.httpClient.post&lt;Order&gt;(
      environment.apiUrl + '/orders',
      orderData
    );
  }

  updateOrder(order: Order, action: string): Observable&lt;Order&gt; {
    const orderData = {
      ...order,
      status: action,
    };
    return this.httpClient.put&lt;Order&gt;(
      environment.apiUrl + '/orders/' + orderData._id,
      orderData
    );
  }

  deleteOrder(id: string): Observable&lt;Order&gt; {
    return this.httpClient.delete&lt;Order&gt;(environment.apiUrl + '/orders/' + id);
  }
}

</code></pre>
 <div line-highlight="1,3-4,30,33,35-39,41-50,52-61,63-65,only"></div>
<p></details></p>
<h2>Problem 3: Use the OrderService in the OrderComponent to Create an Order</h2>
<h2>P3: Technical Requirements</h2>
<p>For this problem, we will:</p>
<ul>
<li>Create an order when the user submits the form using the service.</li>
<li>Disable the button while the order is being processed.</li>
<li>Show the completed order to the user.</li>
<li>Let the user start a new order.</li>
</ul>
<p>How we will solve this:</p>
<ol>
<li>We will import the order service, and save it as <code>orderService</code> in the
<code>OrderComponent</code>’s <code>constructor</code>.</li>
<li>Call <code>orderService</code>’s <code>createOrder</code> with the <code>orderForm</code>’s values.</li>
<li>While the order is being created <code>orderProcessing</code> should be <code>true</code>.</li>
<li>Once complete, <code>orderComplete</code> should be set to <code>true</code>
and set back to <code>false</code> when <code>startNewOrder()</code> is called.</li>
<li>We will save the completed order in <code>completedOrder</code>.</li>
</ol>
<blockquote>
<p>A FormGroup’s <code>value</code> property is wrapped in <code>Partial</code> type because controls are removed from the form’s value when disabled. For our case, we don’t need to disable controls. We can use a FormGroup’s <code>getRawValue()</code> method to access its value with the full type.</p>
</blockquote>
<h2>P3: Setup</h2>
<p>Before starting:</p>
<p>1. ✏️ Update <strong>src/app/order/order.component.html</strong> to show the completed order:</p>
<pre><code class="language-html">&lt;div class=&quot;order-form&quot;&gt;
  &lt;ng-container *ngIf=&quot;orderComplete &amp;&amp; completedOrder; else showOrderForm&quot;&gt;
    &lt;h3&gt;Thanks for your order {{ completedOrder.name }}!&lt;/h3&gt;
    &lt;div&gt;
      &lt;label class=&quot;control-label&quot;&gt;
        Confirmation Number: {{ completedOrder._id }}&lt;/label
      &gt;
    &lt;/div&gt;

    &lt;h4&gt;Items ordered:&lt;/h4&gt;
    &lt;ul class=&quot;list-group panel&quot;&gt;
      &lt;li class=&quot;list-group-item&quot; *ngFor=&quot;let item of completedOrder.items&quot;&gt;
        &lt;label&gt;
          {{ item.name }} &lt;span class=&quot;badge&quot;&gt;${{ item.price }}&lt;/span&gt;
        &lt;/label&gt;
      &lt;/li&gt;

      &lt;li class=&quot;list-group-item&quot;&gt;
        &lt;label&gt;
          Total &lt;span class=&quot;badge&quot;&gt;${{ orderTotal }}&lt;/span&gt;
        &lt;/label&gt;
      &lt;/li&gt;
    &lt;/ul&gt;

    &lt;div&gt;
      &lt;label class=&quot;control-label&quot;&gt; Phone: {{ completedOrder.phone }} &lt;/label&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label class=&quot;control-label&quot;&gt;
        Address: {{ completedOrder.address }}
      &lt;/label&gt;
    &lt;/div&gt;
    &lt;p&gt;
      &lt;button (click)=&quot;startNewOrder()&quot;&gt;Place another order&lt;/button&gt;
    &lt;/p&gt;
  &lt;/ng-container&gt;
  &lt;ng-template #showOrderForm&gt;
    &lt;h2&gt;Order here&lt;/h2&gt;
    &lt;form
      *ngIf=&quot;orderForm &amp;&amp; restaurant&quot;
      [formGroup]=&quot;orderForm&quot;
      (ngSubmit)=&quot;onSubmit()&quot;
    &gt;
      &lt;tabset&gt;
        &lt;tab heading=&quot;Lunch Menu&quot; *ngIf=&quot;restaurant.menu.lunch&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items
              [items]=&quot;restaurant.menu.lunch&quot;
              formControlName=&quot;items&quot;
            &gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
        &lt;tab heading=&quot;Dinner Menu&quot; *ngIf=&quot;restaurant.menu.dinner&quot;&gt;
          &lt;ul class=&quot;list-group&quot;&gt;
            &lt;pmo-menu-items
              [items]=&quot;restaurant.menu.dinner&quot;
              formControlName=&quot;items&quot;
            &gt;&lt;/pmo-menu-items&gt;
          &lt;/ul&gt;
        &lt;/tab&gt;
      &lt;/tabset&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Name:&lt;/label&gt;
        &lt;input name=&quot;name&quot; type=&quot;text&quot; formControlName=&quot;name&quot; /&gt;
        &lt;p&gt;Please enter your name.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Address:&lt;/label&gt;
        &lt;input name=&quot;address&quot; type=&quot;text&quot; formControlName=&quot;address&quot; /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your address.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;control-label&quot;&gt;Phone:&lt;/label&gt;
        &lt;input
          name=&quot;phone&quot;
          type=&quot;text&quot;
          pmoOnlyNumbers
          formControlName=&quot;phone&quot;
        /&gt;
        &lt;p class=&quot;help-text&quot;&gt;Please enter your phone number.&lt;/p&gt;
      &lt;/div&gt;
      &lt;div class=&quot;submit&quot;&gt;
        &lt;h4&gt;Total: ${{ orderTotal }}&lt;/h4&gt;
        &lt;div class=&quot;loading&quot; *ngIf=&quot;orderProcessing&quot;&gt;&lt;/div&gt;
        &lt;button
          type=&quot;submit&quot;
          [disabled]=&quot;!orderForm.valid || orderProcessing&quot;
          class=&quot;btn&quot;
        &gt;
          Place My Order!
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/ng-template&gt;
&lt;/div&gt;

</code></pre>
 <div line-highlight="2-8,10-16,18-23,25-36,only"></div>
<p>2. ✏️ Update <strong>src/app/order/order.component.ts</strong> to have a <code>onSubmit</code> method and
a <code>startNewOrder</code> that will start a new order.</p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import {
  AbstractControl,
  FormBuilder,
  FormControl,
  FormGroup,
  ValidationErrors,
  ValidatorFn,
  Validators,
} from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { Restaurant } from '../restaurant/restaurant';
import { RestaurantService } from '../restaurant/restaurant.service';

export interface Item {
  name: string;
  price: number;
}

export interface OrderForm {
  restaurant: FormControl&lt;string&gt;;
  name: FormControl&lt;string&gt;;
  address: FormControl&lt;string&gt;;
  phone: FormControl&lt;string&gt;;
  items: FormControl&lt;Item[]&gt;;
}

// CUSTOM VALIDATION FUNCTION TO ENSURE THAT THE ITEMS FORM VALUE CONTAINS AT LEAST ONE ITEM.
function minLengthArray(min: number): ValidatorFn {
  return (c: AbstractControl): ValidationErrors | null =&gt; {
    if (c.value.length &gt;= min) {
      return null;
    }
    return { minLengthArray: { valid: false } };
  };
}

@Component({
  selector: 'pmo-order',
  templateUrl: './order.component.html',
  styleUrls: ['./order.component.less'],
})
export class OrderComponent implements OnInit, OnDestroy {
  orderForm?: FormGroup&lt;OrderForm&gt;;
  restaurant?: Restaurant;
  isLoading = true;
  orderTotal = 0.0;
  completedOrder: any;
  orderComplete = false;
  orderProcessing = false;
  private onDestroy$ = new Subject&lt;void&gt;();

  constructor(
    private route: ActivatedRoute,
    private restaurantService: RestaurantService,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    // GETTING THE RESTAURANT FROM THE ROUTE SLUG
    const slug = this.route.snapshot.paramMap.get('slug');

    if (slug) {
      this.restaurantService
        .getRestaurant(slug)
        .pipe(takeUntil(this.onDestroy$))
        .subscribe((data: Restaurant) =&gt; {
          this.restaurant = data;
          this.isLoading = false;
          this.createOrderForm();
        });
    }
  }

  ngOnDestroy(): void {
    this.onDestroy$.next();
    this.onDestroy$.complete();
  }

  createOrderForm(): void {
    this.orderForm = this.formBuilder.nonNullable.group({
      restaurant: [this.restaurant?._id ?? '', Validators.required],
      name: ['', Validators.required],
      address: ['', Validators.required],
      phone: ['', Validators.required],
      // PASSING OUR CUSTOM VALIDATION FUNCTION TO THIS FORM CONTROL
      items: [[] as Item[], minLengthArray(1)],
    });
    this.onChanges();
  }

  getChange(newItems: Item[]): void {
    this.orderForm?.controls.items.patchValue(newItems);
  }

  onChanges(): void {
    // WHEN THE ITEMS CHANGE WE WANT TO CALCULATE A NEW TOTAL
    this.orderForm?.controls.items.valueChanges
      .pipe(takeUntil(this.onDestroy$))
      .subscribe((val) =&gt; {
        let total = 0.0;
        if (val.length) {
          for (const item of val) {
            total += item.price;
          }
          this.orderTotal = Math.round(total * 100) / 100;
        } else {
          this.orderTotal = total;
        }
      });
  }

  onSubmit(): void {
    this.orderProcessing = true;
    // call createOrder here
  }

  startNewOrder(): void {
    this.orderComplete = false;
    this.completedOrder = undefined;
    // CLEAR THE ORDER FORM
    this.createOrderForm();
  }
}

</code></pre>
 <div line-highlight="115-117,125,only"></div>
<h2>P3: How to Verify Your Solution is Correct</h2>
<p>If you’ve implemented everything correctly, you should now be able to create an order from the UI and see a record of your completed order once it’s created.</p>
<p>✏️ Update the menu-items spec file <strong>src/app/order/order.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { NO_ERRORS_SCHEMA } from '@angular/core';
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { FormGroup, ReactiveFormsModule } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant/restaurant.service';
import { MenuItemsComponent } from './menu-items/menu-items.component';
import { OrderComponent, OrderForm } from './order.component';
import { CreateOrderDto, OrderService } from './order.service';

class MockRestaurantService {
  getRestaurant(slug: string) {
    return of({
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    });
  }
}

class MockOrderService {
  createOrder(order: CreateOrderDto) {
    return of({
      address: null,
      items: [
        { name: 'Onion fries', price: 15.99 },
        { name: 'Roasted Salmon', price: 23.99 },
      ],
      name: 'Jennifer Hungry',
      phone: null,
      restaurant: 'uPkA2jiZi24tCvXh',
      status: 'preparing',
      _id: '0awcHyo3iD6CpvhX',
    });
  }
}

const MockActivatedRoute = {
  snapshot: {
    paramMap: {
      get() {
        return 'poutine-palace';
      },
    },
  },
};

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;
  let orderService: OrderService;

  beforeEach(async () =&gt; {
    await TestBed.configureTestingModule({
      declarations: [OrderComponent, MenuItemsComponent],
      imports: [ReactiveFormsModule, RouterTestingModule],
      providers: [
        {
          provide: RestaurantService,
          useClass: MockRestaurantService,
        },
        {
          provide: ActivatedRoute,
          useValue: MockActivatedRoute,
        },
        {
          provide: OrderService,
          useClass: MockOrderService,
        },
      ],
      schemas: [NO_ERRORS_SCHEMA],
    }).compileComponents();
    orderService = TestBed.inject(OrderService);
  });

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should get a restaurant based on route slug', () =&gt; {
    const mockRestaurant = {
      name: 'Poutine Palace',
      slug: 'poutine-palace',
      images: {
        thumbnail: 'node_modules/place-my-order-assets/images/4-thumbnail.jpg',
        owner: 'node_modules/place-my-order-assets/images/3-owner.jpg',
        banner: 'node_modules/place-my-order-assets/images/2-banner.jpg',
      },
      menu: {
        lunch: [
          {
            name: 'Crab Pancakes with Sorrel Syrup',
            price: 35.99,
          },
          {
            name: 'Steamed Mussels',
            price: 21.99,
          },
          {
            name: 'Spinach Fennel Watercress Ravioli',
            price: 35.99,
          },
        ],
        dinner: [
          {
            name: 'Gunthorp Chicken',
            price: 21.99,
          },
          {
            name: 'Herring in Lavender Dill Reduction',
            price: 45.99,
          },
          {
            name: 'Chicken with Tomato Carrot Chutney Sauce',
            price: 45.99,
          },
        ],
      },
      address: {
        street: '230 W Kinzie Street',
        city: 'Green Bay',
        state: 'WI',
        zip: '53205',
      },
      _id: '3ZOZyTY1LH26LnVw',
    };
    expect(fixture.componentInstance.restaurant).toEqual(mockRestaurant);
  });

  it('should have an orderForm formGroup', () =&gt; {
    expect(
      fixture.componentInstance.orderForm?.controls['restaurant']
    ).toBeTruthy();
    expect(
      fixture.componentInstance.orderForm?.controls['address']
    ).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['phone']).toBeTruthy();
    expect(fixture.componentInstance.orderForm?.controls['items']).toBeTruthy();
  });

  it('should have a validator on items formControl', () =&gt; {
    const itemFormControl =
      fixture.componentInstance.orderForm?.controls['items'];
    expect(itemFormControl?.valid).toEqual(false);
  });

  it('should update items FormControl when setUpdatesItems is called', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    const formItems = fixture.componentInstance.orderForm?.get('items');
    childInput.click();
    fixture.detectChanges();
    expect(formItems?.value).toEqual([
      { name: 'Crab Pancakes with Sorrel Syrup', price: 35.99 },
    ]);
  });

  it('should update the order total when the items FormControl value changes', () =&gt; {
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    const childInput1 = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[0];
    const childInput2 = compiled
      .getElementsByTagName('pmo-menu-items')[0]
      .getElementsByTagName('input')[1];
    childInput1.click();
    childInput2.click();
    fixture.detectChanges();
    const orderText = compiled.querySelector('.submit h4');
    expect(orderText?.textContent).toEqual('Total: $57.98');
  });

  it('should call the orderService createOrder on form submit with form values', () =&gt; {
    const createOrderSpy = spyOn(orderService, 'createOrder').and.callThrough();
    const expectedOrderValue: ReturnType&lt;FormGroup&lt;OrderForm&gt;['getRawValue']&gt; =
      {
        restaurant: '12345',
        name: 'Jennifer Hungry',
        address: '123 Main St',
        phone: '555-555-5555',
        items: [
          { name: 'Onion fries', price: 15.99 },
          { name: 'Roasted Salmon', price: 23.99 },
        ],
      };
    const compiled = fixture.nativeElement as HTMLElement;
    fixture.componentInstance.orderForm?.setValue(expectedOrderValue);
    fixture.detectChanges();
    (
      compiled.querySelector('button[type=&quot;submit&quot;]') as HTMLButtonElement
    ).click();
    expect(createOrderSpy).toHaveBeenCalledWith(expectedOrderValue);
  });

  it('should show completed order when order is complete', () =&gt; {
    const expectedOrderValue: ReturnType&lt;FormGroup&lt;OrderForm&gt;['getRawValue']&gt; =
      {
        restaurant: '12345',
        name: 'Jennifer Hungry',
        address: '123 Main St',
        phone: '555-555-5555',
        items: [
          { name: 'Onion fries', price: 15.99 },
          { name: 'Roasted Salmon', price: 23.99 },
        ],
      };
    const compiled = fixture.nativeElement as HTMLElement;
    fixture.componentInstance.orderForm?.setValue(expectedOrderValue);
    fixture.detectChanges();
    (
      compiled.querySelector('button[type=&quot;submit&quot;]') as HTMLButtonElement
    ).click();
    fixture.detectChanges();
    const displayedOrder = compiled.querySelector('h3');
    expect(displayedOrder?.textContent).toEqual(
      'Thanks for your order Jennifer Hungry!'
    );
  });

  it('should clear the form values when create new order is clicked', () =&gt; {
    const expectedOrderValue: ReturnType&lt;FormGroup&lt;OrderForm&gt;['getRawValue']&gt; =
      {
        restaurant: '12345',
        name: 'Jennifer Hungry',
        address: '123 Main St',
        phone: '555-555-5555',
        items: [
          { name: 'Onion fries', price: 15.99 },
          { name: 'Roasted Salmon', price: 23.99 },
        ],
      };
    const compiled = fixture.nativeElement as HTMLElement;
    fixture.componentInstance.orderForm?.setValue(expectedOrderValue);
    fixture.detectChanges();
    (
      compiled.querySelector('button[type=&quot;submit&quot;]') as HTMLButtonElement
    ).click();
    fixture.detectChanges();
    (
      compiled.querySelector('button:nth-child(1)') as HTMLButtonElement
    ).click();
    const emptyform = {
      restaurant: '3ZOZyTY1LH26LnVw',
      name: '',
      address: '',
      phone: '',
      items: [],
    };
    expect(fixture.componentInstance.orderForm?.value).toEqual(emptyform);
  });
});

</code></pre>
 <div line-highlight="3,9-10,63-69,71-77,88,93,108-112,115,225-245,247-270,272-302,only"></div>
<blockquote>
<p>If you’ve implemented the solution correctly, when you run <code>npm run test</code> all tests will pass!</p>
</blockquote>
<h2>P3: What You Need to Know</h2>
<ul>
<li>How to import a service</li>
<li>How to call a method on a service and get the result</li>
<li>How to show/hide content using *ngIf</li>
</ul>
<h2>P3: Solution</h2>
<p><details>
<summary>Click to see the solution</summary>
✏️ Update <strong>src/app/order/order.component.ts</strong></p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import {
  AbstractControl,
  FormBuilder,
  FormControl,
  FormGroup,
  ValidationErrors,
  ValidatorFn,
  Validators,
} from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { Restaurant } from '../restaurant/restaurant';
import { RestaurantService } from '../restaurant/restaurant.service';
import { Order, OrderService } from './order.service';

export interface Item {
  name: string;
  price: number;
}

export interface OrderForm {
  restaurant: FormControl&lt;string&gt;;
  name: FormControl&lt;string&gt;;
  address: FormControl&lt;string&gt;;
  phone: FormControl&lt;string&gt;;
  items: FormControl&lt;Item[]&gt;;
}

// CUSTOM VALIDATION FUNCTION TO ENSURE THAT THE ITEMS FORM VALUE CONTAINS AT LEAST ONE ITEM.
function minLengthArray(min: number): ValidatorFn {
  return (c: AbstractControl): ValidationErrors | null =&gt; {
    if (c.value.length &gt;= min) {
      return null;
    }
    return { minLengthArray: { valid: false } };
  };
}

@Component({
  selector: 'pmo-order',
  templateUrl: './order.component.html',
  styleUrls: ['./order.component.less'],
})
export class OrderComponent implements OnInit, OnDestroy {
  orderForm?: FormGroup&lt;OrderForm&gt;;
  restaurant?: Restaurant;
  isLoading = true;
  orderTotal = 0.0;
  completedOrder?: Order;
  orderComplete = false;
  orderProcessing = false;
  private onDestroy$ = new Subject&lt;void&gt;();

  constructor(
    private route: ActivatedRoute,
    private restaurantService: RestaurantService,
    private orderService: OrderService,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    // GETTING THE RESTAURANT FROM THE ROUTE SLUG
    const slug = this.route.snapshot.paramMap.get('slug');

    if (slug) {
      this.restaurantService
        .getRestaurant(slug)
        .pipe(takeUntil(this.onDestroy$))
        .subscribe((data: Restaurant) =&gt; {
          this.restaurant = data;
          this.isLoading = false;
          this.createOrderForm();
        });
    }
  }

  ngOnDestroy(): void {
    this.onDestroy$.next();
    this.onDestroy$.complete();
  }

  createOrderForm(): void {
    this.orderForm = this.formBuilder.nonNullable.group({
      restaurant: [this.restaurant?._id ?? '', Validators.required],
      name: ['', Validators.required],
      address: ['', Validators.required],
      phone: ['', Validators.required],
      // PASSING OUR CUSTOM VALIDATION FUNCTION TO THIS FORM CONTROL
      items: [[] as Item[], minLengthArray(1)],
    });
    this.onChanges();
  }

  getChange(newItems: Item[]): void {
    this.orderForm?.controls.items.patchValue(newItems);
  }

  onChanges(): void {
    // WHEN THE ITEMS CHANGE WE WANT TO CALCULATE A NEW TOTAL
    this.orderForm?.controls.items.valueChanges
      .pipe(takeUntil(this.onDestroy$))
      .subscribe((val) =&gt; {
        let total = 0.0;
        if (val.length) {
          for (const item of val) {
            total += item.price;
          }
          this.orderTotal = Math.round(total * 100) / 100;
        } else {
          this.orderTotal = total;
        }
      });
  }

  onSubmit(): void {
    if (!this.orderForm?.valid) {
      return;
    }

    this.orderProcessing = true;
    this.orderService
      .createOrder(this.orderForm.getRawValue())
      .pipe(takeUntil(this.onDestroy$))
      .subscribe((res: Order) =&gt; {
        this.completedOrder = res;
        this.orderComplete = true;
        this.orderProcessing = false;
      });
  }

  startNewOrder(): void {
    this.orderComplete = false;
    this.completedOrder = undefined;
    this.orderTotal = 0.0;
    // CLEAR THE ORDER FORM
    this.createOrderForm();
  }
}

</code></pre>
 <div line-highlight="16,51,59,118-120,123-130,136,only"></div>
<p></details></p>

</section>

  			
  			<bit-prev-next class="footer" list-selector=".sidebar-left ul li.parent.expanded ul"></bit-prev-next>
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout discord">
          <h6>Get help</h6>
          <p>If you need <a href="https://discord.gg/J7ejFsZnJ4">help</a> with an exercise, please reach out to us on
             <a href="https://discord.gg/J7ejFsZnJ4">Discord</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com</a></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/angular/16-order-service/order-service.md"},"description":"Writing the Order Service ","name":"learn-angular/order-service","title":"Order Service","type":"page","parent":"learn-angular","order":16,"comment":" ","pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
  <div id="email-modal" role="dialog" aria-modal="true" aria-labelledby="dialog_label" style="display: none;">
    <div aria-hidden="true" class="email-modal-backdrop"></div>
    <div role="region" class="email-modal-content">
      <h2 id="dialog_label">Join the Bitovi Newsletter</h2>
      <p>
        Do you want to receive updates about new Bitovi Academy courses, Bitovi open source projects, and dev community news? If so, please provide your email. We won’t spam you or give it away for any reason!<br />
        <i style="font-size: 0.8rem;">By providing your email you agree to receive communications from Bitovi</i>
      </p>
      <div id="academy-hubspot-form-embed"></div>
      <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
      <button id="email-modal-close" title="dismiss"><img src="../static/img/close.svg" height="24" width="24"></button>
    </div>
  </div>
</body>
</html>
