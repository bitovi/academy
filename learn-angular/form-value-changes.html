<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/angular/9-form-value-changes/form-value-changes.md
	@page learn-angular/form-value-changes
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Learn how to listen to form value changes with Angular. 
">
  <title>Bitovi Academy - Filter Cities by State</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="why-angular.html"
							title="Why Angular is a great choice for modern web application development.">
							Why Angular
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-our-first-app.html"
							title="Learn how to generate an Angular application with it&#x27;s command line interface (CLI).">
							Generate an App
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-components.html"
							title="Learn how to create basic components in Angular and iterate through data using an Angular for loop.">
							Creating Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-pipes.html"
							title="Learn how to create a custom pipe in Angular that returns a modified version of a string.">
							Creating Pipes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="adding-routing.html"
							title="Learn how to add basic routing to components in an Angular application.">
							Adding Routing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-navigation.html"
							title="Learn how to create dynamic links with Angular that navigate to different parts of an application.">
							Creating Navigation
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="restaurant-service.html"
							title="Learn how to write an Angular service that gets data from the server.">
							Writing a Restaurant Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="pull-restaurant-data-into-view.html"
							title="Learn how to render API data into HTML with a view.">
							Use Restaurant API data
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="state-city-options.html"
							title="Learn how to create a Reactive Form with Angular. We will create a Reactive Form in the Restaurant component with city and state dropdown inputs.">
							City &amp; State Options
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="form-value-changes.html"
							title="Learn how to listen to form value changes with Angular.">
							Filter Cities by State
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="updating-service-params.html"
							title="Learn  how to make a service take multiple parameters.">
							Filter Restaurants by City
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="declarative-state.html"
							title="Modify Restaurants component to derive state via RxJS streams">
							Optional: Declarative State
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="writing-unit-tests.html"
							title="Write a unit test for a service in Angular">
							Writing Unit Tests
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="nested-routes.html"
							title="Creating nested restaurant routes">
							Nested Restaurant Routes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-order-form.html"
							title="Building the Order Form">
							Building the Order Form
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-service.html"
							title="Writing the Order Service">
							Order Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-history-component.html"
							title="Writing the Order History Component">
							Order History Component
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="real-time-connection.html"
							title="Updating Order History View with Real Time Connection">
							Real Time Connections
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="deploy-app.html"
							title="Deploying App">
							Deploy App
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Filter Cities by State <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Learn how to listen to form value changes with Angular.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2>Overview</h2>
<p>In this part, we will:</p>
<ul>
<li>Learn about Observables and Subscriptions</li>
<li>Learn about listening to form value changes</li>
<li>Learn about AbstractControl properties and methods</li>
<li>Create subscription to form changes</li>
<li>Use onDestroy to unsubscribe from form changes</li>
<li>Learn about HttpParams</li>
<li>Create new methods on our RestaurantService</li>
<li>Learn about Generics</li>
<li>Get state and city data in the Restaurant Component</li>
</ul>
<h2>Problem 1: Listen to Changes on the State and City formControls and log their value to the console</h2>
<p>Our end goal is to be able to show restaurants based on state, then city. As we move through getting each piece of information from the user we want to be able to update the next step - like getting a list of cities based on the state selected. We'll implement this form functionality in a few small steps.</p>
<h2>P1: What You Need to Know</h2>
<ul>
<li>How observables and subscriptions work</li>
<li>How to subscribe to the valueChanges method on a FormGroup (or FormControl)</li>
<li>How to unsubscribe from subscriptions</li>
</ul>
<h2>Observables and Subscriptions</h2>
<p>For a more robust understanding of Observables, Subscriptions, and other RxJS core tenants check out our [RxJS RxJS guide]. For the following exercises, Observables are lazy collections of multiple values over time. We can subscribe to observables to get any new data, or create and add to Subscriptions of observables.</p>
<p>This example shows creating a subscription to an observable, saving it's value to a member on the component and displaying it in the template. This is useful for when we want to capture and observables values and make changes based on them, but subscriptions do need to be cleaned up to avoid memory leaks. Whenever a component is destroyed an <a href="https://angular.io/api/core/OnDestroy" target="\_blank">ngOnDestroy</a> method is called. This is a good place to put our cleanup code, like unsubscribing from observables.</p>
<p>In this example, click the button to start subscribing to the observables - you'll see two variables logged: the new observable value and the subscription value. Then click the &quot;remove component&quot; button to see what happens when a component is destroyed. Next delete line 95, follow the same process and see what happens!</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, OnDestroy, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { Observable, Subscription } = rxjs;

@Injectable({
  providedIn: 'root'
})
class ObsService {

  constructor() { }

  getObs() {

    return new Observable&lt;number&gt;(observer =&gt; {
      console.log('New subscription created');
      let count = 0;
      
      const interval = setInterval(() =&gt; {
        count++;
        console.log(&quot;incrementing&quot;, count); 
        observer.next(count);
      }, 1000);
    
      return () =&gt; {
        clearInterval(interval);
        console.log('unsubscribed');
      }
    })
  }
}

@Component({
  selector: 'my-app',
  template: `
    &lt;destroy-component *ngIf=&quot;yayComponent&quot;&gt;&lt;/destroy-component&gt;
    &lt;button (click)=&quot;removeComponent()&quot; *ngIf=&quot;yayComponent&quot;&gt;remove component&lt;/button&gt;
    &lt;p *ngIf=&quot;!yayComponent&quot;&gt;I am a very sad empty component now&lt;/p&gt;
  `
})
class AppComponent implements OnInit{
  public yayComponent: boolean = true;
  constructor() {
  }
  
  ngOnInit() {
  }

  removeComponent() {
    this.yayComponent = false;
  }
}

@Component({
  selector: 'destroy-component',
  template: `
    &lt;p&gt;This component will be destroyed. Rawr.&lt;/p&gt;
    &lt;button (click)=&quot;startObservable()&quot;&gt;start observable&lt;/button&gt;

    &lt;p&gt;{{myDisplayValue}}&lt;/p&gt;
    `
})
class DestroyComponent implements OnInit, OnDestroy {
  $mySubscription: Subscription;
  myDisplayValue: string;
  
  constructor(private obsService: ObsService) {}

  ngOnInit() {}

  startObservable() {
    //subscribing to a service that emits observable values every second.
    this.$mySubscription = this.obsService.getObs().subscribe((val) =&gt; {
      console.log('new value', val);
      this.myDisplayValue = val;
    });
  }

  ngOnDestroy() {
    console.log('destroying component');
    if(this.$mySubscription) {
      this.$mySubscription.unsubscribe();
    }
  }
}   
DestroyComponent.parameters = [ObsService]; 
                 
@NgModule({
  declarations: [AppComponent, DestroyComponent],
  imports: [
    BrowserModule,
    CommonModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='14,17,49,50,62-64,71,73,77-78,80,84-90,92-97,only'></div>
<p>This example shows creating a subscription to an observable, and using an <a href="https://angular.io/api/common/AsyncPipe" target="\_blank">async pipe</a> to display the value. This is useful for displaying observable values in templates without the need to unsubscribe as that's handled by the pipe.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { Routes, RouterModule } = ng.router;
const { ReactiveFormsModule, FormControl, FormGroup, FormBuilder } = ng.forms;
const { Observable, Subscription } = rxjs;


@Component({
  selector: 'my-app',
  template: `
    &lt;ul class=&quot;nav&quot;&gt;
      &lt;li routerLinkActive=&quot;active&quot;&gt;
        &lt;a routerLink=&quot;/about&quot; &gt;About&lt;/a&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
    &lt;router-outlet&gt;&lt;/router-outlet&gt;
  `
})
class AppComponent {
  constructor() {}
}

@Component({
  selector: 'about-component',
  template: `
    &lt;p&gt;An about component!&lt;/p&gt;
  `
})
class AboutComponent {
  constructor() {
  }
}

@Component({
  selector: 'home-component',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;

    {{$mySubscription | async }}
    `
})
class HomeComponent implements OnInit{
  $myObservable: Observable&lt;string&gt;;
  $mySubscription: Subscription;
  
  constructor(private fb:FormBuilder) {
  
  }

  ngOnInit() {
    this.$myObservable = new Observable(observer =&gt; {
      setTimeout(() =&gt; {
          observer.next('hello observable');
      }, 1000);

      setTimeout(() =&gt; {
          observer.next('how are you');
      }, 2000);

      setTimeout(() =&gt; {
          observer.complete();
      }, 3000);
  });

   this.$mySubscription = this.$myObservable;

  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
HomeComponent.parameters = [FormBuilder];


const routes: Routes = [
  { path: 'about', component: AboutComponent },
  { path: '**', component: HomeComponent }
]
@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
class AppRoutingModule { }

                 
@NgModule({
  declarations: [AppComponent, AboutComponent, HomeComponent],
  imports: [
    BrowserModule,
    CommonModule,
    AppRoutingModule, 
    ReactiveFormsModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='53,57,58,65-76,79,only'></div>
<p>This example creates a subscription, then adds to it.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { Routes, RouterModule } = ng.router;
const { ReactiveFormsModule, FormControl, FormGroup, FormBuilder } = ng.forms;
const { Observable, Subscription } = rxjs;


@Component({
  selector: 'my-app',
  template: `
    &lt;ul class=&quot;nav&quot;&gt;
      &lt;li routerLinkActive=&quot;active&quot;&gt;
        &lt;a routerLink=&quot;/about&quot; &gt;About&lt;/a&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
    &lt;router-outlet&gt;&lt;/router-outlet&gt;
  `
})
class AppComponent {
  constructor() {}
}

@Component({
  selector: 'about-component',
  template: `
    &lt;p&gt;An about component!&lt;/p&gt;
  `
})
class AboutComponent {
  constructor() {
  }
}

@Component({
  selector: 'home-component',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;

    &lt;p&gt;{{myDisplayValue}}&lt;/p&gt;

    &lt;p&gt;{{myOtherDisplayValue}}&lt;/p&gt;
    `
})
class HomeComponent implements OnInit{
  $myObservable: Observable&lt;string&gt;;
  $myOtherObservable: Observable&lt;string&gt;;
  $mySubscription: Subscription;
  myDisplayValue: string;
  myOtherDisplayValue: string;
  
  constructor(private fb:FormBuilder) {
  
  }

  ngOnInit() {
    this.$myObservable = new Observable(observer =&gt; {
      setTimeout(() =&gt; {
          observer.next('hello observable');
      }, 1000);

      setTimeout(() =&gt; {
          observer.next('how are you');
      }, 2000);

      setTimeout(() =&gt; {
          observer.complete();
      }, 3000);
    });

    this.$myOtherObservable = new Observable(observer =&gt; {
      setTimeout(() =&gt; {
          observer.next('hello other observable');
      }, 1500);

      setTimeout(() =&gt; {
          observer.next('I am good');
      }, 2500);

      setTimeout(() =&gt; {
          observer.complete();
      }, 3500);
    });

    //creating the first subscription
    this.$mySubscription = this.$myObservable.subscribe((val) =&gt; {
      this.myDisplayValue = val;
    });

    //taking the first subscription and adding another to it
    this.$mySubscription.add(this.$myOtherObservable.subscribe((val) =&gt; {
      this.myOtherDisplayValue = val;
    }));
   
  }

  ngOnDestroy() {
    this.$mySubscription.unsubscribe();
  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
HomeComponent.parameters = [FormBuilder];


const routes: Routes = [
  { path: 'about', component: AboutComponent },
  { path: '**', component: HomeComponent }
]
@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
class AppRoutingModule { }

                 
@NgModule({
  declarations: [AppComponent, AboutComponent, HomeComponent],
  imports: [
    BrowserModule,
    CommonModule,
    AppRoutingModule, 
    ReactiveFormsModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='98-101,103-106,only'></div>
<h2>Listening to Form Changes</h2>
<p>We can listen to changes to values on FormControls and FormGroup using the valueChanges method, which emits an observable. The following example subscribes to any changes to the FormGroup (which must be unsubscribed on destroy to avoid memory leaks) and also subscribes to a single FormControl and displays the value using an async pipe.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { ReactiveFormsModule, FormControl, FormGroup, FormBuilder } = ng.forms;

@Component({
  selector: 'my-app',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;
    &lt;form [formGroup]=&quot;myQuickForm&quot;&gt;
      &lt;label&gt;
          First name:
          &lt;input type=&quot;text&quot; formControlName=&quot;firstName&quot;&gt;
        &lt;/label&gt;
        &lt;label&gt;
          Last name:
          &lt;input type=&quot;text&quot; formControlName=&quot;lastName&quot;&gt;
        &lt;/label&gt;
        &lt;label&gt;
          Email:
          &lt;input type=&quot;text&quot; formControlName=&quot;email&quot;&gt;
        &lt;/label&gt;
    &lt;/form&gt;
  `
})
class AppComponent {
  myQuickForm: FormGroup;

  constructor(private fb:FormBuilder) {
  
  }

  ngOnInit() {
    this.myQuickForm = this.fb.group({
      firstName: {value: '', disabled: false},
      lastName: {value: '', disabled: false},
      email: {value: '', disabled: false}
    });

    this.myQuickForm.valueChanges.subscribe((val) =&gt; {
      console.log(val);
    });
  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
AppComponent.parameters = [FormBuilder];
            
@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    CommonModule,
    ReactiveFormsModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='53-55,only'></div>
<h2>Call Methods on FormControls</h2>
<p>The ReactiveForms API makes it easy for us to change our FormControls as needed. As a reminder, the FormControl class extends the <a href="https://angular.io/api/forms/AbstractControl">AbstractControl</a> class which has a lot of helpful properties and methods on it. The following example shows enabling and disabling controls via the <code>enable</code> and <code>disable</code> methods, and displaying the <code>enabled</code> FormControl property.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/forms@7.2.0/bundles/forms.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { ReactiveFormsModule, FormControl, FormGroup, FormBuilder } = ng.forms;

@Component({
  selector: 'my-app',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;
    &lt;form [formGroup]=&quot;myQuickForm&quot;&gt;
      &lt;label&gt;
          First name:
          &lt;input type=&quot;text&quot; formControlName=&quot;firstName&quot;&gt;
          &lt;p&gt;this control is enabled: {{myQuickForm.controls.firstName.enabled}}&lt;/p&gt;
          &lt;button (click)=&quot;toggleControl(myQuickForm.controls.firstName)&quot;&gt;toggle firstName control&lt;/button&gt;&lt;br /&gt;
        &lt;/label&gt;
        &lt;label&gt;
          Last name:
          &lt;input type=&quot;text&quot; formControlName=&quot;lastName&quot;&gt;
          &lt;p&gt;this control is enabled: {{myQuickForm.controls.lastName.enabled}}&lt;/p&gt;
          &lt;button (click)=&quot;toggleControl(myQuickForm.controls.lastName)&quot;&gt;toggle lastName control&lt;/button&gt;&lt;br /&gt;
        &lt;/label&gt;
        &lt;label&gt;
          Email:
          &lt;input type=&quot;text&quot; formControlName=&quot;email&quot;&gt;
          &lt;p&gt;this control is enabled: {{myQuickForm.controls.email.enabled}}&lt;/p&gt;
          &lt;button (click)=&quot;toggleControl(myQuickForm.controls.email)&quot;&gt;toggle email control&lt;/button&gt;&lt;br /&gt;
        &lt;/label&gt;
    &lt;/form&gt;

  `
})
class AppComponent {
  myQuickForm: FormGroup;

  constructor(private fb:FormBuilder) {}

  ngOnInit() {
    this.myQuickForm = this.fb.group({
      firstName: {value: '', disabled: false},
      lastName: {value: '', disabled: false},
      email: {value: '', disabled: false}
    });

    this.myQuickForm.valueChanges.subscribe((val) =&gt; {
      console.log(val);
    });
  }

  toggleControl(control) {
    let ctrl = control as FormControl;
    if(ctrl.enabled) {
      ctrl.disable();
    }
    else {
      ctrl.enable();
    }
  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
AppComponent.parameters = [FormBuilder];
            
@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    CommonModule,
    ReactiveFormsModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='27-28,33-34,39-40,63-71,only'></div>
<h2>P1: Technical Requirements</h2>
<ol>
<li>Subscribe to the <code>state</code> and <code>city</code> formControl value changes and log the resulting value to the console.</li>
<li>Unsubscribe from subscription created in step 1 in the <code>ngOnDestroy</code> function</li>
</ol>
<h2>P1: To Verify Your Solution is Correct</h2>
<p>When you interact with the dropdown menus, you should see their values logged to the console as you change them.</p>
<h2>P1: Solution</h2>
<p>✏️ Update <strong>src/app/restaurant/restaurant.component.ts</strong></p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import { FormBuilder, FormGroup } from '@angular/forms';
import { Subscription } from 'rxjs';

import { RestaurantService, ResponseData } from './restaurant.service';
import { Restaurant } from './restaurant';

export interface Data {
  value: Array&lt;Restaurant&gt;;
  isPending: boolean;
}

@Component({
  selector: 'pmo-restaurant',
  templateUrl: './restaurant.component.html',
  styleUrls: ['./restaurant.component.less']
})
export class RestaurantComponent implements OnInit, OnDestroy {
  form: FormGroup;

  public restaurants: Data = {
    value: [],
    isPending: false
  }

  public states = {
    isPending: false,
    value: [{name: &quot;Illinois&quot;, short: &quot;IL&quot;}, {name: &quot;Wisconsin&quot;, short: &quot;WI&quot;}]
  };

  public cities = {
    isPending: false,
    value: [{name: &quot;Springfield&quot;},{name: &quot;Madison&quot;}]
  }

  private subscription: Subscription;

  constructor(
    private restaurantService: RestaurantService,
    private fb: FormBuilder
    ) {
  }

  ngOnInit() {
    this.createForm();

    this.restaurantService.getRestaurants().subscribe((res: ResponseData) =&gt; {
      this.restaurants.value = res.data;
      this.restaurants.isPending = false;
    });
  }

  ngOnDestroy() {
    if(this.subscription) {
      this.subscription.unsubscribe();
    }
  }

  createForm() {
    this.form = this.fb.group({
      state: {value: '', disabled: false},
      city: {value: '', disabled: false},
    });

    this.onChanges();
  }
  onChanges(): void {
    const stateChanges = this.form.get('state').valueChanges.subscribe(val =&gt; {
      console.log('state', val);
    });
    this.subscription = stateChanges;


    const cityChanges = this.form.get('city').valueChanges.subscribe(val =&gt; {
      console.log('city', val);
    });
    this.subscription.add(cityChanges);
  }
}

</code></pre>
<div line-highlight='1,3,18,36,53-57,65,67-78'></div>
<p>Now that we know how to get values from our dropdowns, let's populate them with real data. We can get our list of states immediately, but to get our cities, we'll want to make an get request based on the state the user selected.</p>
<h2>Problem 2: Write Service Methods to Get States and Cities from API</h2>
<p>We want to be able to get lists of cities and states from our API to populate the dropdown options.</p>
<h2>P2: What You Need to Know</h2>
<h2>How to use HttpParams</h2>
<p><a href="https://angular.io/api/common/http/HttpParams" target="\_blank">HttpParams</a> are part of Angulars HTTPClient API and help us create parameters for our requests.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common-http.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit, Injectable } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;
const { HttpClient, HttpParams, HttpClientModule } = ng.common.http

interface User {
  name: string;
  id: number;
  role: string;
}

@Injectable({
  providedIn: 'root'
})
class UsersService {

  constructor(private httpClient: HttpClient) { }

  getUsers() {
    const params = new HttpParams()
    params.set('_page', &quot;1&quot;).set('_limit', &quot;1&quot;);
    return this.httpClient.get&lt;any&gt;('/api/users', {params});
  }

  getUser(id: number) {
    return this.httpClient.get&lt;any&gt;('/api/users/' + id);
  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
//UsersService.parameters = [HttpClient];

@Component({
  selector: 'my-app',
  template: `
    &lt;p&gt;A home component!&lt;/p&gt;
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let user of users&quot;&gt;
        {{user.name}}
      &lt;/li&gt;
    &lt;/ul&gt;
  `
})
class AppComponent implements OnInit{
  public user: User;

  constructor(private usersService: UsersService) {}

  ngOnInit() {
    this.user = this.usersService.getUser(1);
  }
}
//THIS IS A HACK JUST FOR CODEPEN TO WORK
AppComponent.parameters = [UsersService];

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    CommonModule,
    HttpClientModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;

</code></pre>
<div class='codepen'></div>
<div line-highlight='33-34,only'></div>
<h2>P2: Technical Requirements</h2>
<p>Write two new methods in the <code>RestaurantsService</code> to get state and city lists.</p>
<p>Method 1 - <code>getStates</code> takes no params and makes a request to <code>'/api/states'</code></p>
<p>Method 2 - <code>getCities</code>, takes a string param called 'state' a makes a request to <code>'/api/cities?state=&quot;{state abbreviation here}&quot;'</code></p>
<h2>P2: How to Verify Your Solution is Correct</h2>
<p>✏️ Update the spec file  <strong>src/app/restaurant/restaurant.service.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { TestBed } from '@angular/core/testing';

import { ResponseData, RestaurantService } from './restaurant.service';
import { Restaurant } from './restaurant';
import { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';

describe('RestaurantService', () =&gt; {
  let httpMock : HttpTestingController;
  let restaurantService: RestaurantService;

  beforeEach(() =&gt; TestBed.configureTestingModule({
    imports: [HttpClientTestingModule],
    providers: [
      RestaurantService
    ]
  }));

  beforeEach(() =&gt; {
    httpMock = TestBed.get(HttpTestingController);
    restaurantService = TestBed.get(RestaurantService);
  })

  it('should be created', () =&gt; {
    expect(restaurantService).toBeTruthy();
  });
 
  it('should make a get request to restaurants', () =&gt; {
    const mockRestaurants = {
      data: [{
      &quot;name&quot;:&quot;Brunch Place&quot;,
      &quot;slug&quot;:&quot;brunch-place&quot;,
      &quot;images&quot;:{
        &quot;thumbnail&quot;:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
        &quot;owner&quot;:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
        &quot;banner&quot;:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;},
        &quot;menu&quot;:{
          &quot;lunch&quot;:[
            {&quot;name&quot;:&quot;Ricotta Gnocchi&quot;,&quot;price&quot;:15.99},
            {&quot;name&quot;:&quot;Garlic Fries&quot;,&quot;price&quot;:15.99},
            {&quot;name&quot;:&quot;Charred Octopus&quot;,&quot;price&quot;:25.99}
          ],
          &quot;dinner&quot;:[
            {&quot;name&quot;:&quot;Steamed Mussels&quot;,&quot;price&quot;:21.99},
            {&quot;name&quot;:&quot;Roasted Salmon&quot;,&quot;price&quot;:23.99},
            {&quot;name&quot;:&quot;Crab Pancakes with Sorrel Syrup&quot;,&quot;price&quot;:35.99}
          ]
        },
        &quot;address&quot;:{
          &quot;street&quot;:&quot;2451 W Washburne Ave&quot;,
          &quot;city&quot;:&quot;Ann Arbor&quot;,&quot;state&quot;:&quot;MI&quot;,&quot;zip&quot;:&quot;53295&quot;},
          &quot;_id&quot;:&quot;xugqxQIX5rPJTLBv&quot;
        },
        {
          &quot;name&quot;:&quot;Taco Joint&quot;,
          &quot;slug&quot;:&quot;taco-joint&quot;,
          &quot;images&quot;:{
            &quot;thumbnail&quot;:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
            &quot;owner&quot;:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
            &quot;banner&quot;:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;},
            &quot;menu&quot;:{
              &quot;lunch&quot;:[
                {&quot;name&quot;:&quot;Beef Tacos&quot;,&quot;price&quot;:15.99},
                {&quot;name&quot;:&quot;Chicken Tacos&quot;,&quot;price&quot;:15.99},
                {&quot;name&quot;:&quot;Guacamole&quot;,&quot;price&quot;:25.99}
              ],
              &quot;dinner&quot;:[
                {&quot;name&quot;:&quot;Shrimp Tacos&quot;,&quot;price&quot;:21.99},
                {&quot;name&quot;:&quot;Chicken Enchilada&quot;,&quot;price&quot;:23.99},
                {&quot;name&quot;:&quot;Elotes&quot;,&quot;price&quot;:35.99}
              ]
            },
            &quot;address&quot;:{
              &quot;street&quot;:&quot;13 N 21st St&quot;,
              &quot;city&quot;:&quot;Chicago&quot;,&quot;state&quot;:&quot;IL&quot;,&quot;zip&quot;:&quot;53295&quot;},
              &quot;_id&quot;:&quot;xugqxQIX5dfgdgTLBv&quot;
            }]
          };

    restaurantService.getRestaurants().subscribe((restaurants:ResponseData) =&gt; {
      expect(restaurants).toEqual(mockRestaurants);
    });

    let url = '/api/restaurants';
    const req = httpMock.expectOne(url);


    expect(req.request.method).toEqual('GET');
    req.flush(mockRestaurants);

    httpMock.verify();
  });

  it('can set proper properties on restaurant type', () =&gt; {
    let restaurant: Restaurant = {
      name:&quot;Taco Joint&quot;,
      slug:&quot;taco-joint&quot;,
      images:{
        thumbnail:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
        owner:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
        banner:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
      },
      menu:{
        lunch:[
          {name:&quot;Beef Tacos&quot;,&quot;price&quot;:15.99},
          {name:&quot;Chicken Tacos&quot;,&quot;price&quot;:15.99},
          {name:&quot;Guacamole&quot;,&quot;price&quot;:25.99}
        ],
        dinner:[
          {name:&quot;Shrimp Tacos&quot;,&quot;price&quot;:21.99},
          {name:&quot;Chicken Enchilada&quot;,&quot;price&quot;:23.99},
          {name:&quot;Elotes&quot;,&quot;price&quot;:35.99}
        ]
      },
      address:{
        street:&quot;13 N 21st St&quot;,
        city:&quot;Chicago&quot;,&quot;state&quot;:&quot;IL&quot;,&quot;zip&quot;:&quot;53295&quot;
      },
      _id:&quot;xugqxQIX5dfgdgTLBv&quot;
    }
    //will error if interface isn't implemented correctly
    expect(true).toBe(true);
  });

  it('should make a get request to states', () =&gt; {
    const mockStates = {
      data: [
        {name: 'Missouri', short: 'MO'}
      ]
    };

    restaurantService.getStates().subscribe((states) =&gt; {
      expect(states).toEqual(mockStates);
    });

    let url = '/api/states';
    const req = httpMock.expectOne(url);

    expect(req.request.method).toEqual('GET');
    req.flush(mockStates);

    httpMock.verify();
  });

  it('should make a get request to cities', () =&gt; {
    const mockCities = {
      data: [
        {name: 'Kansas City', state: 'MO'}
      ]
    };

    restaurantService.getCities('MO').subscribe((cities) =&gt; {
      expect(cities).toEqual(mockCities);
    });

    let url = '/api/cities?state=MO';
    const req = httpMock.expectOne(url);
    expect(req.request.method).toEqual('GET');
    req.flush(mockCities);

    httpMock.verify();
  });

});
</code></pre>
<div line-highlight='124-161'></div>
<blockquote>
<p>If you've implemented the solution correctly, when you run <code>npm run test</code> all tests will pass!</p>
</blockquote>
<h2>P2: Solution</h2>
<p>✏️ Update <strong>src/app/restaurant/restaurant.service.ts</strong></p>
<pre><code class="language-ts">import { Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Restaurant } from './restaurant';

export interface ResponseData {
  data: Restaurant[];
}

@Injectable({
  providedIn: 'root'
})
export class RestaurantService {

  constructor(private httpClient: HttpClient) { }

  getRestaurants() {
    return this.httpClient.get&lt;ResponseData&gt;('/api/restaurants');
  }

  getStates() {
    return this.httpClient.get&lt;any&gt;('/api/states');
  }

  getCities(state:string) {
    const params = new HttpParams().set('state', state);
    return this.httpClient.get&lt;any&gt;('/api/cities', {params});
  }
}
</code></pre>
<div line-highlight='2,20-22,24-27'></div>
<h2>Problem 3: Use Generics to Modify ResponseData interface to Work with States and Cities Data</h2>
<p>We would like to use the <code>ResponseData</code> interface we wrote to describe the response for the state and city requests, but it only works with and array of type <code>Restaurant</code>.</p>
<h2>P3: What You Need to Know</h2>
<h2>How to write a generic</h2>
<p>For an in-depth understanding of generics in TypeScript, check out our <a href="../learn-typescript/generics.html" title="Learn about what Generics are, why they are useful, and how to create a linked list using Generics in TypeScript.">TypeScript guide</a>. For now, generics are a way to abstract functions, interfaces, etc to use different types in different situations.</p>
<p>This example shows creating a generic for a list that can be used to create arrays of various types, including Dinosaurs. Codepen doesn't have a typescript compiler that will throw errors, but if you paste the code into your IDE you'll be able to see the TypeScript errors thrown.</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/core-js/2.5.7/core.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/core@7.2.0/bundles/core.umd.js&quot;/&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/zone.js/0.8.26/zone.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/common@7.2.0/bundles/common-http.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/compiler@7.2.0/bundles/compiler.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/router@7.2.0/bundles/router.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser@7.2.0/bundles/platform-browser.umd.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/@angular/platform-browser-dynamic@7.2.0/bundles/platform-browser-dynamic.umd.js&quot;&gt;&lt;/script&gt;
&lt;base href=&quot;/&quot;&gt;
&lt;my-app&gt;&lt;/my-app&gt;
&lt;script type=&quot;typescript&quot;&gt;
const { Component, NgModule, VERSION, OnInit } = ng.core;
const { BrowserModule } = ng.platformBrowser;
const { CommonModule } = ng.common;

class GenericCollection&lt;T&gt; {
  private list: T[] = [];
  pushItem(thing:T) {
    this.list.push(thing);
  }
}

interface Dinosaur {
  name: string;
  breed: string;
  teeth: number;
}

@Component({
  selector: 'my-app',
  template: `
    &lt;p&gt;My strings&lt;/p&gt;
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let string of myListOfStrings; let i=index&quot;&gt;{{string}}&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;My dinosaurs&lt;/p&gt;
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let dino of myListOfDinosaurs; let i=index&quot;&gt;{{dino.name}} is a {{dino.breed}} and has {{dino.teeth}} teeth.&lt;/li&gt;
    &lt;/ul&gt;
  `
})
class AppComponent implements OnInit {
  public myListOfStrings = new GenericCollection&lt;string&gt;();
  public myListOfDinosaurs = new GenericCollection&lt;Dinosaur&gt;();

  constructor() {}

  ngOnInit() {
    this.myListOfStrings.pushItem('booop');
    this.myListOfStrings.pushItem('TA DA');
    this.myListOfStrings.pushItem(5);
    //error Argument type of '5' is not assignable to parameter of type 'string'

    let dinoA = {
      name: 'Blue',
      breed: 'Velociraptor',
      teeth: 100
    }

    let dinoB = {
      name: 'Killorex',
      breed: 'Tyranasuarus Rex',
      teeth: 95
    }
    this.myListOfDinosaurs.pushItem(dinoA);
    this.myListOfDinosaurs.pushItem(dinoB);
    this.myListOfDinosaurs.pushItem({name: 'Charlie'});
    //error Argument type '{ name: string; }' is not assignable to parameter of type 'Dinosaur'.
  }

}

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    CommonModule
  ],
  bootstrap: [AppComponent],
  providers: []
})
class AppModule {}

const { platformBrowserDynamic } = ng.platformBrowserDynamic;

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .catch(err =&gt; console.error(err));
&lt;/script&gt;


</code></pre>
<div class='codepen'></div>
<div line-highlight='18-23,25-29,36,41,46,47,51-55,57-61,63-67,68-71,only'></div>
<h2>P3: Technical Requirements</h2>
<p>Convert the <code>ResponseData</code> interface use generics so it can take a type of <code>Restaurant</code>, <code>State</code>, or <code>City</code>. We've written the state &amp; city interfaces for you.</p>
<h2>P3: Setup</h2>
<p>✏️ Update your <strong>src/app/restaurant/restaurant.service.ts</strong> file to be:</p>
<pre><code class="language-ts">import { Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Restaurant } from './restaurant';

export interface ResponseData {
  data: Restaurant[];
}

export interface State {
  name: string;
  short: string;
}

export interface City {
  name: string;
  state: string;
}

@Injectable({
  providedIn: 'root'
})
export class RestaurantService {

  constructor(private httpClient: HttpClient) { }

  getRestaurants() {
    return this.httpClient.get&lt;ResponseData&gt;('/api/restaurants');
  }

  getStates() {
    return this.httpClient.get&lt;any&gt;('/api/states');
  }

  getCities(state:string) {
    const params = new HttpParams().set('state', state);
    return this.httpClient.get&lt;any&gt;('/api/cities', {params});
  }
}
</code></pre>
<div line-highlight='9-12, 14-17'></div>
<h2>P3: How to Verify Your Solution is Correct</h2>
<p>✏️ Update the spec file  <strong>src/app/restaurant/restaurant.service.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { TestBed } from '@angular/core/testing';

import { ResponseData, RestaurantService, State, City } from './restaurant.service';
import { Restaurant } from './restaurant';
import { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';

describe('RestaurantService', () =&gt; {
  let httpMock : HttpTestingController;
  let restaurantService: RestaurantService;

  beforeEach(() =&gt; TestBed.configureTestingModule({
    imports: [HttpClientTestingModule],
    providers: [
      RestaurantService
    ]
  }));

  beforeEach(() =&gt; {
    httpMock = TestBed.get(HttpTestingController);
    restaurantService = TestBed.get(RestaurantService);
  })

  it('should be created', () =&gt; {
    expect(restaurantService).toBeTruthy();
  });
 
  it('should make a get request to restaurants', () =&gt; {
    const mockRestaurants = {
      data: [{
      &quot;name&quot;:&quot;Brunch Place&quot;,
      &quot;slug&quot;:&quot;brunch-place&quot;,
      &quot;images&quot;:{
        &quot;thumbnail&quot;:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
        &quot;owner&quot;:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
        &quot;banner&quot;:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;},
        &quot;menu&quot;:{
          &quot;lunch&quot;:[
            {&quot;name&quot;:&quot;Ricotta Gnocchi&quot;,&quot;price&quot;:15.99},
            {&quot;name&quot;:&quot;Garlic Fries&quot;,&quot;price&quot;:15.99},
            {&quot;name&quot;:&quot;Charred Octopus&quot;,&quot;price&quot;:25.99}
          ],
          &quot;dinner&quot;:[
            {&quot;name&quot;:&quot;Steamed Mussels&quot;,&quot;price&quot;:21.99},
            {&quot;name&quot;:&quot;Roasted Salmon&quot;,&quot;price&quot;:23.99},
            {&quot;name&quot;:&quot;Crab Pancakes with Sorrel Syrup&quot;,&quot;price&quot;:35.99}
          ]
        },
        &quot;address&quot;:{
          &quot;street&quot;:&quot;2451 W Washburne Ave&quot;,
          &quot;city&quot;:&quot;Ann Arbor&quot;,&quot;state&quot;:&quot;MI&quot;,&quot;zip&quot;:&quot;53295&quot;},
          &quot;_id&quot;:&quot;xugqxQIX5rPJTLBv&quot;
        },
        {
          &quot;name&quot;:&quot;Taco Joint&quot;,
          &quot;slug&quot;:&quot;taco-joint&quot;,
          &quot;images&quot;:{
            &quot;thumbnail&quot;:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
            &quot;owner&quot;:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
            &quot;banner&quot;:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;},
            &quot;menu&quot;:{
              &quot;lunch&quot;:[
                {&quot;name&quot;:&quot;Beef Tacos&quot;,&quot;price&quot;:15.99},
                {&quot;name&quot;:&quot;Chicken Tacos&quot;,&quot;price&quot;:15.99},
                {&quot;name&quot;:&quot;Guacamole&quot;,&quot;price&quot;:25.99}
              ],
              &quot;dinner&quot;:[
                {&quot;name&quot;:&quot;Shrimp Tacos&quot;,&quot;price&quot;:21.99},
                {&quot;name&quot;:&quot;Chicken Enchilada&quot;,&quot;price&quot;:23.99},
                {&quot;name&quot;:&quot;Elotes&quot;,&quot;price&quot;:35.99}
              ]
            },
            &quot;address&quot;:{
              &quot;street&quot;:&quot;13 N 21st St&quot;,
              &quot;city&quot;:&quot;Chicago&quot;,&quot;state&quot;:&quot;IL&quot;,&quot;zip&quot;:&quot;53295&quot;},
              &quot;_id&quot;:&quot;xugqxQIX5dfgdgTLBv&quot;
            }]
          };

    restaurantService.getRestaurants().subscribe((restaurants:ResponseData&lt;Restaurant&gt;) =&gt; {
      expect(restaurants).toEqual(mockRestaurants);
    });

    let url = '/api/restaurants';
    const req = httpMock.expectOne(url);


    expect(req.request.method).toEqual('GET');
    req.flush(mockRestaurants);

    httpMock.verify();
  });

  it('can set proper properties on restaurant type', () =&gt; {
    let restaurant: Restaurant = {
      name:&quot;Taco Joint&quot;,
      slug:&quot;taco-joint&quot;,
      images:{
        thumbnail:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
        owner:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
        banner:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
      },
      menu:{
        lunch:[
          {name:&quot;Beef Tacos&quot;,&quot;price&quot;:15.99},
          {name:&quot;Chicken Tacos&quot;,&quot;price&quot;:15.99},
          {name:&quot;Guacamole&quot;,&quot;price&quot;:25.99}
        ],
        dinner:[
          {name:&quot;Shrimp Tacos&quot;,&quot;price&quot;:21.99},
          {name:&quot;Chicken Enchilada&quot;,&quot;price&quot;:23.99},
          {name:&quot;Elotes&quot;,&quot;price&quot;:35.99}
        ]
      },
      address:{
        street:&quot;13 N 21st St&quot;,
        city:&quot;Chicago&quot;,&quot;state&quot;:&quot;IL&quot;,&quot;zip&quot;:&quot;53295&quot;
      },
      _id:&quot;xugqxQIX5dfgdgTLBv&quot;
    }
    //will error if interface isn't implemented correctly
    expect(true).toBe(true);
  });

  it('should make a get request to states', () =&gt; {
    const mockStates = {
      data: [
        {name: 'Missouri', short: 'MO'}
      ]
    };

    restaurantService.getStates().subscribe((states:ResponseData&lt;State&gt;) =&gt; {
      expect(states).toEqual(mockStates);
    });

    let url = '/api/states';
    const req = httpMock.expectOne(url);

    expect(req.request.method).toEqual('GET');
    req.flush(mockStates);

    httpMock.verify();
  });

  it('should make a get request to cities', () =&gt; {
    const mockCities = {
      data: [
        {name: 'Kansas City', state: 'MO'}
      ]
    };

    restaurantService.getCities('MO').subscribe((cities:ResponseData&lt;City&gt;) =&gt; {
      expect(cities).toEqual(mockCities);
    });

    let url = '/api/cities?state=MO';
    const req = httpMock.expectOne(url);
    expect(req.request.method).toEqual('GET');
    req.flush(mockCities);

    httpMock.verify();
  });

});
</code></pre>
<div line-highlight='3,79,131,151, only'></div>
<h2>P3: Solution</h2>
<p>✏️ Update <strong>src/app/restaurant/restaurant.service.ts</strong></p>
<pre><code class="language-ts">import { Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Restaurant } from './restaurant';

export interface ResponseData&lt;dataType&gt; {
  data: Array&lt;dataType&gt;;
}

export interface State {
  name: string;
  short: string;
}

export interface City {
  name: string;
  state: string;
}

@Injectable({
  providedIn: 'root'
})
export class RestaurantService {

  constructor(private httpClient: HttpClient) { }

  getRestaurants() {
    return this.httpClient.get&lt;ResponseData&lt;Restaurant&gt;&gt;('/api/restaurants');
  }

  getStates() {
    return this.httpClient.get&lt;ResponseData&lt;State&gt;&gt;('/api/states');
  }

  getCities(state:string) {
    const params = new HttpParams().set('state', state);
    return this.httpClient.get&lt;ResponseData&lt;City&gt;&gt;('/api/cities', {params});
  }
}
</code></pre>
<div line-highlight='5-7,27,31,36'></div>
<h2>Problem 4: Get Cities and States Based on Dropdown Values</h2>
<p>Now that our service is in working order, let's populate our dropdowns with state and city data. We will want our list of states to be available right away, but we will want to fetch our list of cities only after we have the state value selected by the user.</p>
<h2>P4: Technical Requirements</h2>
<ol>
<li>Rewrite the <code>Data</code> interface to be a generic to work with State and City types as well</li>
<li>Mark state and city dropdowns as disabled until they are populated with data</li>
<li>Fetch the states list when the component first loads (<code>ngOnInit</code>) and populate the dropdown options with the values</li>
<li>When the State FormControl value changes, fetch the list of cities with the selected state as the parameter</li>
<li>If the state value changes, fetch the new list of cities, and reset the list of restaurants to an empty array</li>
<li>When a City is selected, fetch the list of restaurants</li>
</ol>
<blockquote>
<p>Hint: You'll want to clear the fake data from the state and city value props, and move the call to get restaurants out of the ngOnInit function.</p>
</blockquote>
<h2>P4: How to Verify Your Solution is Correct</h2>
<p>✏️ Update the spec file  <strong>src/app/restaurant/restaurant.component.spec.ts</strong> to be:</p>
<pre><code class="language-ts">import { async, ComponentFixture, TestBed, tick, fakeAsync } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs'; 

import { RestaurantComponent } from './restaurant.component';
import { RestaurantService } from './restaurant.service';
import { ImageUrlPipe } from '../image-url.pipe';
import { ReactiveFormsModule } from '@angular/forms';

class MockRestaurantService {
  getRestaurants() {
    return of({
      data: [{
        &quot;name&quot;: &quot;Poutine Palace&quot;,
        &quot;slug&quot;: &quot;poutine-palace&quot;,
        &quot;images&quot;: {
          &quot;thumbnail&quot;: &quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
          &quot;owner&quot;: &quot;node_modules/place-my-order-assets/images/3-owner.jpg&quot;,
          &quot;banner&quot;: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
        },
        &quot;menu&quot;: {
          &quot;lunch&quot;: [
            {
              &quot;name&quot;: &quot;Crab Pancakes with Sorrel Syrup&quot;,
              &quot;price&quot;: 35.99
            },
            {
              &quot;name&quot;: &quot;Steamed Mussels&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Spinach Fennel Watercress Ravioli&quot;,
              &quot;price&quot;: 35.99
            }
          ],
          &quot;dinner&quot;: [
            {
              &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Herring in Lavender Dill Reduction&quot;,
              &quot;price&quot;: 45.99
            },
            {
              &quot;name&quot;: &quot;Chicken with Tomato Carrot Chutney Sauce&quot;,
              &quot;price&quot;: 45.99
            }
          ]
        },
        &quot;address&quot;: {
          &quot;street&quot;: &quot;230 W Kinzie Street&quot;,
          &quot;city&quot;: &quot;Green Bay&quot;,
          &quot;state&quot;: &quot;WI&quot;,
          &quot;zip&quot;: &quot;53205&quot;
        },
        &quot;_id&quot;: &quot;3ZOZyTY1LH26LnVw&quot;
      },
      {
        &quot;name&quot;: &quot;Cheese Curd City&quot;,
        &quot;slug&quot;: &quot;cheese-curd-city&quot;,
        &quot;images&quot;: {
          &quot;thumbnail&quot;: &quot;node_modules/place-my-order-assets/images/2-thumbnail.jpg&quot;,
          &quot;owner&quot;: &quot;node_modules/place-my-order-assets/images/3-owner.jpg&quot;,
          &quot;banner&quot;: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
        },
        &quot;menu&quot;: {
          &quot;lunch&quot;: [
            {
              &quot;name&quot;: &quot;Ricotta Gnocchi&quot;,
              &quot;price&quot;: 15.99
            },
            {
              &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Garlic Fries&quot;,
              &quot;price&quot;: 15.99
            }
          ],
          &quot;dinner&quot;: [
            {
              &quot;name&quot;: &quot;Herring in Lavender Dill Reduction&quot;,
              &quot;price&quot;: 45.99
            },
            {
              &quot;name&quot;: &quot;Truffle Noodles&quot;,
              &quot;price&quot;: 14.99
            },
            {
              &quot;name&quot;: &quot;Charred Octopus&quot;,
              &quot;price&quot;: 25.99
            }
          ]
        },
        &quot;address&quot;: {
          &quot;street&quot;: &quot;2451 W Washburne Ave&quot;,
          &quot;city&quot;: &quot;Green Bay&quot;,
          &quot;state&quot;: &quot;WI&quot;,
          &quot;zip&quot;: &quot;53295&quot;
        },
        &quot;_id&quot;: &quot;Ar0qBJHxM3ecOhcr&quot;
      }]}
            )
  }

  getStates() {
    return of({
      data: [
        {&quot;short&quot;:&quot;MO&quot;,&quot;name&quot;:&quot;Missouri&quot;},
        {&quot;short&quot;:&quot;CA  &quot;,&quot;name&quot;:&quot;California&quot;},
        {&quot;short&quot;:&quot;MI&quot;,&quot;name&quot;:&quot;Michigan&quot;}]
    });
  }

  getCities(state:string) {
    return of({
      data: [{&quot;name&quot;:&quot;Sacramento&quot;,&quot;state&quot;:&quot;CA&quot;},{&quot;name&quot;:&quot;Oakland&quot;,&quot;state&quot;:&quot;CA&quot;}]
    });
  }
}
describe('RestaurantComponent', () =&gt; {
  let component: RestaurantComponent;
  let fixture: ComponentFixture&lt;RestaurantComponent&gt;;

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      imports: [
        RouterTestingModule,
        ReactiveFormsModule
      ],
      providers: [{
        provide: RestaurantService,
        useClass: MockRestaurantService
      }],
      declarations: [ RestaurantComponent, ImageUrlPipe ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(RestaurantComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });

  it('should render title in a h2 tag', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    expect(compiled.querySelector('h2').textContent).toContain('Restaurants');
  });

  it('should not show any restaurants markup if no restaurants', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    const compiled = fixture.debugElement.nativeElement;
    expect(compiled.querySelector('.restaurant')).toBe(null);
  });

  it('should have two .restaurant divs',  &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick(501);
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.componentInstance.form.get('city').patchValue('Sacramento');
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let restaurantDivs = compiled.getElementsByClassName('restaurant');
    let hoursDivs = compiled.getElementsByClassName('hours-price');
    expect(restaurantDivs.length).toEqual(2);
    expect(hoursDivs.length).toEqual(2);
  }));

  it('should display restaurant information',  &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick(501);
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.componentInstance.form.get('city').patchValue('Sacramento');
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    expect(compiled.querySelector('.restaurant h3').textContent).toContain('Poutine Palace');
  }));

  it('should set restaurants value to restaurants response data and set isPending to false when state and city form values are selected', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick();
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.componentInstance.form.get('city').patchValue('Sacramento');
    fixture.detectChanges();
    let expectedRestaurants = {
      value: [{
        &quot;name&quot;: &quot;Poutine Palace&quot;,
        &quot;slug&quot;: &quot;poutine-palace&quot;,
        &quot;images&quot;: {
          &quot;thumbnail&quot;: &quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
          &quot;owner&quot;: &quot;node_modules/place-my-order-assets/images/3-owner.jpg&quot;,
          &quot;banner&quot;: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
        },
        &quot;menu&quot;: {
          &quot;lunch&quot;: [
            {
              &quot;name&quot;: &quot;Crab Pancakes with Sorrel Syrup&quot;,
              &quot;price&quot;: 35.99
            },
            {
              &quot;name&quot;: &quot;Steamed Mussels&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Spinach Fennel Watercress Ravioli&quot;,
              &quot;price&quot;: 35.99
            }
          ],
          &quot;dinner&quot;: [
            {
              &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Herring in Lavender Dill Reduction&quot;,
              &quot;price&quot;: 45.99
            },
            {
              &quot;name&quot;: &quot;Chicken with Tomato Carrot Chutney Sauce&quot;,
              &quot;price&quot;: 45.99
            }
          ]
        },
        &quot;address&quot;: {
          &quot;street&quot;: &quot;230 W Kinzie Street&quot;,
          &quot;city&quot;: &quot;Green Bay&quot;,
          &quot;state&quot;: &quot;WI&quot;,
          &quot;zip&quot;: &quot;53205&quot;
        },
        &quot;_id&quot;: &quot;3ZOZyTY1LH26LnVw&quot;
      },
      {
        &quot;name&quot;: &quot;Cheese Curd City&quot;,
        &quot;slug&quot;: &quot;cheese-curd-city&quot;,
        &quot;images&quot;: {
          &quot;thumbnail&quot;: &quot;node_modules/place-my-order-assets/images/2-thumbnail.jpg&quot;,
          &quot;owner&quot;: &quot;node_modules/place-my-order-assets/images/3-owner.jpg&quot;,
          &quot;banner&quot;: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;
        },
        &quot;menu&quot;: {
          &quot;lunch&quot;: [
            {
              &quot;name&quot;: &quot;Ricotta Gnocchi&quot;,
              &quot;price&quot;: 15.99
            },
            {
              &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
              &quot;price&quot;: 21.99
            },
            {
              &quot;name&quot;: &quot;Garlic Fries&quot;,
              &quot;price&quot;: 15.99
            }
          ],
          &quot;dinner&quot;: [
            {
              &quot;name&quot;: &quot;Herring in Lavender Dill Reduction&quot;,
              &quot;price&quot;: 45.99
            },
            {
              &quot;name&quot;: &quot;Truffle Noodles&quot;,
              &quot;price&quot;: 14.99
            },
            {
              &quot;name&quot;: &quot;Charred Octopus&quot;,
              &quot;price&quot;: 25.99
            }
          ]
        },
        &quot;address&quot;: {
          &quot;street&quot;: &quot;2451 W Washburne Ave&quot;,
          &quot;city&quot;: &quot;Green Bay&quot;,
          &quot;state&quot;: &quot;WI&quot;,
          &quot;zip&quot;: &quot;53295&quot;
        },
        &quot;_id&quot;: &quot;Ar0qBJHxM3ecOhcr&quot;
      }],
      isPending: false
    }
    expect(fixture.componentInstance.restaurants).toEqual(expectedRestaurants);
  }));

  it('should show a loading div while isPending is true', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    fixture.componentInstance.restaurants.isPending = true;
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let loadingDiv = compiled.querySelector('.loading');
    expect(loadingDiv).toBeTruthy();
  });

  it('should not show a loading div if isPending is false', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.componentInstance.restaurants.isPending = false;
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let loadingDiv = compiled.querySelector('.loading');
    expect(loadingDiv).toBe(null);
  });

  it('should have a form property with city and state keys', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    expect(fixture.componentInstance.form.controls.state).toBeTruthy();
    expect(fixture.componentInstance.form.controls.city).toBeTruthy();
  });

  it('should show a state dropdown', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let stateSelect = compiled.querySelector('select[formcontrolname=&quot;state&quot;]');
    expect(stateSelect).toBeTruthy();
  });

  it('should show a city dropdown', () =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let citySelect = compiled.querySelector('select[formcontrolname=&quot;city&quot;]');
    expect(citySelect).toBeTruthy();
  });

  it('should set states value to states response data and set isPending to false', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick();
    fixture.detectChanges();
    let expectedStates = {
      value: [
        {&quot;short&quot;:&quot;MO&quot;,&quot;name&quot;:&quot;Missouri&quot;},
        {&quot;short&quot;:&quot;CA  &quot;,&quot;name&quot;:&quot;California&quot;},
        {&quot;short&quot;:&quot;MI&quot;,&quot;name&quot;:&quot;Michigan&quot;}
      ],
      isPending: false
    }
    expect(fixture.componentInstance.states).toEqual(expectedStates);
  }));

  it('should set state dropdown options to be values of states member', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick();
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let stateOption = compiled.querySelector('select[formcontrolname=&quot;state&quot;] option:nth-child(2)');
    expect(stateOption.textContent).toEqual(' Missouri');
    expect(stateOption.value).toEqual('MO');
  }));

  it('should set cities value to cities response data and set isPending to false', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick();
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.detectChanges();
    let expectedCities = {
      value: [
        {&quot;name&quot;:&quot;Sacramento&quot;,&quot;state&quot;:&quot;CA&quot;},
        {&quot;name&quot;:&quot;Oakland&quot;,&quot;state&quot;:&quot;CA&quot;}
      ],
      isPending: false
    }
    expect(fixture.componentInstance.cities).toEqual(expectedCities);
  }));

  it('should set city dropdown options to be values of cities member when state value is selected', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges();
    tick();
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    let cityOption = compiled.querySelector('select[formcontrolname=&quot;city&quot;] option:nth-child(2)');
    expect(cityOption.textContent).toEqual(' Sacramento');
    expect(cityOption.value).toEqual('Sacramento');
  }));

  it('state dropdown should be disabled until states are populated', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    let storeGetStatesFunc = fixture.componentInstance.getStates;
    fixture.componentInstance.getStates = () =&gt; {}; //preventing getStates func from being called 
    fixture.detectChanges(); //detecting changes for createForm func to be called
    let stateFormControl1 = fixture.componentInstance.form.get('state');
    expect(stateFormControl1.enabled).toBe(false);
    fixture.componentInstance.getStates = storeGetStatesFunc;
    fixture.componentInstance.getStates();  //calling getStates func when we want it
    fixture.detectChanges();
    let stateFormControl2 = fixture.componentInstance.form.get('state');
    expect(stateFormControl2.enabled).toBe(true);
  }));

  it('city dropdown should be disabled until cities are populated', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges(); //detecting changes for createForm func to be called
    let cityFormControl1 = fixture.componentInstance.form.get('city');
    expect(cityFormControl1.enabled).toBe(false);
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.detectChanges();
    let cityFormControl2 = fixture.componentInstance.form.get('city');
    expect(cityFormControl2.enabled).toBe(true);
  }));

  it('should reset list of cities when new state is selected', &lt;any&gt;fakeAsync((): void =&gt; {
    const fixture = TestBed.createComponent(RestaurantComponent);
    fixture.detectChanges(); //detecting changes for createForm func to be called
    fixture.componentInstance.form.get('state').patchValue('CA');
    fixture.componentInstance.form.get('city').patchValue('Sacramento');
    fixture.detectChanges();
    expect(fixture.componentInstance.restaurants.value.length).toEqual(2);
    fixture.componentInstance.form.get('state').patchValue('MO');
    fixture.detectChanges();
    expect(fixture.componentInstance.restaurants.value.length).toEqual(0);
  }));
});
</code></pre>
<div line-highlight='169,170,183,184,190,194,195,337-351,353-362,364-378,380-390,392-404,406-415,417-427,only'></div>
<h2>P4: What You Need to Know</h2>
<ul>
<li>How to call service methods in a component</li>
<li>How to write generics</li>
</ul>
<h2>P4: Solution</h2>
<p>✏️ Update <strong>src/app/restaurant/restaurant.component.ts</strong></p>
<pre><code class="language-ts">import { Component, OnInit, OnDestroy } from '@angular/core';
import { FormBuilder, FormGroup } from '@angular/forms';
import { Subscription } from 'rxjs';

import { RestaurantService, ResponseData, State, City } from './restaurant.service';
import { Restaurant } from './restaurant';

export interface Data&lt;T&gt; {
  value: Array&lt;T&gt;;
  isPending: boolean;
}

@Component({
  selector: 'pmo-restaurant',
  templateUrl: './restaurant.component.html',
  styleUrls: ['./restaurant.component.less']
})
export class RestaurantComponent implements OnInit, OnDestroy {
  form: FormGroup;

  public restaurants: Data&lt;Restaurant&gt; = {
    value: [],
    isPending: false
  }

  public states: Data&lt;State&gt; = {
    isPending: false,
    value: []
  };

  public cities: Data&lt;City&gt; = {
    isPending: false,
    value: []
  };

  private subscription: Subscription;

  constructor(
    private restaurantService: RestaurantService,
    private fb: FormBuilder
    ) {
  }

  ngOnInit() {
    this.createForm();

    this.getStates();
  }

  ngOnDestroy() {
    if(this.subscription) {
      this.subscription.unsubscribe();
    }
  }

  createForm() {
    this.form = this.fb.group({
      state: {value: '', disabled: true},
      city: {value: '', disabled: true},
    });

    this.onChanges();
  }

  onChanges(): void {
    let state:string;
    const stateChanges = this.form.get('state').valueChanges.subscribe(val =&gt; {
      this.restaurants.value = [];
      if (val) {
        //only enable city if state has value
        this.form.get('city').enable({
          onlySelf: true,
          emitEvent: false
        });
        //if state has a value and has changed, clear previous city value
        if (state != val) {
          this.form.get('city').patchValue('');
        }
        //fetch cities based on state val
        this.getCities(val);
        state = val;
      }
      else {
        //disable city if no value
        this.form.get('city').disable({
          onlySelf: true,
          emitEvent: false
        });
        state = '';
      }
    });
    this.subscription = stateChanges;


    const cityChanges = this.form.get('city').valueChanges.subscribe(val =&gt; {
      if(val) {
        this.getRestaurants();
      }
    });
    this.subscription.add(cityChanges);
  }

  getStates() {
    this.restaurantService.getStates().subscribe((res: ResponseData&lt;State&gt;) =&gt; {
      this.states.value = res.data;
      this.states.isPending = false;
      this.form.get('state').enable();
    });
  }

  getCities(state:string) {
    this.cities.isPending = true;
    this.restaurantService.getCities(state).subscribe((res: ResponseData&lt;City&gt;) =&gt; {
      this.cities.value = res.data;
      this.cities.isPending = false;
      this.form.get('city').enable({
        onlySelf: true,
        emitEvent: false
      });
    });
  }

  getRestaurants() {
    this.restaurantService.getRestaurants().subscribe((res: ResponseData&lt;Restaurant&gt;) =&gt; {
      this.restaurants.value = res.data;
      this.restaurants.isPending = false;
    });
  }
}
</code></pre>
<div line-highlight='5,8-11,21,26,31,28,33,44-48,65-101, 103-109, 111-121,123-128'></div>

</section>

  			
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout slack">
          <h6>Get help</h6>
          <p>If you need <a href="https://join.slack.com/t/bitovi-community/shared_invite/enQtNTIzMTE5NzYxMjA3LWMwMzE4MjFkMTI5ZmZjNzllYjc2MzcxOWNmOTg3YjI4NjE0MGFkZGNkOTNlZjlkNDBhNTlmYTcwMzJlZDZjY2Y">help</a> with an exercise, please reach out to us on
             <a href="https://join.slack.com/t/bitovi-community/shared_invite/enQtNTIzMTE5NzYxMjA3LWMwMzE4MjFkMTI5ZmZjNzllYjc2MzcxOWNmOTg3YjI4NjE0MGFkZGNkOTNlZjlkNDBhNTlmYTcwMzJlZDZjY2Y">Slack</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com<a/></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/angular/9-form-value-changes/form-value-changes.md"},"description":"Learn how to listen to form value changes with Angular. \n","name":"learn-angular/form-value-changes","title":"Filter Cities by State","type":"page","parent":"learn-angular","order":9,"comment":" ","codepen":[["\"can\"","\"//unpkg.com/can@5/core.mjs\""],["\"can/everything\"","\"//unpkg.com/can@5/everything.mjs\""]],"pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
</body>
</html>
