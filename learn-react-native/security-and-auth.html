<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/react-native/16-security-and-auth/security-and-auth.md
	@page learn-react-native/security-and-auth
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Learn about security, authentication, and authorization by implementing Google Sign-In. 
">
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P9MQVJS');</script>
  <!-- End Google Tag Manager -->

  <title>Bitovi Academy - Security and Authentication</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9MQVJS"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget. We strongly suggest finishing learn-advanced-javascript prior to starting this course.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-react-native.html"
							title="Learn React Native by building the feature-rich Place My Order application in this beginner React Native guide. This hands-on course will introduce you to fundamental React Native concepts! By the end of this course, you will have a strong understanding of JSX, function components, styling, state management, Hooks, data fetching, routing, and testing.">
							Learn React Native
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="intro-to-react-native.html"
							title="Discover why React Native is a great choice for modern mobile application development.">
							Introduction to React Native
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="setting-up-your-environment.html"
							title="Learn how to set up your environment for React Native development.">
							Setting Up Your Environment
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-a-new-app.html"
							title="Generate a new React Native application using the CLI.">
							Creating a New Application
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="intro-to-jsx.html"
							title="Learn how to use JSX to define your UI in React Native.">
							Introduction to JSX
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="intro-to-testing.html"
							title="Learn about testing solutions in React Native.">
							Introduction to Testing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-custom-components.html"
							title="Learn about components, the core building blocks of every React application.">
							Building Custom Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="debugging-devtools.html"
							title="Learn how to set up and use both DevTools and Debugger.">
							Debugging and DevTools
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="styling.html"
							title="Learn how to use the style prop and the StyleSheet API in React Native.">
							Styling in React Native
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="react-context.html"
							title="Learn how to share a common theme by creating a React Context.">
							Using React Context
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="managing-state.html"
							title="Work with React’s useState Hook to manage a component’s state.">
							Managing State with useState
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="navigation.html"
							title="Learn how to use navigation to move between screens in a React Native app.">
							Navigation in React Native
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="navigation-params.html"
							title="Maintain the React state with React Native Navigation Parameters">
							Storing State in Navigation Parameters
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="making-http-requests.html"
							title="Learn about how to make fetch requests and render requested data in React Native components.">
							Making HTTP Requests
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="user-inputs.html"
							title="Use switch controls and inputs to collect information.">
							Handling User Inputs
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="using-asyncstorage.html"
							title="Store data locally on device with Async Storage and run data migrations with new versions of your application.">
							Using Async Storage
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="security-and-auth.html"
							title="Learn about security, authentication, and authorization by implementing Google Sign-In.">
							Security and Authentication
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="offline-support.html"
							title="Learn device-first strategies for storing data and syncing it to a server.">
							Adding Offline Support
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="google-maps.html"
							title="Learn how to integrate Google Maps into your React Native application.">
							Integrating Maps
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="performance-optimization.html"
							title="Improve the application’s launch time by implementing lazy loading.">
							Performance and Optimization
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building.html"
							title="Learn how to build Android App Bundle (AAB) files.">
							Building React Native Apps
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="publishing-and-updating.html"
							title="Preparation for the steps to Publish and Update a production application on Stores.">
							Publishing and Updating
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-agile-program-management-with-jira.html"
							title="Learn how to build, maintain, and report on accurate multi-team plans with Jira.">
							Agile Program Management With Jira
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to move beyond writing code to be an excellent technology consultant!">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building the feature-rich Place My Order application in this beginner React guide. This hands-on course will introduce you to fundamental React concepts! By the end of this course, you will have a strong understanding of JSX, function components, styling, state management, Hooks, data fetching, routing, and testing.">
							Learn React
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-ngrx.html"
							title="Learn how to manage state in an Angular application using NgRx.">
							Learn NgRx
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-graphql.html"
							title="Build a backend application for property rentals using Node JS, GraphQL and Apollo Server.         Learn about using ORMs like Mongoose and Prisma with a NoSQL Mongo database!
Write testcases testing created endpoints.">
							Learn Graphql
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a Node.js app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../advanced-typescript.html"
							title="This is the second course in the TypeScript series. By the end, you will be comfortable with any types you come across and possess the knowledge to create your own advanced types. The only prerequisite is the first course in the TypeScript series found here.">
							Advanced TypeScript
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Security and Authentication <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Learn about security, authentication, and authorization by implementing Google Sign-In.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2 id="overview">Overview</h2>
<p>In this section, you will:</p>
<ul>
<li>Authenticate with OAuth.</li>
<li>Implement Google Sign-In.</li>
<li>Memoize functions with <code>useCallback</code>.</li>
<li>Memoize values with <code>useMemo</code>.</li>
<li>Create an <code>AuthProvider</code> Context.</li>
</ul>
<h2 id="objective-1-add-google-sign-in">Objective 1: Add Google Sign-In</h2>
<div style="display: flex; flex-direction: row; gap: 2rem; flex-wrap: wrap;">
  <img alt="Screenshot of the Settings tab with a Google “Sign in” button." src="../static/img/react-native/16-security/01-solution.png" style="border: 4px solid black; border-radius: 25px;" height="640"/>
  <img alt="Screenshot of the Settings tab showing a sign-in user and a “Sign out” button." src="../static/img/react-native/16-security/01-solution-signed-in.png" style="border: 4px solid black; border-radius: 25px;" height="640"/>
</div>
<h3 id="authenticating-with-oauth">Authenticating with OAuth</h3>
<p>OAuth is a standard that allows an application to access resources hosted by another application through a secure authorization process.</p>
<p>Let’s break down some of the core concepts of OAuth:</p>
<ul>
<li><p><strong>Access Token</strong>: A token used by the application to access protected resources. It is obtained during the OAuth authorization flow and sent with each request to the resource server. Access tokens are typically short-lived and can be refreshed using a refresh token.</p></li>
<li><p><strong>Refresh Token</strong>: A token used to obtain a new access token when the current access token expires. Refresh tokens are typically long-lived and can be used to obtain new access tokens without requiring the user to log in again.</p></li>
<li><p><strong>Scopes</strong>: Scopes are permissions requested by the application during the OAuth authorization flow. They define what actions the application is allowed to perform using the access token. For example, an application might request only read access to a user’s Google Drive files, which would allow it to view (but not modify) the files.</p></li>
<li><p><strong>Authorization Server</strong>: The server that authenticates the user and issues access tokens.</p></li>
<li><p><strong>Resource Server</strong>: The server that hosts protected resources. It is responsible for validating access tokens and granting access to resources based on the token's permissions.</p></li>
</ul>
<p>The use of refresh tokens rather than long-lived access tokens is primarily a security measure:</p>
<ul>
<li><p><strong>Reduced Exposure</strong>: If an access token is compromised, the attacker has a limited window of time to use it before it expires.</p></li>
<li><p><strong>Revocation</strong>: If a user’s access is revoked, the refresh token can be invalidated, preventing the attacker from obtaining new access tokens.</p></li>
<li><p><strong>Limited Scope</strong>: Refresh tokens can be issued with limited scopes, reducing the potential damage if they are compromised.</p></li>
</ul>
<p>The OAuth flow typically involves the following steps:</p>
<ol>
<li>The user clicks a “Sign In” button in the application.</li>
<li>The application redirects the user to the OAuth provider’s login page.</li>
<li>The user logs in to the OAuth provider.</li>
<li>The OAuth provider redirects the user back to the application with an authorization code.</li>
<li>The application exchanges the authorization code for an access token.</li>
<li>The application uses the access token to access the secured resources.</li>
</ol>
<h3 id="implementing-google-sign-in">Implementing Google Sign-In</h3>
<p>The <code>@react-native-google-signin/google-signin</code> package provides a simple way to integrate Google Sign-In into our React Native apps. It handles the OAuth flow, allowing users to sign in with their Google accounts and obtain an access token that can be used to access Google services on their behalf.</p>
<p>To use Google Sign-In in your React Native app, you must configure your application in the Google Cloud Console and obtain a client ID. This client ID is used to identify your application when requesting access tokens from Google.</p>
<ol>
<li>Create a new project in the Google Cloud Console.</li>
<li>Enable APIs &amp; services for your project.</li>
<li>Navigate to the <a href="https://developers.google.com/workspace/guides/create-credentials">Credentials</a> section and create a new OAuth client ID.</li>
<li>Because we are using React Native, we will need to create an OAuth client ID for both a Web application and an Android application. For the Android application, use the command provided by the create form to generate a SHA-1 fingerprint.</li>
<li>The client ID from the Web application will be used in the <code>webClientId</code> field when configuring the Google Sign-In package in your React Native app.</li>
</ol>
<p>Now that we have a project set up in Google Cloud Console, we can start integrating Google Sign-In into our React Native app.</p>
<h4 id="configuring-the-package">Configuring the package</h4>
<p>It is mandatory to call the <code>configure</code> method before attempting to sign in.
The <code>configure</code> method takes an object and is used to initialize your application for authentication with Google.
The <code>scopes</code> parameter is an array of strings representing the permissions the application is requesting.
The <code>webClientId</code> parameter is the client ID of th project that is created in the Google Cloud Console.</p>
<pre><code class="language-ts">import { GoogleSignin } from &quot;@react-native-google-signin/google-signin&quot;

const googleOauthwebClientId = process.env.GOOGLE_OAUTH_CLIENT_ID

GoogleSignin.configure({
  scopes: [&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;],
  webClientId: googleOauthwebClientId,
})

</code></pre>
<div line-highlight='5-8'></div>
<h4 id="signing-in">Signing in</h4>
<p>The <code>signIn</code> method is used to prompt a modal and allow the user to sign into their Google account from our application.
This method returns a Promise that resolves to the user’s information if the sign-in is successful.
This method is the first part of authorization OAuth flow.
Once the user is signed in, we can use the <code>getTokens</code> method to retrieve an access token.</p>
<pre><code class="language-ts">import {
  GoogleSignin,
  statusCodes,
} from &quot;@react-native-google-signin/google-signin&quot;

const signIn = async () =&gt; {
  try {
    const userInfo = await GoogleSignin.signIn()
    console.info(userInfo)
  } catch (error) {
    if (error.code === statusCodes.SIGN_IN_CANCELLED) {
      // User cancelled the login flow.
    } else if (error.code === statusCodes.IN_PROGRESS) {
      // Operation is in progress already.
    } else if (error.code === statusCodes.PLAY_SERVICES_NOT_AVAILABLE) {
      // Play services not available or outdated.
    } else {
      // Some other error happened.
    }
  }
}

export default signIn

</code></pre>
<div line-highlight='8'></div>
<h4 id="getting-the-current-user">Getting the current user</h4>
<p>The <code>getCurrentUser</code> method is used to retrieve the current signed-in user’s information.
This method returns a Promise that resolves to the user’s information if the user is signed in.</p>
<pre><code class="language-tsx">import { GoogleSignin } from &quot;@react-native-google-signin/google-signin&quot;

const getCurrentUser = async () =&gt; {
  const userInfo = await GoogleSignin.getCurrentUser()
  console.info(userInfo)
}
</code></pre>
<h4 id="signing-out">Signing out</h4>
<p>The <code>signOut</code> method is used to sign the current user out and revoke the access token.</p>
<pre><code class="language-tsx">import { GoogleSignin } from &quot;@react-native-google-signin/google-signin&quot;

const signOut = async () =&gt; {
  await GoogleSignin.signOut()
}
</code></pre>
<h4 id="using-the-codegooglesigninbuttoncode">Using the <code>GoogleSigninButton</code></h4>
<p>The <code>GoogleSigninButton</code> component is a pre-styled button that can be used to initiate the sign-in flow.
The size, color, and whether the button is disabled can be customized using props.
The <code>onPress</code> prop is used to specify the function to be called when the button is pressed.</p>
<pre><code class="language-tsx">import { GoogleSigninButton } from &quot;@react-native-google-signin/google-signin&quot;

function Button() {
  return (
    &lt;GoogleSigninButton
      size={GoogleSigninButton.Size.Wide}
      color={GoogleSigninButton.Color.Dark}
      onPress={signIn}
      disabled={false}
    /&gt;
  )
}
</code></pre>
<h3 id="memoizing-functions-with-codeusecallbackcode">Memoizing functions with <code>useCallback</code></h3>
<p>The <code>useCallback</code> Hook is used to memoize functions so that they are not recreated on every render. When using a provider, it is important to memoize functions so that they do not cause unnecessary re-renders of components that depend on them.</p>
<pre><code class="language-tsx">const memoizedCallback = useCallback(() =&gt; {
  // function logic
}, [dependencies])
</code></pre>
<p>In the example above, the <code>memoizedCallback</code> function will only be recreated when the <code>dependencies</code> array changes.</p>
<h3 id="memoizing-values-with-codeusememocode">Memoizing values with <code>useMemo</code></h3>
<p>Similar to <code>useCallback</code>, the <code>useMemo</code> Hook is used to memoize values so that they are not recalculated on every render. It is useful for optimizing performance by avoiding unnecessary calculations.</p>
<p>The <code>useCallback</code> Hook is used to memoize a function, so that child components do not re-render when the function reference changes. The <code>useMemo</code> Hook on the other hand is used to memoize a <em>value</em>. We should use <code>useMemo</code> if the logic to calculate a value is expensive.</p>
<pre><code class="language-tsx">const memoizedValue = useMemo(() =&gt; {
  // value calculation logic
}, [dependencies])
</code></pre>
<p>Just like <code>useCallback</code>, the <code>memoizedValue</code> will only be recalculated when the <code>dependencies</code> array changes.</p>
<h3 id="creating-an-codeauthprovidercode-context">Creating an <code>AuthProvider</code> Context</h3>
<p>It’s common to create an <code>AuthProvider</code> context that manages the authentication state of the application.
It provides the authentication state and methods to sign in and sign out to the rest of the application using a React Context.</p>
<p>The <code>AuthProvider</code> typically includes methods to:</p>
<ul>
<li>Sign in the user.</li>
<li>Sign out the user.</li>
<li>Get the current signed-in user’s information.</li>
</ul>
<p>We can use an <code>AuthProvider</code> to lock down our application and only allow access to authenticated users.</p>
<pre><code class="language-tsx">function AuthProvider({ children }) {
  const [user, setUser] = useState(null)

  const signIn = useCallback(() =&gt; {
    // sign in logic
  }, [])

  const signOut = useCallback(() =&gt; {
    // sign out logic
  }, [])

  if (!user) {
    return &lt;SignInScreen onSignIn={signIn} /&gt;
  }

  return (
    &lt;AuthContext.Provider value={{ user, signOut }}&gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  )
}
</code></pre>
<p>We would use this in the application like this:</p>
<pre><code class="language-tsx">&lt;AuthProvider&gt;
  &lt;App /&gt;
&lt;/AuthProvider&gt;
</code></pre>
<h3 id="setup-1">Setup 1</h3>
<p>✏️ Install the new dependency:</p>
<pre><code class="language-bash">npm install @react-native-google-signin/google-signin@11
</code></pre>
<p>✏️ Update <strong>jest-setup.ts</strong> to be:</p>
<pre><code class="language-ts">import &quot;@testing-library/react-native/extend-expect&quot;

import &quot;react-native-gesture-handler/jestSetup&quot;
import &quot;@react-native-google-signin/google-signin/jest/build/setup&quot;

jest.mock(&quot;@react-navigation/native&quot;, () =&gt; {
  const actualNav = jest.requireActual(&quot;@react-navigation/native&quot;)
  return {
    ...actualNav,
    useNavigation: () =&gt; ({
      navigate: jest.fn(),
      setOptions: jest.fn(),
    }),
  }
})

jest.mock(&quot;@shared/services/pmo/api&quot;, () =&gt;
  require(&quot;@shared/services/pmo/api/api.mock&quot;),
)

jest.mock(&quot;@shared/services/storage&quot;, () =&gt;
  require(&quot;@shared/services/storage/storage.mock&quot;),
)

jest.mock(&quot;@react-native-async-storage/async-storage&quot;, () =&gt;
  require(&quot;@react-native-async-storage/async-storage/jest/async-storage-mock&quot;),
)

const consoleError = console.error
console.error = (message, ...args) =&gt; {
  if (
    typeof message === &quot;string&quot; &amp;&amp;
    message.match(
      /Warning: An update to .+ inside a test was not wrapped in act\(\.\.\.\)\./,
    )
  ) {
    return
  }

  return consoleError(message, ...args)
}

</code></pre>
 <div line-highlight="4,only"></div>
<p>✏️ Update <strong>src/App.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { createBottomTabNavigator } from &quot;@react-navigation/bottom-tabs&quot;
import { NavigationContainer } from &quot;@react-navigation/native&quot;
import { createStackNavigator } from &quot;@react-navigation/stack&quot;
import Box from &quot;@shared/design/Box&quot;
import ThemeProvider, { useTheme } from &quot;@shared/design/theme/ThemeProvider&quot;
import Typography from &quot;@shared/design/Typography&quot;
import AuthProvider from &quot;@shared/services/auth/AuthProvider&quot;
import DataMigration from &quot;@shared/services/DataMigration&quot;
import { Pressable } from &quot;react-native&quot;
import { SafeAreaView } from &quot;react-native-safe-area-context&quot;
import Icon from &quot;react-native-vector-icons/Ionicons&quot;

import CityList from &quot;./screens/CityList&quot;
import RestaurantDetails from &quot;./screens/RestaurantDetails&quot;
import RestaurantList from &quot;./screens/RestaurantList&quot;
import RestaurantOrder from &quot;./screens/RestaurantOrder&quot;
import Settings from &quot;./screens/Settings&quot;
import StateList from &quot;./screens/StateList&quot;

declare global {
  // eslint-disable-next-line @typescript-eslint/no-namespace
  namespace ReactNavigation {
    // eslint-disable-next-line @typescript-eslint/no-empty-interface
    interface RootParamList extends RestaurantsStackParamList {}
  }
}

export type RestaurantsStackParamList = {
  StateList: undefined
  CityList: {
    state: {
      name: string
      short: string
    }
  }
  RestaurantList: {
    state: {
      name: string
      short: string
    }
    city: {
      name: string
      state: string
    }
  }
  RestaurantDetails: {
    slug: string
  }
  RestaurantOrder: {
    slug: string
  }
}

const RestaurantsStack = createStackNavigator&lt;RestaurantsStackParamList&gt;()
const RestaurantsNavigator: React.FC = () =&gt; {
  return (
    &lt;RestaurantsStack.Navigator
      initialRouteName=&quot;StateList&quot;
      screenOptions={{
        header: ({ route, navigation }) =&gt; {
          if (!navigation.canGoBack()) return null

          return (
            &lt;Pressable onPress={navigation.goBack}&gt;
              &lt;Box
                padding=&quot;m&quot;
                style={{ flexDirection: &quot;row&quot;, gap: 8, alignItems: &quot;center&quot; }}
              &gt;
                &lt;Icon name=&quot;arrow-back&quot; size={20} /&gt;
                &lt;Typography variant=&quot;heading&quot;&gt;
                  {/* @ts-ignore */}
                  {[route.params?.city?.name, route.params?.state?.name]
                    .filter(Boolean)
                    .join(&quot;, &quot;)}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Pressable&gt;
          )
        },
      }}
    &gt;
      &lt;RestaurantsStack.Screen name=&quot;StateList&quot; component={StateList} /&gt;
      &lt;RestaurantsStack.Screen name=&quot;CityList&quot; component={CityList} /&gt;
      &lt;RestaurantsStack.Screen
        name=&quot;RestaurantList&quot;
        component={RestaurantList}
      /&gt;
      &lt;RestaurantsStack.Screen
        name=&quot;RestaurantDetails&quot;
        component={RestaurantDetails}
      /&gt;
      &lt;RestaurantsStack.Screen
        name=&quot;RestaurantOrder&quot;
        component={RestaurantOrder}
      /&gt;
    &lt;/RestaurantsStack.Navigator&gt;
  )
}

const AppTabs = createBottomTabNavigator()
const AppNavigator: React.FC = () =&gt; {
  const theme = useTheme()

  return (
    &lt;AppTabs.Navigator
      initialRouteName=&quot;RestaurantsStack&quot;
      screenOptions={({ route }) =&gt; ({
        headerStyle: {
          backgroundColor: theme.palette.screen.main,
        },
        headerTitleStyle: {
          color: theme.palette.screen.contrast,
          ...theme.typography.title,
        },
        tabBarStyle: {
          backgroundColor: theme.palette.screen.main,
        },
        tabBarActiveTintColor: theme.palette.primary.strong,
        tabBarInactiveTintColor: theme.palette.screen.contrast,
        tabBarIcon: ({ focused, color }) =&gt; {
          let icon = &quot;settings&quot;
          if (route.name === &quot;Settings&quot;) {
            icon = focused ? &quot;settings&quot; : &quot;settings-outline&quot;
          } else if (route.name === &quot;Restaurants&quot;) {
            icon = focused ? &quot;restaurant&quot; : &quot;restaurant-outline&quot;
          }

          return &lt;Icon name={icon} size={20} color={color} /&gt;
        },
      })}
    &gt;
      &lt;AppTabs.Screen
        name=&quot;Restaurants&quot;
        component={RestaurantsNavigator}
        options={{ title: &quot;Place My Order&quot; }}
      /&gt;
      &lt;AppTabs.Screen
        name=&quot;Settings&quot;
        component={Settings}
        options={{ title: &quot;Settings&quot; }}
      /&gt;
    &lt;/AppTabs.Navigator&gt;
  )
}

// Exercise: Add `AuthProvider` to the App component.
const App: React.FC = () =&gt; {
  return (
    &lt;SafeAreaView style={{ flex: 1 }}&gt;
      &lt;ThemeProvider&gt;
        &lt;DataMigration&gt;
          &lt;NavigationContainer&gt;
            &lt;AppNavigator /&gt;
          &lt;/NavigationContainer&gt;
        &lt;/DataMigration&gt;
      &lt;/ThemeProvider&gt;
    &lt;/SafeAreaView&gt;
  )
}

export default App

</code></pre>
 <div line-highlight="5,7,146,only"></div>
<p>✏️ Update <strong>src/env.d.ts</strong> to be:</p>
<pre><code class="language-ts">/* eslint-disable @typescript-eslint/no-namespace */

declare global {
  namespace NodeJS {
    interface ProcessEnv {
      readonly GOOGLE_OAUTH_CLIENT_ID: string
      readonly PMO_API: string
      readonly PMO_ASSETS: string
    }
  }
}

export {}

</code></pre>
 <div line-highlight="6,only"></div>
<p>✏️ Update <strong>.env.example</strong> to be:</p>
<pre><code class="language-example">GOOGLE_OAUTH_CLIENT_ID=
PMO_API=http://localhost:7070
PMO_ASSETS=https://www.place-my-order.com/

</code></pre>
 <div line-highlight="1,only"></div>
<p>✏️ Update <strong>.env</strong> to include your <code>GOOGLE_OAUTH_CLIENT_ID</code> key.</p>
<p>✏️ Terminate the existing dev server and start it again:</p>
<pre><code class="language-bash">npm run start
</code></pre>
<p>✏️ Update <strong>src/screens/Settings/Settings.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { GoogleSigninButton } from &quot;@react-native-google-signin/google-signin&quot;
import Loading from &quot;@shared/components/Loading&quot;
import Button from &quot;@shared/design/Button&quot;
import Card from &quot;@shared/design/Card&quot;
import Screen from &quot;@shared/design/Screen&quot;
import { useThemeMode } from &quot;@shared/design/theme&quot;
import Typography from &quot;@shared/design/Typography&quot;
import { useAuthentication, useUser } from &quot;@shared/services/auth&quot;
import { StyleSheet, Switch, View } from &quot;react-native&quot;

const Settings: React.FC = () =&gt; {
  // Exercise: use the Hooks from the Auth service to get: error, isPending, signIn, signOut.
  const { mode, setMode } = useThemeMode()

  return (
    &lt;Screen&gt;
      &lt;Card&gt;
        {/*
          Exercise:
          - If the user is logged out: Render a button using the GoogleSigninButton.
          - If the user is logged in: Render a button using the signOut callback along with a welcome message.
          - If the Hook isPending: Render the Loading view.
          - If the Hook has an error: Render the error message.
        */}
        &lt;Typography variant=&quot;heading&quot;&gt;&lt;/Typography&gt;
      &lt;/Card&gt;
      &lt;Card&gt;
        &lt;View style={styles.row}&gt;
          &lt;Typography variant=&quot;heading&quot;&gt;Dark mode&lt;/Typography&gt;
          &lt;Switch
            onValueChange={(value) =&gt; setMode(value ? &quot;dark&quot; : &quot;light&quot;)}
            value={mode === &quot;dark&quot;}
          /&gt;
        &lt;/View&gt;
      &lt;/Card&gt;
    &lt;/Screen&gt;
  )
}

const styles = StyleSheet.create({
  row: {
    flexDirection: &quot;row&quot;,
    alignItems: &quot;center&quot;,
    justifyContent: &quot;space-between&quot;,
  },
})

export default Settings

</code></pre>
 <div line-highlight="1-3,8,12,18-25,only"></div>
<p>✏️ Create <strong>src/shared/services/auth/AuthProvider.tsx</strong> and update it to be:</p>
<pre><code class="language-tsx">import {
  User as UserInfo,
  GoogleSignin,
} from &quot;@react-native-google-signin/google-signin&quot;
import { FC, ReactNode, useCallback, useEffect, useMemo, useState } from &quot;react&quot;

import { AuthContext, AuthContextProvider, useAuthContext } from &quot;./context&quot;

const googleOauthwebClientId = process.env.GOOGLE_OAUTH_CLIENT_ID

GoogleSignin.configure({
  scopes: [&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;],
  webClientId: googleOauthwebClientId,
})

export interface AuthProviderProps {
  children: React.ReactNode
}

const AuthProvider: FC&lt;{ children: ReactNode }&gt; = ({ children }) =&gt; {
  const [error, setError] = useState&lt;Error | undefined&gt;()
  const [isPending, setIsPending] = useState&lt;boolean&gt;(true)
  const [userInfo, setUserInfo] = useState&lt;UserInfo | undefined&gt;()

  const signIn = async () =&gt; {
    // Exercise: Implement `signIn` with `useCallback`.
    try {
      setError(undefined)
      setIsPending(true)

      // Exercise: Use the GoogleSignin API to sign in the user.

      setIsPending(false)
      setUserInfo(userInfo)

      return userInfo.user
    } catch (error) {
      console.error(&quot;Call to GoogleSignin.signIn() failed with error:&quot;, error)

      setError(error as Error)
      setIsPending(false)
      setUserInfo(undefined)

      return false
    }
  }

  const signOut = async () =&gt; {
    // Exercise: Implement `signOut` with `useCallback`.
    try {
      setError(undefined)
      setIsPending(true)

      // Exercise: Use the GoogleSignin API to sign out the user.

      setIsPending(false)
      setUserInfo(undefined)

      return true
    } catch (error) {
      console.error(&quot;Call to GoogleSignin.signOut() failed with error:&quot;, error)

      setError(error as Error)
      setIsPending(false)

      return false
    }
  }

  useEffect(() =&gt; {
    async function run() {
      try {
        setError(undefined)
        setIsPending(true)

        // Exercise: When a sign in is successful, update the user.
      } catch (error) {
        console.error(
          &quot;Call to GoogleSignin.getCurrentUser() failed with error:&quot;,
          error,
        )

        setError(error as Error)
        setIsPending(false)
      }
    }

    run()
  }, [])

  const value = useMemo&lt;AuthContext&gt;(
    () =&gt; ({
      signIn,
      signOut,
      error,
      isAuthenticated: userInfo
        ? true
        : userInfo === undefined
        ? false
        : undefined,
      isPending,
      user: userInfo?.user,
      scopes: userInfo?.scopes,
      idToken: userInfo?.idToken,
    }),
    [error, isPending, signIn, signOut, userInfo],
  )

  return &lt;AuthContextProvider value={value}&gt;{children}&lt;/AuthContextProvider&gt;
}

export default AuthProvider

export function useAuthentication(): Pick&lt;
  AuthContext,
  &quot;error&quot; | &quot;isPending&quot; | &quot;signIn&quot; | &quot;signOut&quot;
&gt; {
  const { error, isPending, signIn, signOut } = useAuthContext()

  return { error, isPending, signIn, signOut }
}

export function useAuthenticated(): boolean | undefined {
  const { isAuthenticated } = useAuthContext()

  return isAuthenticated
}

export function useUser(): UserInfo[&quot;user&quot;] | undefined {
  const { user } = useAuthContext()

  return user
}

</code></pre>
<div line-highlight='26, 31, 49, 54, 76, only'></div>
<p>✏️ Create <strong>src/shared/services/auth/context.ts</strong> and update it to be:</p>
<pre><code class="language-ts">import { User as UserInfo } from &quot;@react-native-google-signin/google-signin&quot;
import { createContext, useContext } from &quot;react&quot;

export interface AuthContext {
  /** Initiate the Google Auth flow. Return boolean success. */
  signIn: () =&gt; Promise&lt;UserInfo[&quot;user&quot;] | false&gt;

  /** Log the user out from Google Auth. Return boolean success. */
  signOut: () =&gt; Promise&lt;boolean&gt;

  /** Error if any Google API returns an error. Undefined if no errors in the last API call. */
  error?: Error | undefined

  /** Boolean if the user is authenticated or not. Undefined if unknown. */
  isAuthenticated?: boolean

  /** Boolean if a Google API call is being made. */
  isPending: boolean

  /** Google Auth User object. Undefined if not signed in. */
  user?: UserInfo[&quot;user&quot;]

  /** List of Google Auth scopes. Undefined if not signed in. */
  scopes?: UserInfo[&quot;scopes&quot;]

  /** Google Auth Token. Undefined if not signed in. */
  idToken?: UserInfo[&quot;idToken&quot;]
}

const Context = createContext&lt;AuthContext | undefined&gt;(undefined)

export const AuthContextProvider = Context.Provider

export function useAuthContext(): AuthContext {
  const value = useContext(Context)

  if (!value) {
    throw new Error(&quot;Missing AuthProvider.&quot;)
  }

  return value
}

</code></pre>
<div line-highlight='4-28, only'></div>
<p>✏️ Create <strong>src/shared/services/auth/index.ts</strong> and update it to be:</p>
<pre><code class="language-ts">export { default } from &quot;./AuthProvider&quot;
export * from &quot;./AuthProvider&quot;

</code></pre>
<h3 id="verify-1">Verify 1</h3>
<p>✏️ Update <strong>src/screens/Settings/Settings.test.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { NavigationContainer } from &quot;@react-navigation/native&quot;
import AuthProvider from &quot;@shared/services/auth/AuthProvider&quot;
import { fireEvent, render, screen } from &quot;@testing-library/react-native&quot;

import Settings from &quot;./Settings&quot;

const mockSetMode = jest.fn()

jest.mock(&quot;@shared/design/theme&quot;, () =&gt; ({
  ...jest.requireActual(&quot;@shared/design/theme&quot;),
  useThemeMode: () =&gt; ({
    mode: &quot;light&quot;,
    setMode: mockSetMode,
  }),
}))

describe(&quot;Screens/Settings&quot;, () =&gt; {
  it(&quot;renders&quot;, async () =&gt; {
    render(
      &lt;AuthProvider&gt;
        &lt;NavigationContainer&gt;
          &lt;Settings /&gt;
        &lt;/NavigationContainer&gt;
      &lt;/AuthProvider&gt;,
    )
    expect(screen.getByText(/Loading…/i)).not.toBeNull()
  })

  it(&quot;switches to dark mode&quot;, () =&gt; {
    render(
      &lt;AuthProvider&gt;
        &lt;NavigationContainer&gt;
          &lt;Settings /&gt;
        &lt;/NavigationContainer&gt;
      &lt;/AuthProvider&gt;,
    )

    const switchElement = screen.getByRole(&quot;switch&quot;)
    expect(switchElement.props.value).toBe(false)

    fireEvent(switchElement, &quot;onValueChange&quot;, true)
    expect(mockSetMode).toHaveBeenCalledWith(&quot;dark&quot;)
  })
})

</code></pre>
 <div line-highlight="2,20-24,26,31-35,only"></div>
<p>✏️ Create <strong>src/shared/services/auth/AuthProvider.test.tsx</strong> and update it to be:</p>
<pre><code class="language-tsx">import { GoogleSigninButton } from &quot;@react-native-google-signin/google-signin&quot;
import Button from &quot;@shared/design/Button&quot;
import { render, screen, fireEvent } from &quot;@testing-library/react-native&quot;
import { View, Text } from &quot;react-native&quot;

import AuthProvider, {
  useAuthenticated,
  useAuthentication,
  useUser,
} from &quot;./AuthProvider&quot;

const oldFetch = global.fetch
const mockFetch = jest.fn()
beforeAll(() =&gt; {
  global.fetch = mockFetch
})
afterAll(() =&gt; {
  global.fetch = oldFetch
})

describe(&quot;Services/Auth/AuthProvider&quot;, () =&gt; {
  const TestComponent: React.FC = () =&gt; {
    const isAuthenticated = useAuthenticated()
    const { signIn, signOut } = useAuthentication()
    const user = useUser()

    return (
      &lt;View&gt;
        &lt;Text&gt;{user?.id}&lt;/Text&gt;
        &lt;Text&gt;{user?.name}&lt;/Text&gt;
        &lt;Text&gt;{user?.email}&lt;/Text&gt;
        &lt;Text&gt;{user?.photo}&lt;/Text&gt;
        &lt;Text&gt;{user?.givenName}&lt;/Text&gt;
        &lt;Text&gt;{user?.familyName}&lt;/Text&gt;
        {isAuthenticated &amp;&amp; &lt;Button onPress={signOut}&gt;Sign out&lt;/Button&gt;}
        {isAuthenticated === false &amp;&amp; &lt;GoogleSigninButton onPress={signIn} /&gt;}
      &lt;/View&gt;
    )
  }

  it(&quot;renders with provider; signs in and signs out&quot;, async () =&gt; {
    render(
      &lt;AuthProvider&gt;
        &lt;TestComponent /&gt;
      &lt;/AuthProvider&gt;,
    )

    expect(await screen.findByText(/mockId/i)).toBeOnTheScreen()
    fireEvent.press(screen.getByText(/Sign Out/i))

    expect(
      await screen.findByText(/Mock Sign in with Google/i),
    ).toBeOnTheScreen()

    fireEvent.press(screen.getByText(/Mock Sign in with Google/i))
    expect(await screen.findByText(/Sign Out/i)).toBeOnTheScreen()
  })
})

</code></pre>
<div line-highlight='43, only'></div>
<h3 id="exercise-1">Exercise 1</h3>
<p>First, we need to finish implementing the <code>AuthContext</code> in <code>AuthProvider</code>:</p>
<ul>
<li>Implement <code>signIn</code> and <code>signOut</code> using <code>useCallback</code>.</li>
<li>When a sign in is successful, update the <code>user</code>.</li>
</ul>
<p>Next, in <code>App.js</code></p>
<ul>
<li>Add the <code>AuthProvider</code> to the <code>App</code> component.</li>
</ul>
<p>Finally, in <code>Settings.js</code>:</p>
<ul>
<li>Use the hooks from <code>AuthContext</code> to grab the <code>user</code> state, and <code>signIn</code> and <code>signOut</code> callbacks.</li>
<li>Implement a conditional to render the a button to Sign In or Sign Out based on the user’s state.</li>
</ul>
<h3 id="solution-1">Solution 1</h3>
<p>If you’ve implemented the solution correctly, the tests will pass when you run <code>npm run test</code>!</p>
<p><details>
<summary>Click to see the solution</summary></p>
<p>✏️ Update <strong>src/App.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { createBottomTabNavigator } from &quot;@react-navigation/bottom-tabs&quot;
import { NavigationContainer } from &quot;@react-navigation/native&quot;
import { createStackNavigator } from &quot;@react-navigation/stack&quot;
import Box from &quot;@shared/design/Box&quot;
import ThemeProvider, { useTheme } from &quot;@shared/design/theme/ThemeProvider&quot;
import Typography from &quot;@shared/design/Typography&quot;
import AuthProvider from &quot;@shared/services/auth/AuthProvider&quot;
import DataMigration from &quot;@shared/services/DataMigration&quot;
import { Pressable } from &quot;react-native&quot;
import { SafeAreaView } from &quot;react-native-safe-area-context&quot;
import Icon from &quot;react-native-vector-icons/Ionicons&quot;

import CityList from &quot;./screens/CityList&quot;
import RestaurantDetails from &quot;./screens/RestaurantDetails&quot;
import RestaurantList from &quot;./screens/RestaurantList&quot;
import RestaurantOrder from &quot;./screens/RestaurantOrder&quot;
import Settings from &quot;./screens/Settings&quot;
import StateList from &quot;./screens/StateList&quot;

declare global {
  // eslint-disable-next-line @typescript-eslint/no-namespace
  namespace ReactNavigation {
    // eslint-disable-next-line @typescript-eslint/no-empty-interface
    interface RootParamList extends RestaurantsStackParamList {}
  }
}

export type RestaurantsStackParamList = {
  StateList: undefined
  CityList: {
    state: {
      name: string
      short: string
    }
  }
  RestaurantList: {
    state: {
      name: string
      short: string
    }
    city: {
      name: string
      state: string
    }
  }
  RestaurantDetails: {
    slug: string
  }
  RestaurantOrder: {
    slug: string
  }
}

const RestaurantsStack = createStackNavigator&lt;RestaurantsStackParamList&gt;()
const RestaurantsNavigator: React.FC = () =&gt; {
  return (
    &lt;RestaurantsStack.Navigator
      initialRouteName=&quot;StateList&quot;
      screenOptions={{
        header: ({ route, navigation }) =&gt; {
          if (!navigation.canGoBack()) return null

          return (
            &lt;Pressable onPress={navigation.goBack}&gt;
              &lt;Box
                padding=&quot;m&quot;
                style={{ flexDirection: &quot;row&quot;, gap: 8, alignItems: &quot;center&quot; }}
              &gt;
                &lt;Icon name=&quot;arrow-back&quot; size={20} /&gt;
                &lt;Typography variant=&quot;heading&quot;&gt;
                  {/* @ts-ignore */}
                  {[route.params?.city?.name, route.params?.state?.name]
                    .filter(Boolean)
                    .join(&quot;, &quot;)}
                &lt;/Typography&gt;
              &lt;/Box&gt;
            &lt;/Pressable&gt;
          )
        },
      }}
    &gt;
      &lt;RestaurantsStack.Screen name=&quot;StateList&quot; component={StateList} /&gt;
      &lt;RestaurantsStack.Screen name=&quot;CityList&quot; component={CityList} /&gt;
      &lt;RestaurantsStack.Screen
        name=&quot;RestaurantList&quot;
        component={RestaurantList}
      /&gt;
      &lt;RestaurantsStack.Screen
        name=&quot;RestaurantDetails&quot;
        component={RestaurantDetails}
      /&gt;
      &lt;RestaurantsStack.Screen
        name=&quot;RestaurantOrder&quot;
        component={RestaurantOrder}
      /&gt;
    &lt;/RestaurantsStack.Navigator&gt;
  )
}

const AppTabs = createBottomTabNavigator()
const AppNavigator: React.FC = () =&gt; {
  const theme = useTheme()

  return (
    &lt;AppTabs.Navigator
      initialRouteName=&quot;RestaurantsStack&quot;
      screenOptions={({ route }) =&gt; ({
        headerStyle: {
          backgroundColor: theme.palette.screen.main,
        },
        headerTitleStyle: {
          color: theme.palette.screen.contrast,
          ...theme.typography.title,
        },
        tabBarStyle: {
          backgroundColor: theme.palette.screen.main,
        },
        tabBarActiveTintColor: theme.palette.primary.strong,
        tabBarInactiveTintColor: theme.palette.screen.contrast,
        tabBarIcon: ({ focused, color }) =&gt; {
          let icon = &quot;settings&quot;
          if (route.name === &quot;Settings&quot;) {
            icon = focused ? &quot;settings&quot; : &quot;settings-outline&quot;
          } else if (route.name === &quot;Restaurants&quot;) {
            icon = focused ? &quot;restaurant&quot; : &quot;restaurant-outline&quot;
          }

          return &lt;Icon name={icon} size={20} color={color} /&gt;
        },
      })}
    &gt;
      &lt;AppTabs.Screen
        name=&quot;Restaurants&quot;
        component={RestaurantsNavigator}
        options={{ title: &quot;Place My Order&quot; }}
      /&gt;
      &lt;AppTabs.Screen
        name=&quot;Settings&quot;
        component={Settings}
        options={{ title: &quot;Settings&quot; }}
      /&gt;
    &lt;/AppTabs.Navigator&gt;
  )
}

const App: React.FC = () =&gt; {
  return (
    &lt;SafeAreaView style={{ flex: 1 }}&gt;
      &lt;ThemeProvider&gt;
        &lt;AuthProvider&gt;
          &lt;DataMigration&gt;
            &lt;NavigationContainer&gt;
              &lt;AppNavigator /&gt;
            &lt;/NavigationContainer&gt;
          &lt;/DataMigration&gt;
        &lt;/AuthProvider&gt;
      &lt;/ThemeProvider&gt;
    &lt;/SafeAreaView&gt;
  )
}

export default App

</code></pre>
 <div line-highlight="150-156,only"></div>
<p>✏️ Update <strong>src/screens/Settings/Settings.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { GoogleSigninButton } from &quot;@react-native-google-signin/google-signin&quot;
import Loading from &quot;@shared/components/Loading&quot;
import Button from &quot;@shared/design/Button&quot;
import Card from &quot;@shared/design/Card&quot;
import Screen from &quot;@shared/design/Screen&quot;
import { useThemeMode } from &quot;@shared/design/theme&quot;
import Typography from &quot;@shared/design/Typography&quot;
import { useAuthentication, useUser } from &quot;@shared/services/auth&quot;
import { StyleSheet, Switch, View } from &quot;react-native&quot;

const Settings: React.FC = () =&gt; {
  const { error, isPending, signIn, signOut } = useAuthentication()
  const user = useUser()
  const { mode, setMode } = useThemeMode()

  return (
    &lt;Screen&gt;
      &lt;Card&gt;
        {isPending ? (
          &lt;Loading /&gt;
        ) : user ? (
          &lt;&gt;
            &lt;Typography variant=&quot;heading&quot;&gt;Welcome back&lt;/Typography&gt;
            &lt;Typography variant=&quot;body&quot;&gt;
              {user.name || &quot;Unknown name&quot;}
            &lt;/Typography&gt;
            &lt;Button onPress={signOut}&gt;Sign out&lt;/Button&gt;
            {error ? (
              &lt;Typography variant=&quot;body&quot;&gt;Error: {error.message}&lt;/Typography&gt;
            ) : null}
          &lt;/&gt;
        ) : (
          &lt;&gt;
            &lt;GoogleSigninButton onPress={signIn} style={{ width: &quot;100%&quot; }} /&gt;
            {error ? (
              &lt;Typography variant=&quot;body&quot;&gt;Error: {error.message}&lt;/Typography&gt;
            ) : null}
          &lt;/&gt;
        )}
      &lt;/Card&gt;
      &lt;Card&gt;
        &lt;View style={styles.row}&gt;
          &lt;Typography variant=&quot;heading&quot;&gt;Dark mode&lt;/Typography&gt;
          &lt;Switch
            onValueChange={(value) =&gt; setMode(value ? &quot;dark&quot; : &quot;light&quot;)}
            value={mode === &quot;dark&quot;}
          /&gt;
        &lt;/View&gt;
      &lt;/Card&gt;
    &lt;/Screen&gt;
  )
}

const styles = StyleSheet.create({
  row: {
    flexDirection: &quot;row&quot;,
    alignItems: &quot;center&quot;,
    justifyContent: &quot;space-between&quot;,
  },
})

export default Settings

</code></pre>
 <div line-highlight="12-13,19-39,only"></div>
<p>✏️ Update <strong>src/shared/services/auth/AuthProvider.tsx</strong> to be:</p>
<pre><code class="language-tsx">import {
  User as UserInfo,
  GoogleSignin,
} from &quot;@react-native-google-signin/google-signin&quot;
import { useCallback, useEffect, useMemo, useState } from &quot;react&quot;

import { AuthContext, AuthContextProvider, useAuthContext } from &quot;./context&quot;

const googleOauthwebClientId = process.env.GOOGLE_OAUTH_CLIENT_ID

GoogleSignin.configure({
  scopes: [&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;],
  webClientId: googleOauthwebClientId,
})

export interface AuthProviderProps {
  children: React.ReactNode
}

const AuthProvider: React.FC&lt;AuthProviderProps&gt; = ({ children }) =&gt; {
  const [error, setError] = useState&lt;Error | undefined&gt;()
  const [isPending, setIsPending] = useState&lt;boolean&gt;(true)
  const [userInfo, setUserInfo] = useState&lt;UserInfo | undefined&gt;()

  const signIn = useCallback(async () =&gt; {
    try {
      setError(undefined)
      setIsPending(true)

      const userInfo = await GoogleSignin.signIn()

      setIsPending(false)
      setUserInfo(userInfo)

      return userInfo.user
    } catch (error) {
      console.error(&quot;Call to GoogleSignin.signIn() failed with error:&quot;, error)

      setError(error as Error)
      setIsPending(false)
      setUserInfo(undefined)

      return false
    }
  }, [])

  const signOut = useCallback(async () =&gt; {
    try {
      setError(undefined)
      setIsPending(true)

      await GoogleSignin.signOut()

      setIsPending(false)
      setUserInfo(undefined)

      return true
    } catch (error) {
      console.error(&quot;Call to GoogleSignin.signOut() failed with error:&quot;, error)

      setError(error as Error)
      setIsPending(false)

      return false
    }
  }, [])

  useEffect(() =&gt; {
    async function run() {
      try {
        setError(undefined)
        setIsPending(true)

        const userInfo = await GoogleSignin.getCurrentUser()

        setIsPending(false)
        setUserInfo(userInfo || undefined)
      } catch (error) {
        console.error(
          &quot;Call to GoogleSignin.getCurrentUser() failed with error:&quot;,
          error,
        )

        setError(error as Error)
        setIsPending(false)
      }
    }

    run()
  }, [])

  const value = useMemo&lt;AuthContext&gt;(
    () =&gt; ({
      signIn,
      signOut,
      error,
      isAuthenticated: userInfo
        ? true
        : userInfo === undefined
        ? false
        : undefined,
      isPending,
      user: userInfo?.user,
      scopes: userInfo?.scopes,
      idToken: userInfo?.idToken,
    }),
    [error, isPending, signIn, signOut, userInfo],
  )

  return &lt;AuthContextProvider value={value}&gt;{children}&lt;/AuthContextProvider&gt;
}

export default AuthProvider

export function useAuthentication(): Pick&lt;
  AuthContext,
  &quot;error&quot; | &quot;isPending&quot; | &quot;signIn&quot; | &quot;signOut&quot;
&gt; {
  const { error, isPending, signIn, signOut } = useAuthContext()

  return { error, isPending, signIn, signOut }
}

export function useAuthenticated(): boolean | undefined {
  const { isAuthenticated } = useAuthContext()

  return isAuthenticated
}

export function useUser(): UserInfo[&quot;user&quot;] | undefined {
  const { user } = useAuthContext()

  return user
}

</code></pre>
 <div line-highlight="5,20,25,30,47,52,66,74,77,85,90,only"></div>
<p></details></p>
<h2 id="next-steps">Next steps</h2>
<p>Next, with some of the new tricks we’ve learned we’ll also add <a href="./offline-support.html">Offline Support</a> so our app is still usable during network outages.</p>

</section>

  			
  			<bit-prev-next class="footer" list-selector=".sidebar-left ul li.parent.expanded ul"></bit-prev-next>
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout discord">
          <h6>Get help</h6>
          <p>If you need <a href="https://discord.gg/J7ejFsZnJ4">help</a> with an exercise, please reach out to us on
             <a href="https://discord.gg/J7ejFsZnJ4">Discord</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com</a></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/react-native/16-security-and-auth/security-and-auth.md"},"description":"Learn about security, authentication, and authorization by implementing Google Sign-In. \n","name":"learn-react-native/security-and-auth","title":"Security and Authentication","type":"page","parent":"learn-react-native","order":16,"outline":{"depth":3},"comment":" ","pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
  <div id="email-modal" role="dialog" aria-modal="true" aria-labelledby="dialog_label" style="display: none;">
    <div aria-hidden="true" class="email-modal-backdrop"></div>
    <div role="region" class="email-modal-content">
      <h2 id="dialog_label">Join the Bitovi Newsletter</h2>
      <p>
        Do you want to receive updates about new Bitovi Academy courses, Bitovi open source projects, and dev community news? If so, please provide your email. We won’t spam you or give it away for any reason!<br />
        <i style="font-size: 0.8rem;">By providing your email you agree to receive communications from Bitovi</i>
      </p>
      <div id="academy-hubspot-form-embed"></div>
      <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
      <button id="email-modal-close" title="dismiss"><img src="../static/img/close.svg" height="24" width="24"></button>
    </div>
  </div>
</body>
</html>
