<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/react-native/13-making-http-requests/making-http-requests.md
	@page learn-react-native/making-http-requests
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Learn about how to make &#x60;fetch&#x60; requests and render requested data in React Native components. 
">
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P9MQVJS');</script>
  <!-- End Google Tag Manager -->

  <title>Bitovi Academy - Making HTTP Requests</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9MQVJS"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget. We strongly suggest finishing learn-advanced-javascript prior to starting this course.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-react-native.html"
							title="Learn React Native by building the feature-rich Place My Order application in this beginner React Native guide. This hands-on course will introduce you to fundamental React Native concepts! By the end of this course, you will have a strong understanding of JSX, function components, styling, state management, Hooks, data fetching, routing, and testing.">
							Learn React Native
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="intro-to-react-native.html"
							title="Discover why React Native is a great choice for modern mobile application development.">
							Introduction to React Native
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="setting-up-your-environment.html"
							title="Learn how to set up your environment for React Native development.">
							Setting Up Your Environment
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-a-new-app.html"
							title="Generate a new React Native application using the CLI.">
							Creating a New Application
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="intro-to-jsx.html"
							title="Learn how to use JSX to define your UI in React Native.">
							Introduction to JSX
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="intro-to-testing.html"
							title="Learn about testing solutions in React Native.">
							Introduction to Testing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-custom-components.html"
							title="Learn about components, the core building blocks of every React application.">
							Building Custom Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="debugging-devtools.html"
							title="Learn how to set up and use both DevTools and Debugger.">
							Debugging and DevTools
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="styling.html"
							title="Learn how to use the style prop and the StyleSheet API in React Native.">
							Styling in React Native
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="react-context.html"
							title="Learn how to share a common theme by creating a React Context.">
							Using React Context
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="managing-state.html"
							title="Work with React’s useState Hook to manage a component’s state.">
							Managing State with useState
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="navigation.html"
							title="Learn how to use navigation to move between screens in a React Native app.">
							Navigation in React Native
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="navigation-params.html"
							title="Maintain the React state with React Native Navigation Parameters">
							Storing State in Navigation Parameters
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="making-http-requests.html"
							title="Learn about how to make fetch requests and render requested data in React Native components.">
							Making HTTP Requests
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="user-inputs.html"
							title="Use switch controls and inputs to collect information.">
							Handling User Inputs
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="using-asyncstorage.html"
							title="Store data locally on device with Async Storage and run data migrations with new versions of your application.">
							Using Async Storage
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="security-and-auth.html"
							title="Learn about security, authentication, and authorization by implementing Google Sign-In.">
							Security and Authentication
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="offline-support.html"
							title="Learn device-first strategies for storing data and syncing it to a server.">
							Adding Offline Support
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="google-maps.html"
							title="Learn how to integrate Google Maps into your React Native application.">
							Integrating Maps
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="performance-optimization.html"
							title="Improve the application’s launch time by implementing lazy loading.">
							Performance and Optimization
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building.html"
							title="Learn how to build Android App Bundle (AAB) files.">
							Building React Native Apps
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="publishing-and-updating.html"
							title="Preparation for the steps to Publish and Update a production application on Stores.">
							Publishing and Updating
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-agile-program-management-with-jira.html"
							title="Learn how to build, maintain, and report on accurate multi-team plans with Jira.">
							Agile Program Management With Jira
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to move beyond writing code to be an excellent technology consultant!">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building the feature-rich Place My Order application in this beginner React guide. This hands-on course will introduce you to fundamental React concepts! By the end of this course, you will have a strong understanding of JSX, function components, styling, state management, Hooks, data fetching, routing, and testing.">
							Learn React
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-ngrx.html"
							title="Learn how to manage state in an Angular application using NgRx.">
							Learn NgRx
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-graphql.html"
							title="Build a backend application for property rentals using Node JS, GraphQL and Apollo Server.         Learn about using ORMs like Mongoose and Prisma with a NoSQL Mongo database!
Write testcases testing created endpoints.">
							Learn Graphql
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a Node.js app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../advanced-typescript.html"
							title="This is the second course in the TypeScript series. By the end, you will be comfortable with any types you come across and possess the knowledge to create your own advanced types. The only prerequisite is the first course in the TypeScript series found here.">
							Advanced TypeScript
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Making HTTP Requests <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Learn about how to make <code>fetch</code> requests and render requested data in React Native components.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2>Overview</h2>
<p>In this section, you will:</p>
<ul>
<li>Manage environment variables.</li>
<li>Define interfaces for <code>useState</code>.</li>
<li>Explore the <code>useEffect</code> Hook.</li>
<li>Understand the effect callback function.</li>
<li>Utilize the dependency array.</li>
<li>Perform async operations inside <code>useEffect</code>.</li>
<li>Implement cleanup functions.</li>
<li>Catch network errors.</li>
<li>Handle HTTP error statuses.</li>
<li>Include query parameters in API calls.</li>
</ul>
<h2>Objective 1: Fetch states in a custom Hook</h2>
<p>So far we’ve only had hard-coded data for our states, cities, and restaurants. Let’s start loading data from an API server, beginning with the list of states!</p>
<p><img alt="Screenshot of the application when it makes an API call to the states endpoint and is populated the list of states." src="../static/img/react-native/13-making-http-requests/1-solution.png" style="max-height: 640px; border: 4px solid black; border-radius: 25px;"/></p>
<h3>Defining interfaces for <code>useState</code></h3>
<p>When building React Native components, you may sometimes have local state variables that always change together, and thus would benefit by being in a single <code>useState()</code> variable together:</p>
<pre><code class="language-tsx">import { useState } from &quot;react&quot;
import { View, Text, Pressable } from &quot;react-native&quot;

interface UserProfile {
  email: string
  name: string
}

const UserProfileComponent: React.FC = () =&gt; {
  const [userProfile, setUserProfile] = useState&lt;UserProfile&gt;({
    email: &quot;grace.hopper@example.com&quot;,
    name: &quot;Grace Hopper&quot;,
  })

  const updateProfile = () =&gt; {
    setUserProfile({
      email: &quot;ada.lovelace@example.com&quot;,
      name: &quot;Ada Lovelace&quot;,
    })
  }

  return (
    &lt;View&gt;
      &lt;Text&gt;Name: {userProfile.name}&lt;/Text&gt;
      &lt;Text&gt;Email: {userProfile.email}&lt;/Text&gt;
      &lt;Pressable onPress={updateProfile}&gt;
        &lt;Text&gt;Update profile&lt;/Text&gt;
      &lt;/Pressable&gt;
    &lt;/View&gt;
  )
}

export default UserProfileComponent

</code></pre>
<div line-highlight='4-7, 10, 16-19, only'></div>
<p>In the example above, we have a <code>UserProfile</code> interface that keeps track of an <code>email</code> and <code>name</code>. We can use that interface when we call <code>useState()</code> so TypeScript is aware of the typing for the state variable and its setter.</p>
<h3>The <code>useEffect</code> Hook</h3>
<p><code>useEffect</code> is a React Hook that lets you perform side effects in your function components. It serves as a powerful tool to execute code in response to component renders or state changes.</p>
<p>Here is an example component with <code>useEffect</code>:</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { Keyboard, Text, View } from &quot;react-native&quot;

const GeolocationComponent: React.FC = () =&gt; {
  const [keyboardStatus, setKeyboardStatus] = useState(&quot;&quot;)

  useEffect(() =&gt; {
    // Effect callback function
    const showSubscription = Keyboard.addListener(&quot;keyboardDidShow&quot;, () =&gt; {
      setKeyboardStatus(&quot;Keyboard shown&quot;)
    })
    const hideSubscription = Keyboard.addListener(&quot;keyboardDidHide&quot;, () =&gt; {
      setKeyboardStatus(&quot;Keyboard hidden&quot;)
    })

    return () =&gt; {
      // Teardown function
      showSubscription.remove()
      hideSubscription.remove()
    }
  }, []) // Dependency array

  return (
    &lt;View&gt;
      {keyboardStatus ? (
        &lt;Text&gt;{keyboardStatus}&lt;/Text&gt;
      ) : (
        &lt;Text&gt;Checking keyboard status…&lt;/Text&gt;
      )}
    &lt;/View&gt;
  )
}

export default GeolocationComponent

</code></pre>
<div line-highlight='1, 7-21, only'></div>
<p>Let’s break this example down by the two arguments that <code>useEffect</code> takes:</p>
<h3>Effect callback function</h3>
<p>The first argument of <code>useEffect</code> is a function, often referred to as the “effect” function. This is where you perform your side effects, such as fetching data, setting up a subscription, or manually changing the UI in React Native components.</p>
<p>The key aspect of this function is that it’s executed after the component renders. The effects in <code>useEffect</code> don’t block the UI from updating the screen, leading to more responsive UIs.</p>
<p>This effect function can optionally return another function, known as the “cleanup” function. The cleanup function is useful for performing any necessary cleanup activities when the component unmounts or before the component re-renders and the effect is re-invoked. Common examples include clearing timers, canceling network requests, or removing event listeners.</p>
<h3>The dependency array</h3>
<p>The second argument of <code>useEffect</code> is an array, called the “dependency array”, which determines when your effect function should be called. The behavior of the effect changes based on the contents of this array:</p>
<p>Consider three scenarios based on the dependency array:</p>
<h4>Empty dependency array (<code>[]</code>)</h4>
<p>If the dependency array is an empty array, the effect runs once after the initial render.</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { Keyboard, Text, View } from &quot;react-native&quot;

const GeolocationComponent: React.FC = () =&gt; {
  const [keyboardStatus, setKeyboardStatus] = useState(&quot;&quot;)

  useEffect(() =&gt; {
    // Effect callback function
    const showSubscription = Keyboard.addListener(&quot;keyboardDidShow&quot;, () =&gt; {
      setKeyboardStatus(&quot;Keyboard shown&quot;)
    })
    const hideSubscription = Keyboard.addListener(&quot;keyboardDidHide&quot;, () =&gt; {
      setKeyboardStatus(&quot;Keyboard hidden&quot;)
    })

    return () =&gt; {
      // Teardown function
      showSubscription.remove()
      hideSubscription.remove()
    }
  }, []) // Dependency array

  return (
    &lt;View&gt;
      {keyboardStatus ? (
        &lt;Text&gt;{keyboardStatus}&lt;/Text&gt;
      ) : (
        &lt;Text&gt;Checking keyboard status…&lt;/Text&gt;
      )}
    &lt;/View&gt;
  )
}

export default GeolocationComponent

</code></pre>
<div line-highlight='7-21, only'></div>
<h4>Array with values</h4>
<p>When you include values (variables, props, state) in the dependency array, the effect will only re-run if those specific values change between renders. This selective execution can optimize performance by avoiding unnecessary work.</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { Pressable, Vibration, View } from &quot;react-native&quot;

function VibrateButtons() {
  const [vibrate, setVibrate] = useState(false)

  useEffect(() =&gt; {
    if (vibrate) {
      Vibration.vibrate(1000)
    }

    return () =&gt; {
      Vibration.cancel()
    }
  }, [vibrate])

  return (
    &lt;View&gt;
      &lt;Pressable onPress={() =&gt; setVibrate(true)}&gt;
        &lt;Text&gt;Vibrate&lt;/Text&gt;
      &lt;/Pressable&gt;
      &lt;Pressable onPress={() =&gt; setVibrate(false)}&gt;
        &lt;Text&gt;Stop vibrating&lt;/Text&gt;
      &lt;/Pressable&gt;
    &lt;/View&gt;
  )
}

export default VibrateButtons

</code></pre>
<div line-highlight='5, 7, 15, 19, 22, only'></div>
<h4>No dependency array</h4>
<p>If the dependency array is omitted, the effect runs after every render of the component. This should not be needed.</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { Pressable, Text } from &quot;react-native&quot;

function UpdateLogger() {
  const [count, setCount] = useState(0)

  useEffect(() =&gt; {
    console.info(&quot;Component updated!&quot;)
  }) // No dependency array, runs on every update

  return (
    &lt;Pressable onPress={() =&gt; setCount(count + 1)}&gt;
      &lt;Text&gt;Increment&lt;/Text&gt;
    &lt;/Pressable&gt;
  )
}

export default UpdateLogger

</code></pre>
<div line-highlight='9, only'></div>
<h3>Async operations inside <code>useEffect</code></h3>
<p>You can use APIs that return a <code>Promise</code> normally within a <code>useEffect</code>:</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { Text } from &quot;react-native&quot;

function DataFetcher() {
  const [data, setData] = useState(null)

  useEffect(() =&gt; {
    fetch(&quot;https://api.example.com/data&quot;)
      .then((response) =&gt; {
        const parsedData = await response.json()
        setData(parsedData)
      })
      .catch((error) =&gt; {
        // Error should be shown to the user
        console.error(&quot;Error fetching data:&quot;, error)
      })
  }, [])

  return &lt;Text&gt;{data}&lt;/Text&gt;
}

export default DataFetcher

</code></pre>
<div line-highlight='8-16, only'></div>
<p>However, unlike traditional functions, <code>useEffect</code> functions can’t be marked as async. This is because returning a <code>Promise</code> from <code>useEffect</code> would conflict with its mechanism, which expects either nothing or a clean-up function to be returned.</p>
<p>To handle asynchronous operations, you typically define an <code>async</code> function inside the effect and then call it:</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { Text } from &quot;react-native&quot;

function DataFetcher() {
  const [data, setData] = useState(null)

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      try {
        const response = await fetch(&quot;https://api.example.com/data&quot;)
        const parsedData = await response.json()
        setData(parsedData)
      } catch (error) {
        // Error should be shown to the user
        console.error(&quot;Error fetching data:&quot;, error)
      }
    }

    fetchData()
  }, [])

  return &lt;Text&gt;{data}&lt;/Text&gt;
}

export default DataFetcher

</code></pre>
<div line-highlight='8-19, only'></div>
<p>When using async/await, error handling is typically done using try-catch blocks. This allows you to gracefully handle any errors that occur during the execution of your async operation.</p>
<p>In this example, if <code>fetch</code> throws an error, the <code>catch</code> block catches and handles it. This pattern is crucial to prevent unhandled promise rejections and ensure that your application can respond appropriately to failures in asynchronous tasks.</p>
<h3>Cleanup functions</h3>
<p>The effect function can optionally return another function, known as the “cleanup” function. The cleanup function is useful for performing any necessary cleanup activities when the component unmounts or before the component re-renders and the effect is re-invoked. Common examples include clearing timers, canceling network requests, or removing event listeners.</p>
<pre><code class="language-tsx">import { useEffect, useState } from &quot;react&quot;
import { View, FlatList, Text } from &quot;react-native&quot;

function WebSocketComponent() {
  const [messages, setMessages] = useState([])

  useEffect(() =&gt; {
    const socket = new WebSocket(&quot;wss://chat.donejs.com/&quot;)

    socket.onmessage = (event) =&gt; {
      setMessages((previousMessages) =&gt; {
        return [...previousMessages, event.data]
      })
    }

    return () =&gt; {
      // Clean up (tear down) the socket connection
      return socket.close()
    }
  }, [])

  return (
    &lt;View&gt;
      &lt;FlatList
        data={messages}
        renderItem={({ item }) =&gt; &lt;Text&gt;{item}&lt;/Text&gt;}
        keyExtractor={(item, index) =&gt; index.toString()}
      /&gt;
    &lt;/View&gt;
  )
}

export default WebSocketComponent

</code></pre>
<div line-highlight='8, 16-19, only'></div>
<p>In the example above, we’re creating a WebSocket connection to an API when the component is first rendered (note the empty dependency array).</p>
<p>When the component is removed from the UI, the cleanup function will run and tear down the WebSocket connection.</p>
<h3>Environment variables</h3>
<p>The way we’re accessing our locally run API during development may be different than how we access it in production. To prepare for this, we’ll set an environment variable to do what we need.</p>
<p>Environment variables are dynamic-named values that can affect the way running processes on a computer will behave. In the context of software development, they are used to manage specific settings or configurations that should not be hardcoded within the application’s source code.</p>
<p>This is particularly useful for:</p>
<ul>
<li><strong>Security:</strong> Keeping sensitive data like API keys or database passwords out of the source code.</li>
<li><strong>Flexibility:</strong> Allowing configurations to change depending on the environment (development, staging, production).</li>
<li><strong>Convenience:</strong> Making it easier to update configuration settings without changing the application’s code.</li>
</ul>
<p>In our project, we’ll utilize environment variables to set ourselves up to be able to differentiate between the development and production environments, especially in how we connect to different instances of our API.</p>
<h4>Using environment variables with react-native-dotenv</h4>
<p>When using React Native with environment variables, you can utilize a package like &quot;react-native-dotenv&quot; to manage environment variables. Here’s how you can adapt the provided context for a React Native application:</p>
<p>Here’s how we can use it: in our project’s root directory, we can create a <code>.env</code> file with variables like this:</p>
<pre><code>PMO_API=http://localhost:7070

</code></pre>
<p>Then we can access this variable using <code>process.env.PMO_API</code>:</p>
<pre><code class="language-tsx">const response = await fetch(`${process.env.PMO_API}/data`, {
  method: &quot;GET&quot;,
})

const data = await response.json()
</code></pre>
<div line-highlight='1'></div>
<p>Concatenating the two, this will be the equivalent of making this <code>fetch</code> request:</p>
<pre><code class="language-tsx">const response = await fetch(`http://localhost:7070/data`, {
  method: &quot;GET&quot;,
})
</code></pre>
<div line-highlight='1'></div>
<h3>Setup 1</h3>
<p>Before we begin requesting data from our API, we need to install the &quot;place-my-order-api&quot; module, which will generate fake restaurant data and serve it from port <code>7070</code>.</p>
<p>✏️ Install the new dev dependency:</p>
<pre><code class="language-bash">npm install --save-dev place-my-order-api@1 react-native-dotenv@3
</code></pre>
<p>✏️ Create <strong>.env.example</strong> and update it to be:</p>
<pre><code class="language-example">PMO_API=http://localhost:7070

</code></pre>
<div line-highlight='1, only'></div>
<p>✏️ Duplicate <strong>.env.example</strong> to <strong>.env</strong> in your project.</p>
<p>It’s always a good idea to keep a <code>.env.example</code> file up to date (and committed to git) in your project, then include the actual secrets in your local <code>.env</code> file (and not committed to git).</p>
<p>We do not have any secret values yet, so our <code>.env</code> can be an exact duplicate of the <code>.env.example</code> file.</p>
<p>✏️ Update <strong>.gitignore</strong> to be:</p>
<pre><code># OSX
#
.DS_Store

# Windows
#
Thumbs.db

# Xcode
#
build/
*.pbxuser
!default.pbxuser
*.mode1v3
!default.mode1v3
*.mode2v3
!default.mode2v3
*.perspectivev3
!default.perspectivev3
xcuserdata
*.xccheckout
*.moved-aside
DerivedData
*.hmap
*.ipa
*.xcuserstate
**/.xcode.env.local

# Android/IntelliJ
#
build/
.idea
.gradle
local.properties
*.iml
*.hprof
.cxx/
*.keystore
!debug.keystore

# node.js
#
node_modules/
npm-debug.log
yarn-error.log

# fastlane
#
# It is recommended to not store the screenshots in the git repo. Instead, use fastlane to re-generate the
# screenshots whenever they are needed.
# For more information about the recommended setup visit:
# https://docs.fastlane.tools/best-practices/source-control/

**/fastlane/report.xml
**/fastlane/Preview.html
**/fastlane/screenshots
**/fastlane/test_output

# Bundle artifact
*.jsbundle
*.tsbuildinfo

# Environment variables
.env

# Place My Order API
/db-data

# Ruby / CocoaPods
**/Pods/
/vendor/bundle/

# Temporary files created by Metro to check the health of the file watcher
.metro-health-check*

# testing
/coverage

# Yarn
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions

</code></pre>
 <div line-highlight="63-64,66-67,only"></div>
<p>✏️ Update <strong>babel.config.js</strong> to be:</p>
<pre><code class="language-js">module.exports = {
  plugins: [&quot;module:react-native-dotenv&quot;],
  presets: [&quot;module:@react-native/babel-preset&quot;],
}

</code></pre>
 <div line-highlight="2,only"></div>
<p>✏️ Create <strong>src/env.d.ts</strong> and update it to be:</p>
<pre><code class="language-ts">/* eslint-disable @typescript-eslint/no-namespace */

declare global {
  namespace NodeJS {
    interface ProcessEnv {
      readonly PMO_API: string
    }
  }
}

export {}

</code></pre>
<div line-highlight='6, only'></div>
<p>✏️ Terminate the existing dev server and start it again:</p>
<pre><code class="language-bash">npm run start
</code></pre>
<p>✏️ Update <strong>package.json</strong> to be:</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;PlaceMyOrder&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;android&quot;: &quot;react-native run-android&quot;,
    &quot;android:linkLocalhost&quot;: &quot;adb reverse tcp:7070 tcp:7070&quot;,
    &quot;api&quot;: &quot;npm run android:linkLocalhost &amp;&amp; place-my-order-api --port 7070&quot;,
    &quot;clean&quot;: &quot;rm -rf tsconfig.tsbuildinfo coverage android/.gradle android/build android/app/build node_modules/.cache&quot;,
    &quot;depcheck&quot;: &quot;depcheck .&quot;,
    &quot;devtools&quot;: &quot;react-devtools&quot;,
    &quot;eslint&quot;: &quot;eslint .&quot;,
    &quot;eslint:fix&quot;: &quot;eslint --fix .&quot;,
    &quot;ios&quot;: &quot;react-native run-ios&quot;,
    &quot;lint&quot;: &quot;npm run eslint &amp;&amp; npm run prettier&quot;,
    &quot;lint:fix&quot;: &quot;npm run eslint:fix &amp;&amp; npm run prettier:fix&quot;,
    &quot;precheck&quot;: &quot;npm run typecheck &amp;&amp; npm run lint &amp;&amp; npm run depcheck &amp;&amp; npm test&quot;,
    &quot;prettier&quot;: &quot;prettier --check .&quot;,
    &quot;prettier:fix&quot;: &quot;prettier --write .&quot;,
    &quot;start&quot;: &quot;react-native start --reset-cache --experimental-debugger&quot;,
    &quot;test&quot;: &quot;jest&quot;,
    &quot;test:inspect&quot;: &quot;node --inspect-brk ./node_modules/.bin/jest --watch&quot;,
    &quot;test:watch&quot;: &quot;jest --watch&quot;,
    &quot;typecheck&quot;: &quot;tsc --noEmit&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@react-navigation/bottom-tabs&quot;: &quot;^6.5.20&quot;,
    &quot;@react-navigation/native&quot;: &quot;^6.1.17&quot;,
    &quot;@react-navigation/stack&quot;: &quot;^6.3.29&quot;,
    &quot;react&quot;: &quot;18.2.0&quot;,
    &quot;react-native&quot;: &quot;0.74.1&quot;,
    &quot;react-native-gesture-handler&quot;: &quot;^2.16.2&quot;,
    &quot;react-native-safe-area-context&quot;: &quot;^4.10.1&quot;,
    &quot;react-native-screens&quot;: &quot;^3.31.1&quot;,
    &quot;react-native-vector-icons&quot;: &quot;^10.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@babel/core&quot;: &quot;^7.20.0&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.20.0&quot;,
    &quot;@babel/runtime&quot;: &quot;^7.20.0&quot;,
    &quot;@bitovi/eslint-config&quot;: &quot;^1.8.0&quot;,
    &quot;@react-native/babel-preset&quot;: &quot;0.74.83&quot;,
    &quot;@react-native/eslint-config&quot;: &quot;0.74.83&quot;,
    &quot;@react-native/metro-config&quot;: &quot;0.74.83&quot;,
    &quot;@react-native/typescript-config&quot;: &quot;0.74.83&quot;,
    &quot;@testing-library/react-native&quot;: &quot;^12.5.0&quot;,
    &quot;@types/jest&quot;: &quot;^29.5.12&quot;,
    &quot;@types/react&quot;: &quot;^18.2.6&quot;,
    &quot;@types/react-native-vector-icons&quot;: &quot;^6.4.18&quot;,
    &quot;@types/react-test-renderer&quot;: &quot;^18.0.0&quot;,
    &quot;babel-jest&quot;: &quot;^29.6.3&quot;,
    &quot;depcheck&quot;: &quot;^1.4.7&quot;,
    &quot;eslint&quot;: &quot;^8.19.0&quot;,
    &quot;identity-obj-proxy&quot;: &quot;^3.0.0&quot;,
    &quot;jest&quot;: &quot;^29.6.3&quot;,
    &quot;place-my-order-api&quot;: &quot;^1.7.0&quot;,
    &quot;prettier&quot;: &quot;2.8.8&quot;,
    &quot;react-devtools&quot;: &quot;^5.2.0&quot;,
    &quot;react-native-dotenv&quot;: &quot;^3.4.11&quot;,
    &quot;react-test-renderer&quot;: &quot;18.2.0&quot;,
    &quot;typescript&quot;: &quot;5.0.4&quot;
  },
  &quot;engines&quot;: {
    &quot;node&quot;: &quot;&gt;=20&quot;
  }
}

</code></pre>
<div line-highlight='7-8, only'></div>
<p>✏️ In a <strong>new</strong> command-line interface (CLI) window, start the API server by running:</p>
<pre><code class="language-bash">npm run api
</code></pre>
<p>Double-check the API by navigating to <a href="http://localhost:7070/restaurants">localhost:7070/restaurants</a>. You should see a JSON list of restaurant data.</p>
<p>It will be helpful to have a third command-line interface (CLI) tab for the <code>npm run api</code> command.</p>
<p>✏️ Update <strong>src/App.test.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { render, screen } from &quot;@testing-library/react-native&quot;

import App from &quot;./App&quot;

const oldFetch = global.fetch
const mockFetch = jest.fn()
beforeAll(() =&gt; {
  global.fetch = mockFetch
})
afterAll(() =&gt; {
  global.fetch = oldFetch
})

describe(&quot;App&quot;, () =&gt; {
  const mockStateResponse = {
    data: [
      { short: &quot;MI&quot;, name: &quot;Michigan&quot; },
      { short: &quot;WI&quot;, name: &quot;Wisconsin&quot; },
      { short: &quot;IL&quot;, name: &quot;Illinois&quot; },
    ],
  }

  it(&quot;renders&quot;, async () =&gt; {
    mockFetch.mockResolvedValueOnce({
      ok: true,
      json: () =&gt; Promise.resolve(mockStateResponse),
      statusText: &quot;OK&quot;,
      status: 200,
    })

    render(&lt;App /&gt;)

    const placeMyOrderText = await screen.findAllByText(/Place my order/i)
    expect(placeMyOrderText).toHaveLength(2)
  })
})

</code></pre>
 <div line-highlight="5-8,10-12,15-21,24-29,33-34,36,only"></div>
<p>✏️ Create <strong>src/services/pmo/restaurant/interfaces.ts</strong> and update it to be:</p>
<pre><code class="language-ts">export interface State {
  name: string
  short: string
}

</code></pre>
<p>✏️ Create <strong>src/services/pmo/restaurant/hooks.ts</strong> and update it to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { State } from &quot;./interfaces&quot;

const baseUrl = process.env.PMO_API

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

export function useStates(): StatesResponse {
  // Exercise: Update the `useState` in `hooks.ts` to call `useEffect()` and `fetch` data from `${process.env.PMO_API}/states`.
}

</code></pre>
<div line-highlight='14, only'></div>
<p>✏️ Create <strong>src/services/pmo/restaurant/index.ts</strong> and update it to be:</p>
<pre><code class="language-ts">export * from &quot;./interfaces&quot;
export * from &quot;./hooks&quot;

</code></pre>
<p>✏️ Create <strong>src/components/Loading/Loading.tsx</strong> and update it to be:</p>
<pre><code class="language-tsx">import { ActivityIndicator } from &quot;react-native&quot;

import Box from &quot;../../design/Box&quot;
import { useTheme } from &quot;../../design/theme&quot;
import Typography from &quot;../../design/Typography&quot;

const Loading: React.FC = () =&gt; {
  const theme = useTheme()

  return (
    &lt;Box padding=&quot;l&quot;&gt;
      &lt;ActivityIndicator size=&quot;large&quot; color={theme.palette.primary.main} /&gt;
      &lt;Typography variant=&quot;body&quot; style={{ textAlign: &quot;center&quot;, marginTop: 8 }}&gt;
        Loading…
      &lt;/Typography&gt;
    &lt;/Box&gt;
  )
}

export default Loading

</code></pre>
<p>✏️ Create <strong>src/components/Loading/Loading.test.tsx</strong> and update it to be:</p>
<pre><code class="language-tsx">import { render, screen } from &quot;@testing-library/react-native&quot;

import Loading from &quot;./Loading&quot;

describe(&quot;Components/Loading&quot;, () =&gt; {
  it(&quot;renders&quot;, () =&gt; {
    render(&lt;Loading /&gt;)
    expect(screen.getByText(/Loading…/)).toBeOnTheScreen()
  })
})

</code></pre>
<p>✏️ Create <strong>src/components/Loading/index.ts</strong> and update it to be:</p>
<pre><code class="language-ts">export { default } from &quot;./Loading&quot;

</code></pre>
<p>✏️ Update <strong>src/screens/StateList/StateList.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { FlatList } from &quot;react-native&quot;

import Loading from &quot;../../components/Loading&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useStates } from &quot;../../services/pmo/restaurant&quot;

const StateList: React.FC = () =&gt; {
  const navigation = useNavigation()
  // Exercise: Update `StateList.tsx` to call `useState()` and use the `StateResponse` interface.

  return (
    &lt;Screen noScroll&gt;
      {states?.length ? (
        &lt;FlatList
          data={states}
          renderItem={({ item: stateItem }) =&gt; (
            &lt;Button
              onPress={() =&gt; {
                navigation.navigate(&quot;CityList&quot;, {
                  state: stateItem,
                })
              }}
            &gt;
              {stateItem.name}
            &lt;/Button&gt;
          )}
          keyExtractor={(item) =&gt; item.short}
        /&gt;
      ) : (
        &lt;Typography&gt;No states found&lt;/Typography&gt;
      )}
    &lt;/Screen&gt;
  )
}

export default StateList

</code></pre>
 <div line-highlight="4-5,9,11,13,17-35,only"></div>
<h3>Verify 1</h3>
<p>✏️ Create <strong>src/services/pmo/restaurant/hooks.test.ts</strong> and update it to be:</p>
<pre><code class="language-ts">import { renderHook, waitFor } from &quot;@testing-library/react-native&quot;

import { useStates } from &quot;./hooks&quot;

const oldFetch = global.fetch
const mockFetch = jest.fn()
beforeAll(() =&gt; {
  global.fetch = mockFetch
})
afterAll(() =&gt; {
  global.fetch = oldFetch
})

describe(&quot;Services/PMO/Restaurant/useStates&quot;, () =&gt; {
  it(&quot;returns states&quot;, async () =&gt; {
    const mockStates = [
      { id: 1, name: &quot;State1&quot; },
      { id: 2, name: &quot;State2&quot; },
    ]
    mockFetch.mockResolvedValueOnce({
      ok: true,
      json: () =&gt; Promise.resolve({ message: &quot;success&quot;, data: mockStates }),
      statusText: &quot;OK&quot;,
      status: 200,
    })

    const { result } = renderHook(() =&gt; useStates())

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockStates)
    expect(result.current.error).toBeUndefined()
  })
})

</code></pre>
<div line-highlight='15, only'></div>
<p>✏️ Update <strong>src/screens/StateList/StateList.test.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { NavigationContainer } from &quot;@react-navigation/native&quot;
import { render, screen } from &quot;@testing-library/react-native&quot;

import * as restaurantHooks from &quot;../../services/pmo/restaurant/hooks&quot;

import StateList from &quot;./StateList&quot;

describe(&quot;Screens/StateList&quot;, () =&gt; {
  // Mock the hooks and components used in StateList
  const mockStateResponse = {
    data: [
      { short: &quot;MI&quot;, name: &quot;Michigan&quot; },
      { short: &quot;WI&quot;, name: &quot;Wisconsin&quot; },
      { short: &quot;IL&quot;, name: &quot;Illinois&quot; },
    ],
  }

  let useStates: jest.SpyInstance&lt;ReturnType&lt;typeof restaurantHooks.useStates&gt;&gt;
  beforeEach(() =&gt; {
    jest.resetAllMocks()
    useStates = jest.spyOn(restaurantHooks, &quot;useStates&quot;)
  })

  it(&quot;renders&quot;, () =&gt; {
    useStates.mockReturnValue({
      ...mockStateResponse,
      error: undefined,
      isPending: false,
    })

    render(
      &lt;NavigationContainer&gt;
        &lt;StateList /&gt;
      &lt;/NavigationContainer&gt;,
    )
    expect(screen.getByText(/Michigan/i)).toBeOnTheScreen()
    expect(screen.getByText(/Wisconsin/i)).toBeOnTheScreen()
    expect(screen.getByText(/Illinois/i)).toBeOnTheScreen()
  })

  it(&quot;renders loading state&quot;, () =&gt; {
    useStates.mockReturnValue({
      data: undefined,
      error: undefined,
      isPending: true,
    })

    render(
      &lt;NavigationContainer&gt;
        &lt;StateList /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(/Loading/i)).toBeOnTheScreen()
  })
})

</code></pre>
 <div line-highlight="4,9-16,18-21,25-29,33,36,39,41-46,48-52,54-55,only"></div>
<h3>Exercise 1</h3>
<ul>
<li>Update the <code>useState</code> in <code>hooks.ts</code> to call <code>useEffect()</code> and <code>fetch</code> data from <code>${process.env.PMO_API}/states</code>.</li>
<li>Update <code>StateList.tsx</code> to call <code>useState()</code> and use the <code>StateResponse</code> interface.</li>
</ul>
<p><strong>Hint:</strong> Call your state setter after you parse the JSON response from <code>fetch()</code>.</p>
<p><strong>Hint:</strong> <code>useState()</code> return <code>isPending</code> and <code>error</code>. Use these states to inform the user the status.</p>
<p><strong>Hint:</strong> Use <code>Array.isArray(data) ? data : data?.data ?? undefined</code> when you need to check for <code>data</code> being an Array or an Object response.</p>
<h3>Solution 1</h3>
<p>If you’ve implemented the solution correctly, the tests will pass when you run <code>npm run test</code>!</p>
<p><details>
<summary>Click to see the solution</summary></p>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { State } from &quot;./interfaces&quot;

const baseUrl = process.env.PMO_API

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const response = await fetch(`${baseUrl}/states`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
        },
      })

      const data = await response.json()

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: undefined,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

</code></pre>
 <div line-highlight="14-18,20-27,29,31-38,40,only"></div>
<p>✏️ Update <strong>src/screens/StateList/StateList.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { FlatList } from &quot;react-native&quot;

import Loading from &quot;../../components/Loading&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useStates } from &quot;../../services/pmo/restaurant&quot;

const StateList: React.FC = () =&gt; {
  const navigation = useNavigation()
  const { data: states, error, isPending } = useStates()

  if (error) {
    return (
      &lt;Screen&gt;
        &lt;Box padding=&quot;m&quot;&gt;
          &lt;Typography variant=&quot;heading&quot;&gt;Error loading states: &lt;/Typography&gt;
          &lt;Typography variant=&quot;body&quot;&gt;{error.message}&lt;/Typography&gt;
        &lt;/Box&gt;
      &lt;/Screen&gt;
    )
  }

  if (isPending) {
    return &lt;Loading /&gt;
  }

  return (
    &lt;Screen noScroll&gt;
      {states?.length ? (
        &lt;FlatList
          data={states}
          renderItem={({ item: stateItem }) =&gt; (
            &lt;Button
              onPress={() =&gt; {
                navigation.navigate(&quot;CityList&quot;, {
                  state: stateItem,
                })
              }}
            &gt;
              {stateItem.name}
            &lt;/Button&gt;
          )}
          keyExtractor={(item) =&gt; item.short}
        /&gt;
      ) : (
        &lt;Typography&gt;No states found&lt;/Typography&gt;
      )}
    &lt;/Screen&gt;
  )
}

export default StateList

</code></pre>
 <div line-highlight="13,15-24,26-28,only"></div>
<p></details></p>
<h2>Objective 2: Fetch cities in a custom Hook with query parameters</h2>
<p>Let’s continue our quest to load data from our API and update our <code>&lt;CitiesList&gt;</code> to use a custom <code>useCities</code> Hook to fetch data.</p>
<p>To do this, we’ll need to include query parameters in our API call to the <code>/cities</code> endpoint.</p>
<p><img alt="Screenshot of the application when it makes an API call to the cities endpoint and is populated the list of cities." src="../static/img/react-native/13-making-http-requests/2-solution.png" style="max-height: 640px; border: 4px solid black; border-radius: 25px;"/></p>
<h3>Including query parameters in API calls</h3>
<p>Query parameters are a defined set of parameters attached to the end of a URL. They are used to define and pass data in the form of key-value pairs. The parameters are separated from the URL itself by a <code>?</code> symbol, and individual key-value pairs are separated by the <code>&amp;</code> symbol.</p>
<p>A basic URL with query parameters looks like this:
<code>http://www.example.com/page?param1=value1&amp;param2=value2</code></p>
<p>Here’s a breakdown of this URL:</p>
<ul>
<li>Base URL: <code>http://www.example.com/page</code></li>
<li>Query Parameter Indicator: <code>?</code></li>
<li>Query Parameters:
<ul>
<li><code>param1=value1</code></li>
<li><code>param2=value2</code></li>
</ul></li>
</ul>
<h3>Setup 2</h3>
<p>✏️ Update <strong>src/services/pmo/restaurant/interfaces.ts</strong> to be:</p>
<pre><code class="language-ts">export interface State {
  name: string
  short: string
}

export interface City {
  name: string
  state: string
}

</code></pre>
 <div line-highlight="6-9,only"></div>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { City, State } from &quot;./interfaces&quot;

const baseUrl = process.env.PMO_API

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface CitiesResponse {
  data: City[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseCitiesParams {
  state?: string
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const response = await fetch(`${baseUrl}/states`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
        },
      })

      const data = await response.json()

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: undefined,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

export function useCities({ state }: UseCitiesParams): CitiesResponse {
  // Exercise: Update our `useCities()` Hook to fetch cities from the Place My Order API, given a selected state.
}

</code></pre>
 <div line-highlight="3,13-16,19-21,51,53-55,only"></div>
<p>✏️ Update <strong>src/screens/CityList/CityList.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { StackScreenProps } from &quot;@react-navigation/stack&quot;
import { FlatList } from &quot;react-native&quot;

import { RestaurantsStackParamList } from &quot;../../App&quot;
import Loading from &quot;../../components/Loading&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useCities } from &quot;../../services/pmo/restaurant&quot;

export interface CityListProps
  extends StackScreenProps&lt;RestaurantsStackParamList, &quot;CityList&quot;&gt; {}

const CityList: React.FC&lt;CityListProps&gt; = ({ route }) =&gt; {
  const { state } = route.params
  const navigation = useNavigation()
  // Exercise: When calling the Place My Order API, include the `state` query parameter.

  return (
    &lt;Screen noScroll&gt;
      &lt;FlatList
        data={cities}
        renderItem={({ item: cityItem }) =&gt; (
          &lt;Button
            onPress={() =&gt; {
              navigation.navigate(&quot;RestaurantList&quot;, {
                state,
                city: cityItem,
              })
            }}
          &gt;
            {cityItem.name}
          &lt;/Button&gt;
        )}
        keyExtractor={(item) =&gt; item.name}
      /&gt;
    &lt;/Screen&gt;
  )
}

export default CityList

</code></pre>
 <div line-highlight="6-7,10-11,19,only"></div>
<h3>Verify 2</h3>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.test.ts</strong> to be:</p>
<pre><code class="language-ts">import { renderHook, waitFor } from &quot;@testing-library/react-native&quot;

import { useStates, useCities } from &quot;./hooks&quot;

const oldFetch = global.fetch
const mockFetch = jest.fn()
beforeAll(() =&gt; {
  global.fetch = mockFetch
})
afterAll(() =&gt; {
  global.fetch = oldFetch
})

describe(&quot;Services/PMO/Restaurant/useStates&quot;, () =&gt; {
  it(&quot;returns states&quot;, async () =&gt; {
    const mockStates = [
      { id: 1, name: &quot;State1&quot; },
      { id: 2, name: &quot;State2&quot; },
    ]
    mockFetch.mockResolvedValueOnce({
      ok: true,
      json: () =&gt; Promise.resolve({ message: &quot;success&quot;, data: mockStates }),
      statusText: &quot;OK&quot;,
      status: 200,
    })

    const { result } = renderHook(() =&gt; useStates())

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockStates)
    expect(result.current.error).toBeUndefined()
  })
})

describe(&quot;Services/PMO/Restaurant/useCities&quot;, () =&gt; {
  it(&quot;returns cities&quot;, async () =&gt; {
    const mockCities = [
      { id: 1, name: &quot;City1&quot; },
      { id: 2, name: &quot;City2&quot; },
    ]
    mockFetch.mockResolvedValueOnce({
      ok: true,
      json: () =&gt; Promise.resolve({ message: &quot;success&quot;, data: mockCities }),
      statusText: &quot;OK&quot;,
      status: 200,
    })

    const { result } = renderHook(() =&gt; useCities({ state: &quot;test-state&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockCities)
    expect(result.current.error).toBeUndefined()
  })
})

</code></pre>
 <div line-highlight="3,37-48,50,52-58,only"></div>
<p>✏️ Update <strong>src/screens/CityList/CityList.test.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { NavigationContainer } from &quot;@react-navigation/native&quot;
import { render, screen } from &quot;@testing-library/react-native&quot;

import * as restaurantHooks from &quot;../../services/pmo/restaurant/hooks&quot;

import CityList from &quot;./CityList&quot;

const route = {
  key: &quot;RestaurantDetails&quot;,
  name: &quot;RestaurantDetails&quot;,
  params: {
    state: {
      name: &quot;name&quot;,
      short: &quot;short&quot;,
    },
  },
} as const

describe(&quot;Screens/CityList&quot;, () =&gt; {
  // Mock the hooks and components used in CityList

  const mockCitiesResponse = {
    data: [
      { name: &quot;Detroit&quot;, state: &quot;MI&quot; },
      { name: &quot;Ann Arbor&quot;, state: &quot;MI&quot; },
    ],
  }
  let useCities: jest.SpyInstance&lt;ReturnType&lt;typeof restaurantHooks.useCities&gt;&gt;
  beforeEach(() =&gt; {
    jest.resetAllMocks()
    useCities = jest.spyOn(restaurantHooks, &quot;useCities&quot;)
  })

  it(&quot;renders&quot;, () =&gt; {
    useCities.mockReturnValue({
      ...mockCitiesResponse,
      error: undefined,
      isPending: false,
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;CityList route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )
    expect(screen.getByText(/Detroit/i)).toBeOnTheScreen()
    expect(screen.getByText(/Ann Arbor/i)).toBeOnTheScreen()
  })

  it(&quot;renders loading state&quot;, () =&gt; {
    useCities.mockReturnValue({
      data: undefined,
      error: undefined,
      isPending: true,
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;CityList route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(/Loading/i)).toBeOnTheScreen()
  })
})

</code></pre>
 <div line-highlight="4,9-10,20,22-31,35-39,47-49,51-56,58-63,65-66,only"></div>
<h3>Exercise 2</h3>
<ul>
<li>Update our <code>useCities()</code> Hook to fetch cities from the Place My Order API, given a selected state.</li>
<li>When calling the Place My Order API, include the <code>state</code> query parameter:
<code>http://localhost:7070/cities?state=MO</code></li>
</ul>
<p><strong>Hint:</strong> Remember to include the <code>state</code> in the dependency array of the <code>useEffect()</code> in <code>useCities()</code>.</p>
<h3>Solution 2</h3>
<p>If you’ve implemented the solution correctly, the tests will pass when you run <code>npm run test</code>!</p>
<p><details>
<summary>Click to see the solution</summary></p>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { City, State } from &quot;./interfaces&quot;

const baseUrl = process.env.PMO_API

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface CitiesResponse {
  data: City[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseCitiesParams {
  state?: string
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const response = await fetch(`${baseUrl}/states`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
        },
      })

      const data = await response.json()

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: undefined,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

export function useCities({ state }: UseCitiesParams): CitiesResponse {
  const [response, setResponse] = useState&lt;CitiesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      if (state) {
        const response = await fetch(`${baseUrl}/cities?state=${state}`, {
          method: &quot;GET&quot;,
          headers: {
            &quot;Content-Type&quot;: &quot;application/json&quot;,
          },
        })

        const data = await response.json()

        setResponse({
          data: Array.isArray(data) ? data : data?.data ?? undefined,
          error: undefined,
          isPending: false,
        })
      }
    }
    fetchData()
  }, [state])

  return response
}

</code></pre>
 <div line-highlight="54-58,60-68,70,72-80,82,only"></div>
<p>✏️ Update <strong>src/screens/CityList/CityList.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { StackScreenProps } from &quot;@react-navigation/stack&quot;
import { FlatList } from &quot;react-native&quot;

import { RestaurantsStackParamList } from &quot;../../App&quot;
import Loading from &quot;../../components/Loading&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useCities } from &quot;../../services/pmo/restaurant&quot;

export interface CityListProps
  extends StackScreenProps&lt;RestaurantsStackParamList, &quot;CityList&quot;&gt; {}

const CityList: React.FC&lt;CityListProps&gt; = ({ route }) =&gt; {
  const { state } = route.params
  const navigation = useNavigation()
  const {
    data: cities,
    error,
    isPending,
  } = useCities({ state: state.short || &quot;&quot; })

  if (error) {
    return (
      &lt;Screen&gt;
        &lt;Box padding=&quot;m&quot;&gt;
          &lt;Typography variant=&quot;heading&quot;&gt;Error loading cities: &lt;/Typography&gt;
          &lt;Typography variant=&quot;body&quot;&gt;{error.message}&lt;/Typography&gt;
        &lt;/Box&gt;
      &lt;/Screen&gt;
    )
  }

  if (isPending) {
    return &lt;Loading /&gt;
  }

  return (
    &lt;Screen noScroll&gt;
      &lt;FlatList
        data={cities}
        renderItem={({ item: cityItem }) =&gt; (
          &lt;Button
            onPress={() =&gt; {
              navigation.navigate(&quot;RestaurantList&quot;, {
                state,
                city: cityItem,
              })
            }}
          &gt;
            {cityItem.name}
          &lt;/Button&gt;
        )}
        keyExtractor={(item) =&gt; item.name}
      /&gt;
    &lt;/Screen&gt;
  )
}

export default CityList

</code></pre>
 <div line-highlight="6-7,10-11,19-23,25-34,36-38,only"></div>
<p></details></p>
<h2>Objective 3: Create API request helper</h2>
<p>Now that we have two Hooks that fetch data in a similar way, let’s create an <code>apiRequest</code> helper function that both Hooks can use.</p>
<p>While we do this, let‘s add error handling for unsuccessful API requests:</p>
<div style="display: flex; flex-direction: row; gap: 2rem; flex-wrap: wrap;">
  <img alt="Screenshot of the application when it makes an API call to the cities endpoint and is populated the list of cities." src="../static/img/react-native/13-making-http-requests/2-solution.png" style="max-height: 640px; border: 4px solid black; border-radius: 25px;"/>
  <img alt="Screenshot of the application when it makes an API call and the API returns an error." src="../static/img/react-native/13-making-http-requests/3-solution.png" style="max-height: 640px; border: 4px solid black; border-radius: 25px;"/>
</div>
<h3>Handle HTTP error statuses</h3>
<p>When you make a request with the Fetch API, it does not reject HTTP error statuses (like <code>404</code> or <code>500</code>). Instead, it resolves normally (with an <code>ok</code> status set to <code>false</code>), and it only rejects on network failure or if anything prevented the request from completing.</p>
<p>Here’s the API that <code>fetch</code> provides to handle these HTTP errors:</p>
<ul>
<li><code>.ok</code>: This is a shorthand property that returns <code>true</code> if the response’s status code is in the range <code>200</code>-<code>299</code>, indicating a successful request.</li>
<li><code>.status</code>: This property returns the status code of the response (e.g. <code>200</code> for success, <code>404</code> for <code>Not Found</code>, etc.).</li>
<li><code>.statusText</code>: This provides the status message corresponding to the status code (e.g. <code>'OK'</code>, <code>'Not Found'</code>, etc.).</li>
</ul>
<pre><code class="language-js">const response = await fetch(&quot;https://api.example.com/data&quot;, {
  method: &quot;GET&quot;,
})

const data = await response.json()
const error = response.ok
  ? null
  : new Error(`${response.status} (${response.statusText})`)

</code></pre>
<p>In the example above, we check the <code>response.ok</code> property to see if the status code is in the <code>200</code>-<code>299</code> (successful) range. If not, we create an <code>error</code> object that contains the status code and text (e.g. <code>404 Not Found</code>).</p>
<h3>Catch network errors</h3>
<p>Network errors occur when there is a problem in completing the request, like when the user is offline, the server is unreachable, or there is a DNS lookup failure.</p>
<p>In these cases, the <code>fetch</code> API will <em>not</em> resolve with data, but instead it will throw an error that needs to be caught.</p>
<p>Let’s take a look at how to handle these types of errors:</p>
<pre><code class="language-js">try {
  const response = await fetch(&quot;https://api.example.com/data&quot;, {
    method: &quot;GET&quot;,
  })

  const data = await response.json()
  const error = response.ok
    ? null
    : new Error(`${response.status} (${response.statusText})`)
  // Do something with data and error
} catch (error) {
  const parsedError =
    error instanceof Error ? error : new Error(&quot;An unknown error occurred&quot;)
  // Do something with parsedError
}

</code></pre>
<p>In the example above, we <code>catch</code> the <code>error</code> and check its type. If it’s already an <code>instanceof Error</code>, then it will have a <code>message</code> property and we can use it as-is. If it’s not, then we can create our own <code>new Error()</code> so we <em>always</em> have an error to consume in our Hooks or components.</p>
<h3>Setup 3</h3>
<p>✏️ Create <strong>src/services/pmo/api/api.ts</strong> and update it to be:</p>
<pre><code class="language-ts">const baseUrl = process.env.PMO_API

export async function apiRequest&lt;
  Data = never,
  Params = unknown,
  Body = unknown,
&gt;({
  method,
  params,
  path,
  body,
}: {
  method: string
  params?: Params
  path: string
  body?: Body
}): Promise&lt;{ data: Data | undefined; error: Error | undefined }&gt; {}

export function stringifyQuery(
  input: Record&lt;string, string | undefined | undefined&gt;,
): string {
  const output: string[] = []

  for (const [key, value] of Object.entries(input)) {
    if (typeof value !== &quot;undefined&quot; &amp;&amp; value !== null) {
      output.push(`${key}=${value}`)
    }
  }

  // Exercise: Implement the `apiRequest` helper function to handle errors returned and thrown from `fetch()`.

  return output.join(&quot;&amp;&quot;)
}

</code></pre>
<div line-highlight='30, only'></div>
<p>✏️ Create <strong>src/services/pmo/api/index.ts</strong> and update it to be:</p>
<pre><code class="language-ts">export * from &quot;./api&quot;

</code></pre>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { apiRequest } from &quot;../api&quot;

import { City, State } from &quot;./interfaces&quot;

const baseUrl = process.env.PMO_API

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface CitiesResponse {
  data: City[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseCitiesParams {
  state?: string
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const response = await fetch(`${baseUrl}/states`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
        },
      })

      const data = await response.json()

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: undefined,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

export function useCities({ state }: UseCitiesParams): CitiesResponse {
  const [response, setResponse] = useState&lt;CitiesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      if (state) {
        const response = await fetch(`${baseUrl}/cities?state=${state}`, {
          method: &quot;GET&quot;,
          headers: {
            &quot;Content-Type&quot;: &quot;application/json&quot;,
          },
        })

        const data = await response.json()

        setResponse({
          data: Array.isArray(data) ? data : data?.data ?? undefined,
          error: undefined,
          isPending: false,
        })
      }
    }
    fetchData()
  }, [state])

  return response
}

</code></pre>
 <div line-highlight="3,only"></div>
<h3>Verify 3</h3>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.test.ts</strong> to be:</p>
<pre><code class="language-ts">import { renderHook, waitFor } from &quot;@testing-library/react-native&quot;

import * as api from &quot;../api/api&quot;

import { useStates, useCities } from &quot;./hooks&quot;

let apiRequest: jest.SpyInstance&lt;ReturnType&lt;typeof api.apiRequest&gt;&gt;
beforeEach(() =&gt; {
  jest.resetAllMocks()
  apiRequest = jest.spyOn(api, &quot;apiRequest&quot;)
})

describe(&quot;Services/PMO/Restaurant/useStates&quot;, () =&gt; {
  it(&quot;returns states&quot;, async () =&gt; {
    const mockStates = [
      { id: 1, name: &quot;State1&quot; },
      { id: 2, name: &quot;State2&quot; },
    ]
    apiRequest.mockResolvedValue({
      data: { data: mockStates },
      error: undefined,
    })

    const { result } = renderHook(() =&gt; useStates())

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockStates)
    expect(result.current.error).toBeUndefined()
  })

  it(&quot;handles errors&quot;, async () =&gt; {
    const mockError = new Error(&quot;Error fetching states&quot;)
    apiRequest.mockResolvedValue({ data: undefined, error: mockError })

    const { result } = renderHook(() =&gt; useStates())

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toBeUndefined()
    expect(result.current.error).toEqual(mockError)
  })
})

describe(&quot;Services/PMO/Restaurant/useCities&quot;, () =&gt; {
  it(&quot;returns cities&quot;, async () =&gt; {
    const mockCities = [
      { id: 1, name: &quot;City1&quot; },
      { id: 2, name: &quot;City2&quot; },
    ]
    apiRequest.mockResolvedValue({
      data: { data: mockCities },
      error: undefined,
    })

    const { result } = renderHook(() =&gt; useCities({ state: &quot;test-state&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockCities)
    expect(result.current.error).toBeUndefined()
  })

  it(&quot;handles errors&quot;, async () =&gt; {
    const mockError = new Error(&quot;Error fetching cities&quot;)
    apiRequest.mockResolvedValue({ data: undefined, error: mockError })

    const { result } = renderHook(() =&gt; useCities({ state: &quot;test-state&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toBeUndefined()
    expect(result.current.error).toEqual(mockError)
  })
})

</code></pre>
 <div line-highlight="3,7-10,19-21,33-35,37,42-43,53-55,60-62,65,67-69,71,73-78,only"></div>
<h3>Exercise 3</h3>
<ul>
<li>Implement the <code>apiRequest</code> helper function to handle errors returned and thrown from <code>fetch()</code>.</li>
<li>Update the <code>useCities</code> and <code>useStates</code> Hooks to use the <code>data</code> and <code>error</code> returned from <code>apiRequest</code>.</li>
</ul>
<p><strong>Hint:</strong> Use the new <code>stringifyQuery</code> function to convert an object of query parameters to a string:</p>
<pre><code class="language-tsx">stringifyQuery({
  param1: &quot;value1&quot;,
  param2: &quot;value2&quot;,
})
</code></pre>
<h3>Solution 3</h3>
<p>If you’ve implemented the solution correctly, the tests will pass when you run <code>npm run test</code>!</p>
<p><details>
<summary>Click to see the solution</summary></p>
<p>✏️ Update <strong>src/services/pmo/api/api.ts</strong> to be:</p>
<pre><code class="language-ts">const baseUrl = process.env.PMO_API

export async function apiRequest&lt;
  Data = never,
  Params = unknown,
  Body = unknown,
&gt;({
  method,
  params,
  path,
  body,
}: {
  method: string
  params?: Params
  path: string
  body?: Body
}): Promise&lt;{ data: Data | undefined; error: Error | undefined }&gt; {
  try {
    const query = params ? stringifyQuery(params) : &quot;&quot;
    const requestUrl = `${baseUrl}${path}?${query}`

    const response = await fetch(requestUrl, {
      method,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
      body: body ? JSON.stringify(body) : undefined,
    })

    const data = await response.json()

    if (!response.ok) {
      const error = new Error(`${response.status} (${response.statusText})`)
      return { data: data, error: error }
    }

    return {
      data: data,
      error: undefined,
    }
  } catch (error) {
    return {
      data: undefined,
      error:
        error instanceof Error ? error : new Error(&quot;An unknown error occurred&quot;),
    }
  }
}

export function stringifyQuery(
  input: Record&lt;string, string | undefined | undefined&gt;,
): string {
  const output: string[] = []

  for (const [key, value] of Object.entries(input)) {
    if (typeof value !== &quot;undefined&quot; &amp;&amp; value !== null) {
      output.push(`${key}=${value}`)
    }
  }

  return output.join(&quot;&amp;&quot;)
}

</code></pre>
 <div line-highlight="17-20,22-28,30,32-34,37-46,58-59,62,only"></div>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { apiRequest } from &quot;../api&quot;

import { City, State } from &quot;./interfaces&quot;

interface CitiesResponse {
  data: City[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseCitiesParams {
  state?: string
}

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

export function useCities({ state }: UseCitiesParams): CitiesResponse {
  const [response, setResponse] = useState&lt;CitiesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const { data, error } = await apiRequest&lt;CitiesResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/cities&quot;,
        params: {
          state: state,
        },
      })

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [state])

  return response
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      setResponse({
        data: undefined,
        error: undefined,
        isPending: true,
      })

      const { data, error } = await apiRequest&lt;StatesResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/states&quot;,
      })

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

</code></pre>
 <div line-highlight="32,34-36,42,61-62,64-65,67-70,72-76,only"></div>
<p></details></p>
<h2>Objective 4: Fetch restaurants in a custom Hook</h2>
<p>Let’s finish our quest to load data from our API by creating a Hook to fetch the list of restaurants and use it in our component.</p>
<p>Now that we are able to capture a user’s state and city preferences, we want to only show the restaurants in the selected city:</p>
<div style="display: flex; flex-direction: row; gap: 2rem; flex-wrap: wrap;">
  <img alt="Screenshot of the application when it makes an API call to the restaurants endpoint and is populated the list of restaurants." src="../static/img/react-native/13-making-http-requests/4-1-solution.png" style="max-height: 640px; border: 4px solid black; border-radius: 25px;"/>
  <img alt="Screenshot of the application when it makes an API call to the restaurant endpoint and is populated populated with the restaurants details." src="../static/img/react-native/13-making-http-requests/4-2-solution.png" style="max-height: 640px; border: 4px solid black; border-radius: 25px;"/>
</div>
<h3>Setup 4</h3>
<p>✏️ Update <strong>.env</strong> to be:</p>
<pre><code>PMO_API=http://localhost:7070
PMO_ASSETS=https://www.place-my-order.com/

</code></pre>
 <div line-highlight="2,only"></div>
<p>✏️ Update <strong>.env.example</strong> to be:</p>
<pre><code class="language-example">PMO_API=http://localhost:7070
PMO_ASSETS=https://www.place-my-order.com/

</code></pre>
 <div line-highlight="2,only"></div>
<p>✏️ Update <strong>src/env.d.ts</strong> to be:</p>
<pre><code class="language-ts">/* eslint-disable @typescript-eslint/no-namespace */

declare global {
  namespace NodeJS {
    interface ProcessEnv {
      readonly PMO_API: string
      readonly PMO_ASSETS: string
    }
  }
}

export {}

</code></pre>
 <div line-highlight="7,only"></div>
<p>✏️ Terminate the existing dev server and start it again:</p>
<pre><code class="language-bash">npm run start
</code></pre>
<p>✏️ Update <strong>src/components/RestaurantHeader/RestaurantHeader.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { ImageBackground, StyleSheet } from &quot;react-native&quot;

import Box from &quot;../../design/Box&quot;
import { Theme, useTheme } from &quot;../../design/theme&quot;
import Typography from &quot;../../design/Typography&quot;

const assetsUrl = process.env.PMO_ASSETS

export interface RestaurantHeaderProps {
  restaurant?: {
    _id: string
    address?: {
      city: string
      state: string
      street: string
      zip: string
    }
    images: {
      banner: string
    }
    name: string
    slug: string
  }
}

const RestaurantHeader: React.FC&lt;RestaurantHeaderProps&gt; = ({ restaurant }) =&gt; {
  const theme = useTheme()
  const styles = getStyles(theme)

  return (
    &lt;Box&gt;
      &lt;ImageBackground
        style={styles.heroBackground}
        source={{ uri: `${assetsUrl}/${restaurant?.images.banner}` }}
      &gt;
        &lt;Box padding={[&quot;xs&quot;, &quot;m&quot;]} margin={[&quot;s&quot;, &quot;none&quot;]} style={styles.hero}&gt;
          &lt;Typography variant=&quot;heading&quot; style={styles.heroText}&gt;
            {restaurant?.name}
          &lt;/Typography&gt;
        &lt;/Box&gt;
      &lt;/ImageBackground&gt;

      &lt;Box padding=&quot;m&quot;&gt;
        {restaurant?.address &amp;&amp; (
          &lt;Typography variant=&quot;body&quot;&gt;
            {restaurant.address.street}
            {restaurant.address.city}, {restaurant.address.state}{&quot; &quot;}
            {restaurant.address.zip}
          &lt;/Typography&gt;
        )}

        &lt;Typography variant=&quot;body&quot;&gt;
          $$$ Hours: M-F 10am-11pm Open Now
        &lt;/Typography&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  )
}

function getStyles(theme: Theme) {
  return StyleSheet.create({
    heroBackground: {
      width: &quot;100%&quot;,
      maxWidth: 768,
      height: 180,
      margin: &quot;auto&quot;,
      justifyContent: &quot;flex-end&quot;,
      alignItems: &quot;flex-start&quot;,
    },
    hero: {
      backgroundColor: theme.palette.secondary.main + &quot;bb&quot;,
    },
    heroText: {
      color: theme.palette.secondary.contrast,
      fontSize: 32,
    },
  })
}

export default RestaurantHeader

</code></pre>
 <div line-highlight="7,34,only"></div>
<p>✏️ Update <strong>src/services/pmo/restaurant/interfaces.ts</strong> to be:</p>
<pre><code class="language-ts">export interface State {
  name: string
  short: string
}

export interface City {
  name: string
  state: string
}

export interface Restaurant {
  _id: string
  address?: Address
  coordinate: Coordinate
  images: Images
  menu: Menu
  name: string
  slug: string
}

interface Address {
  city: string
  state: string
  street: string
  zip: string
}

interface Coordinate {
  latitude: number
  longitude: number
}

interface Images {
  banner: string
  owner: string
  thumbnail: string
}

interface Menu {
  dinner: MenuItem[]
  lunch: MenuItem[]
}

interface MenuItem {
  name: string
  price: number
}

</code></pre>
 <div line-highlight="11-19,21-26,28-31,33-37,39-42,44-47,only"></div>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { apiRequest } from &quot;../api/api&quot;

import { City, Restaurant, State } from &quot;./interfaces&quot;

interface CitiesResponse {
  data: City[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseCitiesParams {
  state?: string
}
interface RestaurantResponse {
  data: Restaurant | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseRestaurant {
  slug: string
}

interface RestaurantsResponse {
  data: Restaurant[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseRestaurants {
  state: string
  city: string
}

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

export function useCities({ state }: UseCitiesParams): CitiesResponse {
  const [response, setResponse] = useState&lt;CitiesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const { data, error } = await apiRequest&lt;CitiesResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/cities&quot;,
        params: {
          state: state,
        },
      })

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [state])

  return response
}

export function useRestaurant({ slug }: UseRestaurant): RestaurantResponse {
  // Exercise: Fill in `useRestaurant` Hook for fetching the details of the restaurant.
}

export function useRestaurants({
  state,
  city,
}: UseRestaurants): RestaurantsResponse {
  // Exercise: Fill in `useRestaurants` Hook for fetching the list of restaurants.
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      setResponse({
        data: undefined,
        error: undefined,
        isPending: true,
      })

      const { data, error } = await apiRequest&lt;StatesResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/states&quot;,
      })

      setResponse({
        data: Array.isArray(data)
          ? undefined
          : (data?.data as Restaurant | undefined),
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

</code></pre>
 <div line-highlight="3,5,16-17,22-23,26-29,32-35,39-41,70,72-74,76-81,104-106,115,only"></div>
<p>✏️ Update <strong>src/screens/RestaurantList/RestaurantList.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { StackScreenProps } from &quot;@react-navigation/stack&quot;
import { FlatList } from &quot;react-native&quot;

import { RestaurantsStackParamList } from &quot;../../App&quot;
import Loading from &quot;../../components/Loading&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useRestaurants } from &quot;../../services/pmo/restaurant&quot;

export interface RestaurantListProps
  extends StackScreenProps&lt;RestaurantsStackParamList, &quot;RestaurantList&quot;&gt; {}

const RestaurantList: React.FC&lt;RestaurantListProps&gt; = ({ route }) =&gt; {
  const navigation = useNavigation()
  // Exercise: Update `RestaurantList.tsx` to use our new `useRestaurants` Hook.

  return (
    &lt;Screen noScroll&gt;
      &lt;FlatList
        data={restaurants}
        renderItem={({ item: restaurant }) =&gt; (
          &lt;Button
            onPress={() =&gt; {
              navigation.navigate(&quot;RestaurantDetails&quot;, {
                slug: restaurant.slug,
              })
            }}
          &gt;
            {restaurant.name}
          &lt;/Button&gt;
        )}
        keyExtractor={(item) =&gt; item._id}
      /&gt;
    &lt;/Screen&gt;
  )
}

export default RestaurantList

</code></pre>
 <div line-highlight="6-7,10-11,18,only"></div>
<p>✏️ Update <strong>src/screens/RestaurantDetails/RestaurantDetails.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { StackScreenProps } from &quot;@react-navigation/stack&quot;
import { useEffect } from &quot;react&quot;

import { RestaurantsStackParamList } from &quot;../../App&quot;
import Loading from &quot;../../components/Loading&quot;
import RestaurantHeader from &quot;../../components/RestaurantHeader&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useRestaurant } from &quot;../../services/pmo/restaurant&quot;

export interface RestaurantDetailsProps
  extends StackScreenProps&lt;RestaurantsStackParamList, &quot;RestaurantDetails&quot;&gt; {}

const RestaurantDetails: React.FC&lt;RestaurantDetailsProps&gt; = ({ route }) =&gt; {
  const navigation = useNavigation()
  // Exercise: Update `RestaurantDetails.tsx` to use our new `useRestaurants` Hook.

  return (
    &lt;Screen&gt;
      &lt;RestaurantHeader restaurant={restaurant} /&gt;
      &lt;Button onPress={() =&gt; console.warn(&quot;Place an order&quot;)}&gt;
        Place an order
      &lt;/Button&gt;
    &lt;/Screen&gt;
  )
}

export default RestaurantDetails

</code></pre>
 <div line-highlight="2,5-6,8,11-12,14-15,17,19,only"></div>
<h3>Verify 4</h3>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.test.ts</strong> to be:</p>
<pre><code class="language-ts">import { renderHook, waitFor } from &quot;@testing-library/react-native&quot;

import * as api from &quot;../api/api&quot;

import { useStates, useCities, useRestaurants, useRestaurant } from &quot;./hooks&quot;

// Mock the apiRequest function
let apiRequest: jest.SpyInstance&lt;ReturnType&lt;typeof api.apiRequest&gt;&gt;
beforeEach(() =&gt; {
  jest.resetAllMocks()
  apiRequest = jest.spyOn(api, &quot;apiRequest&quot;)
})

describe(&quot;Services/PMO/Restaurant/useStates&quot;, () =&gt; {
  it(&quot;returns states&quot;, async () =&gt; {
    const mockStates = [
      { id: 1, name: &quot;State1&quot; },
      { id: 2, name: &quot;State2&quot; },
    ]
    apiRequest.mockResolvedValue({
      data: { data: mockStates },
      error: undefined,
    })

    const { result } = renderHook(() =&gt; useStates())

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockStates)
    expect(result.current.error).toBeUndefined()
  })

  it(&quot;handles errors&quot;, async () =&gt; {
    const mockError = new Error(&quot;Error fetching states&quot;)
    apiRequest.mockResolvedValue({ data: undefined, error: mockError })

    const { result } = renderHook(() =&gt; useStates())

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toBeUndefined()
    expect(result.current.error).toEqual(mockError)
  })
})

describe(&quot;Services/PMO/Restaurant/useCities&quot;, () =&gt; {
  it(&quot;returns cities&quot;, async () =&gt; {
    const mockCities = [
      { id: 1, name: &quot;City1&quot; },
      { id: 2, name: &quot;City2&quot; },
    ]
    apiRequest.mockResolvedValue({
      data: { data: mockCities },
      error: undefined,
    })

    const { result } = renderHook(() =&gt; useCities({ state: &quot;test-state&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockCities)
    expect(result.current.error).toBeUndefined()
  })

  it(&quot;handles errors&quot;, async () =&gt; {
    const mockError = new Error(&quot;Error fetching cities&quot;)
    apiRequest.mockResolvedValue({ data: undefined, error: mockError })

    const { result } = renderHook(() =&gt; useCities({ state: &quot;test-state&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toBeUndefined()
    expect(result.current.error).toEqual(mockError)
  })
})

describe(&quot;Services/PMO/Restaurant/useRestaurants&quot;, () =&gt; {
  it(&quot;returns restaurants&quot;, async () =&gt; {
    const mockRestaurants = [
      { id: 1, name: &quot;Restaurant1&quot; },
      { id: 2, name: &quot;Restaurant2&quot; },
    ]
    apiRequest.mockResolvedValue({
      data: { data: mockRestaurants },
      error: undefined,
    })

    const { result } = renderHook(() =&gt;
      useRestaurants({ state: &quot;test-state&quot;, city: &quot;test-city&quot; }),
    )

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockRestaurants)
    expect(result.current.error).toBeUndefined()
  })

  it(&quot;handles errors&quot;, async () =&gt; {
    const mockError = new Error(&quot;Error fetching restaurants&quot;)
    apiRequest.mockResolvedValue({ data: undefined, error: mockError })

    const { result } = renderHook(() =&gt;
      useRestaurants({ state: &quot;test-state&quot;, city: &quot;test-city&quot; }),
    )

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toBeUndefined()
    expect(result.current.error).toEqual(mockError)
  })
})

describe(&quot;Services/PMO/Restaurant/useRestaurant&quot;, () =&gt; {
  it(&quot;returns a restaurant&quot;, async () =&gt; {
    const mockRestaurant = { id: 1, name: &quot;Restaurant1&quot; }
    apiRequest.mockResolvedValue({
      data: { data: mockRestaurant },
      error: undefined,
    })

    const { result } = renderHook(() =&gt; useRestaurant({ slug: &quot;test-slug&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })
    expect(result.current.data).toEqual(mockRestaurant)
    expect(result.current.error).toBeUndefined()
  })

  it(&quot;handles errors&quot;, async () =&gt; {
    const mockError = new Error(&quot;Error fetching restaurant&quot;)
    apiRequest.mockResolvedValue({ data: undefined, error: mockError })

    const { result } = renderHook(() =&gt; useRestaurant({ slug: &quot;test-slug&quot; }))

    await waitFor(() =&gt; {
      expect(result.current.isPending).toBeFalsy()
    })

    expect(result.current.data).toBeUndefined()
    expect(result.current.error).toEqual(mockError)
  })
})

</code></pre>
 <div line-highlight="5,7,82-91,93-95,97-102,104-106,108-110,112-118,120-126,128,130-135,137-139,141,143-145,147-150,only"></div>
<p>✏️ Update <strong>src/screens/RestaurantList/RestaurantList.test.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { NavigationContainer } from &quot;@react-navigation/native&quot;
import { render, screen } from &quot;@testing-library/react-native&quot;

import * as restaurantHooks from &quot;../../services/pmo/restaurant/hooks&quot;

import RestaurantList from &quot;./RestaurantList&quot;

const route = {
  key: &quot;RestaurantList&quot;,
  name: &quot;RestaurantList&quot;,
  params: {
    state: {
      name: &quot;name&quot;,
      short: &quot;short&quot;,
    },
    city: {
      name: &quot;name&quot;,
      state: &quot;state&quot;,
    },
    slug: &quot;test&quot;,
  },
} as const

describe(&quot;Screens/RestaurantList&quot;, () =&gt; {
  // Mock the hooks and components used in RestaurantList

  const mockRestaurantsResponse = {
    data: [
      {
        name: &quot;Bagel Restaurant&quot;,
        slug: &quot;bagel-restaurant&quot;,
        images: {
          thumbnail:
            &quot;node_modules/place-my-order-assets/images/3-thumbnail.jpg&quot;,
          owner: &quot;node_modules/place-my-order-assets/images/1-owner.jpg&quot;,
          banner: &quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;,
        },
        menu: {
          lunch: [
            { name: &quot;Crab Pancakes with Sorrel Syrup&quot;, price: 35.99 },
            { name: &quot;Steamed Mussels&quot;, price: 21.99 },
            { name: &quot;Roasted Salmon&quot;, price: 23.99 },
          ],
          dinner: [
            { name: &quot;Truffle Noodles&quot;, price: 14.99 },
            { name: &quot;Spinach Fennel Watercress Ravioli&quot;, price: 35.99 },
            { name: &quot;Herring in Lavender Dill Reduction&quot;, price: 45.99 },
          ],
        },
        address: {
          street: &quot;285 W Adams Ave&quot;,
          city: &quot;Detroit&quot;,
          state: &quot;MI&quot;,
          zip: &quot;60045&quot;,
        },
        coordinate: {
          latitude: 0,
          longitude: 0,
        },
        resources: {
          thumbnail: &quot;api/resources/images/3-thumbnail.jpg&quot;,
          owner: &quot;api/resources/images/4-owner.jpg&quot;,
          banner: &quot;api/resources/images/1-banner.jpg&quot;,
        },
        _id: &quot;5NVE3Z5MXxX3O57R&quot;,
      },
      {
        name: &quot;Brunch Barn&quot;,
        slug: &quot;brunch-barn&quot;,
        images: {
          thumbnail:
            &quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
          owner: &quot;node_modules/place-my-order-assets/images/1-owner.jpg&quot;,
          banner: &quot;node_modules/place-my-order-assets/images/4-banner.jpg&quot;,
        },
        menu: {
          lunch: [
            { name: &quot;Gunthorp Chicken&quot;, price: 21.99 },
            { name: &quot;Ricotta Gnocchi&quot;, price: 15.99 },
            { name: &quot;Roasted Salmon&quot;, price: 23.99 },
          ],
          dinner: [
            { name: &quot;Charred Octopus&quot;, price: 25.99 },
            { name: &quot;Herring in Lavender Dill Reduction&quot;, price: 45.99 },
            { name: &quot;Steamed Mussels&quot;, price: 21.99 },
          ],
        },
        address: {
          street: &quot;285 W Adams Ave&quot;,
          city: &quot;Detroit&quot;,
          state: &quot;MI&quot;,
          zip: &quot;60045&quot;,
        },
        coordinate: {
          latitude: 0,
          longitude: 0,
        },
        resources: {
          thumbnail: &quot;api/resources/images/3-thumbnail.jpg&quot;,
          owner: &quot;api/resources/images/2-owner.jpg&quot;,
          banner: &quot;api/resources/images/4-banner.jpg&quot;,
        },
        _id: &quot;AXUIBQBmxrk2EWq8&quot;,
      },
    ],
  }

  let useRestaurants: jest.SpyInstance&lt;
    ReturnType&lt;typeof restaurantHooks.useRestaurants&gt;
  &gt;
  beforeEach(() =&gt; {
    jest.resetAllMocks()
    useRestaurants = jest.spyOn(restaurantHooks, &quot;useRestaurants&quot;)
  })

  it(&quot;renders&quot;, () =&gt; {
    useRestaurants.mockReturnValue({
      ...mockRestaurantsResponse,
      error: undefined,
      isPending: false,
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantList route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )
    expect(screen.getByText(/Bagel Restaurant/i)).toBeOnTheScreen()
    expect(screen.getByText(/Brunch Barn/i)).toBeOnTheScreen()
  })

  it(&quot;renders loading state&quot;, () =&gt; {
    useRestaurants.mockReturnValue({
      data: undefined,
      error: undefined,
      isPending: true,
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantList route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(/Loading/i)).toBeOnTheScreen()
  })

  it(&quot;renders error state&quot;, () =&gt; {
    useRestaurants.mockReturnValue({
      data: undefined,
      error: { name: &quot;Oops&quot;, message: &quot;This is the error&quot; },
      isPending: false,
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantList route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(/Error loading restaurants:/)).toBeOnTheScreen()
    expect(screen.getByText(/This is the error/)).toBeOnTheScreen()
  })
})

</code></pre>
 <div line-highlight="4,25,27-106,108-113,117-121,129-131,133-138,140-145,147-148,150-155,157-162,164-166,only"></div>
<p>✏️ Update <strong>src/screens/RestaurantDetails/RestaurantDetails.test.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { NavigationContainer } from &quot;@react-navigation/native&quot;
import { render, screen } from &quot;@testing-library/react-native&quot;

import * as restaurantHooks from &quot;../../services/pmo/restaurant/hooks&quot;

import RestaurantDetails from &quot;./RestaurantDetails&quot;

const route = {
  key: &quot;RestaurantDetails&quot;,
  name: &quot;RestaurantDetails&quot;,
  params: {
    state: {
      name: &quot;name&quot;,
      short: &quot;short&quot;,
    },
    city: {
      name: &quot;name&quot;,
      state: &quot;state&quot;,
    },
    slug: &quot;test&quot;,
  },
} as const

jest.mock(&quot;@react-navigation/native&quot;, () =&gt; {
  const actualNav = jest.requireActual(&quot;@react-navigation/native&quot;)
  return {
    ...actualNav,
    useNavigation: () =&gt; ({
      navigate: jest.fn(),
      setOptions: jest.fn(),
    }),
  }
})

describe(&quot;Screens/RestaurantDetails&quot;, () =&gt; {
  // Mock the hooks and components used in RestaurantDetails

  let useRestaurant: jest.SpyInstance&lt;
    ReturnType&lt;typeof restaurantHooks.useRestaurant&gt;
  &gt;
  beforeEach(() =&gt; {
    jest.resetAllMocks()
    useRestaurant = jest.spyOn(restaurantHooks, &quot;useRestaurant&quot;)
  })

  const mockRestaurantData = {
    data: {
      _id: &quot;1&quot;,
      name: &quot;Test Restaurant&quot;,
      slug: &quot;test-restaurant&quot;,
      images: {
        banner: &quot;banner.jpg&quot;,
        owner: &quot;owner.jpg&quot;,
        thumbnail: &quot;thumbnail.jpg&quot;,
      },
      menu: {
        dinner: [{ name: &quot;yum&quot;, price: 1 }],
        lunch: [{ name: &quot;snack&quot;, price: 2 }],
      },
      coordinate: { latitude: 0, longitude: 0 },
    },
    isPending: false,
    error: undefined,
  }

  it(&quot;renders&quot;, () =&gt; {
    useRestaurant.mockReturnValue(mockRestaurantData)

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantDetails route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(&quot;Test Restaurant&quot;)).toBeOnTheScreen()
  })

  it(&quot;renders before data loads&quot;, () =&gt; {
    useRestaurant.mockReturnValue({ ...mockRestaurantData, data: undefined })
    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantDetails route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(&quot;Place an order&quot;)).toBeOnTheScreen()
  })

  it(&quot;renders loading state&quot;, () =&gt; {
    useRestaurant.mockReturnValue({
      data: undefined,
      isPending: true,
      error: undefined,
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantDetails route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(screen.getByText(/Loading/i)).toBeOnTheScreen()
  })

  it(&quot;renders error state&quot;, () =&gt; {
    useRestaurant.mockReturnValue({
      data: undefined,
      isPending: false,
      error: { name: &quot;Error&quot;, message: &quot;Mock error&quot; },
    })

    render(
      &lt;NavigationContainer&gt;
        {/* @ts-ignore */}
        &lt;RestaurantDetails route={route} /&gt;
      &lt;/NavigationContainer&gt;,
    )

    expect(
      screen.getByText(/Error loading restaurant details:/i, {
        exact: false,
      }),
    ).toBeOnTheScreen()
    expect(screen.getByText(/Mock error/i)).toBeOnTheScreen()
  })
})

</code></pre>
 <div line-highlight="1,4,8-22,36,38-43,46-64,67,69-74,76-77,79-86,88-89,91-96,98-103,105-106,108-113,115-120,122-128,only"></div>
<h3>Exercise 4</h3>
<ul>
<li>Fill in <code>useRestaurant</code> Hook for fetching the details of the restaurant.</li>
<li>Fill in <code>useRestaurants</code> Hook for fetching the list of restaurants.</li>
<li>Update <code>RestaurantDetails.tsx</code> to use our new <code>useRestaurants</code> Hook.</li>
<li>Update <code>RestaurantList.tsx</code> to use our new <code>useRestaurants</code> Hook.</li>
</ul>
<p><strong>Hint:</strong> The <code>useRestaurant()</code> Hook should make a request like this: <code>'/restaurants/${slug}'</code></p>
<p><strong>Hint:</strong> The <code>useRestaurants()</code> Hook should make a request with these query parameters: <code>'/restaurants?filter[address.state]=IL&amp;filter[address.city]=Chicago'</code></p>
<h3>Solution 4</h3>
<p>If you’ve implemented the solution correctly, the tests will pass when you run <code>npm run test</code>!</p>
<p><details>
<summary>Click to see the solution</summary></p>
<p>✏️ Update <strong>src/services/pmo/restaurant/hooks.ts</strong> to be:</p>
<pre><code class="language-ts">import { useEffect, useState } from &quot;react&quot;

import { apiRequest } from &quot;../api/api&quot;

import { City, Restaurant, State } from &quot;./interfaces&quot;

interface CitiesResponse {
  data: City[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseCitiesParams {
  state?: string
}
interface RestaurantResponse {
  data: Restaurant | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseRestaurant {
  slug: string
}

interface RestaurantsResponse {
  data: Restaurant[] | undefined
  error: Error | undefined
  isPending: boolean
}

interface UseRestaurants {
  state: string
  city: string
}

interface StatesResponse {
  data: State[] | undefined
  error: Error | undefined
  isPending: boolean
}

export function useCities({ state }: UseCitiesParams): CitiesResponse {
  const [response, setResponse] = useState&lt;CitiesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const { data, error } = await apiRequest&lt;CitiesResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/cities&quot;,
        params: {
          state: state,
        },
      })

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [state])

  return response
}

export function useRestaurant({ slug }: UseRestaurant): RestaurantResponse {
  const [response, setResponse] = useState&lt;RestaurantResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const { data, error } = await apiRequest&lt;RestaurantResponse&gt;({
        method: &quot;GET&quot;,
        path: `/restaurants/${slug}`,
      })

      setResponse({
        data: data &amp;&amp; &quot;data&quot; in data ? data.data : data || undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [slug])

  return response
}

export function useRestaurants({
  state,
  city,
}: UseRestaurants): RestaurantsResponse {
  const [response, setResponse] = useState&lt;RestaurantsResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      const { data, error } = await apiRequest&lt;RestaurantsResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/restaurants&quot;,
        params: {
          &quot;filter[address.state]&quot;: state,
          &quot;filter[address.city]&quot;: city,
        },
      })

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [state, city])

  return response
}

export function useStates(): StatesResponse {
  const [response, setResponse] = useState&lt;StatesResponse&gt;({
    data: undefined,
    error: undefined,
    isPending: true,
  })

  useEffect(() =&gt; {
    const fetchData = async () =&gt; {
      setResponse({
        data: undefined,
        error: undefined,
        isPending: true,
      })

      const { data, error } = await apiRequest&lt;StatesResponse&gt;({
        method: &quot;GET&quot;,
        path: &quot;/states&quot;,
      })

      setResponse({
        data: Array.isArray(data) ? data : data?.data ?? undefined,
        error: error,
        isPending: false,
      })
    }
    fetchData()
  }, [])

  return response
}

</code></pre>
 <div line-highlight="73,81,83,87,93,102-106,108-116,120-126,128,133-136,138-140,144,147,149,151-157,160,only"></div>
<p>✏️ Update <strong>src/screens/RestaurantList/RestaurantList.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { StackScreenProps } from &quot;@react-navigation/stack&quot;
import { FlatList } from &quot;react-native&quot;

import { RestaurantsStackParamList } from &quot;../../App&quot;
import Loading from &quot;../../components/Loading&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useRestaurants } from &quot;../../services/pmo/restaurant&quot;

export interface RestaurantListProps
  extends StackScreenProps&lt;RestaurantsStackParamList, &quot;RestaurantList&quot;&gt; {}

const RestaurantList: React.FC&lt;RestaurantListProps&gt; = ({ route }) =&gt; {
  const navigation = useNavigation()

  const { state, city } = route.params
  const {
    data: restaurants,
    error,
    isPending,
  } = useRestaurants({ state: state.short, city: city.name })

  if (error) {
    return (
      &lt;Screen&gt;
        &lt;Box padding=&quot;m&quot;&gt;
          &lt;Typography variant=&quot;heading&quot;&gt;Error loading restaurants: &lt;/Typography&gt;
          &lt;Typography variant=&quot;body&quot;&gt;{error.message}&lt;/Typography&gt;
        &lt;/Box&gt;
      &lt;/Screen&gt;
    )
  }

  if (isPending) {
    return &lt;Loading /&gt;
  }

  return (
    &lt;Screen noScroll&gt;
      &lt;FlatList
        data={restaurants}
        renderItem={({ item: restaurant }) =&gt; (
          &lt;Button
            onPress={() =&gt; {
              navigation.navigate(&quot;RestaurantDetails&quot;, {
                slug: restaurant.slug,
              })
            }}
          &gt;
            {restaurant.name}
          &lt;/Button&gt;
        )}
        keyExtractor={(item) =&gt; item._id}
      /&gt;
    &lt;/Screen&gt;
  )
}

export default RestaurantList

</code></pre>
 <div line-highlight="19-24,26-35,37-39,only"></div>
<p>✏️ Update <strong>src/screens/RestaurantDetails/RestaurantDetails.tsx</strong> to be:</p>
<pre><code class="language-tsx">import { useNavigation } from &quot;@react-navigation/native&quot;
import { StackScreenProps } from &quot;@react-navigation/stack&quot;
import { useEffect } from &quot;react&quot;

import { RestaurantsStackParamList } from &quot;../../App&quot;
import Loading from &quot;../../components/Loading&quot;
import RestaurantHeader from &quot;../../components/RestaurantHeader&quot;
import Box from &quot;../../design/Box&quot;
import Button from &quot;../../design/Button&quot;
import Screen from &quot;../../design/Screen&quot;
import Typography from &quot;../../design/Typography&quot;
import { useRestaurant } from &quot;../../services/pmo/restaurant&quot;

export interface RestaurantDetailsProps
  extends StackScreenProps&lt;RestaurantsStackParamList, &quot;RestaurantDetails&quot;&gt; {}

const RestaurantDetails: React.FC&lt;RestaurantDetailsProps&gt; = ({ route }) =&gt; {
  const { slug } = route.params
  const navigation = useNavigation()
  const { data: restaurant, error, isPending } = useRestaurant({ slug })

  useEffect(() =&gt; {
    if (restaurant) {
      navigation.setOptions({ title: `${restaurant.name}` })
    }
  }, [restaurant, navigation])

  if (error) {
    return (
      &lt;Screen&gt;
        &lt;Box padding=&quot;m&quot;&gt;
          &lt;Typography variant=&quot;heading&quot;&gt;
            Error loading restaurant details:{&quot; &quot;}
          &lt;/Typography&gt;
          &lt;Typography variant=&quot;body&quot;&gt;{error.message}&lt;/Typography&gt;
        &lt;/Box&gt;
      &lt;/Screen&gt;
    )
  }

  if (isPending) {
    return &lt;Loading /&gt;
  }

  return (
    &lt;Screen&gt;
      &lt;RestaurantHeader restaurant={restaurant} /&gt;
      &lt;Button onPress={() =&gt; console.warn(&quot;Place an order&quot;)}&gt;
        Place an order
      &lt;/Button&gt;
    &lt;/Screen&gt;
  )
}

export default RestaurantDetails

</code></pre>
 <div line-highlight="18,20,22-26,28-39,41-43,only"></div>
<p></details></p>
<h2>Next steps</h2>
<p>Next, we will learn how to <a href="user-inputs.html" title="Use switch controls and inputs to collect information.">Handling User Inputs</a> in React Native applications.</p>

</section>

  			
  			<bit-prev-next class="footer" list-selector=".sidebar-left ul li.parent.expanded ul"></bit-prev-next>
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout discord">
          <h6>Get help</h6>
          <p>If you need <a href="https://discord.gg/J7ejFsZnJ4">help</a> with an exercise, please reach out to us on
             <a href="https://discord.gg/J7ejFsZnJ4">Discord</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com</a></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/react-native/13-making-http-requests/making-http-requests.md"},"description":"Learn about how to make `fetch` requests and render requested data in React Native components. \n","name":"learn-react-native/making-http-requests","title":"Making HTTP Requests","type":"page","parent":"learn-react-native","order":13,"outline":{"depth":2},"comment":" ","pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
  <div id="email-modal" role="dialog" aria-modal="true" aria-labelledby="dialog_label" style="display: none;">
    <div aria-hidden="true" class="email-modal-backdrop"></div>
    <div role="region" class="email-modal-content">
      <h2 id="dialog_label">Join the Bitovi Newsletter</h2>
      <p>
        Do you want to receive updates about new Bitovi Academy courses, Bitovi open source projects, and dev community news? If so, please provide your email. We won’t spam you or give it away for any reason!<br />
        <i style="font-size: 0.8rem;">By providing your email you agree to receive communications from Bitovi</i>
      </p>
      <div id="academy-hubspot-form-embed"></div>
      <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
      <button id="email-modal-close" title="dismiss"><img src="../static/img/close.svg" height="24" width="24"></button>
    </div>
  </div>
</body>
</html>
