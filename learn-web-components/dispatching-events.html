<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/web-components/10-custom-events/custom-events.md
	@page learn-web-components/dispatching-events
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Learn how to use custom events to provide information on the *state* of your component to parent elements. 
">
  <title>Bitovi Academy - Dispatching events</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
		
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="why-wc.html"
							title="Learn why web components might be a good choice for building your next widget.">
							Why Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="first-component.html"
							title="Build a &lt;my-greeting&gt; component to learn the APIs. It will be able to display a greeting, and receive a name parameter either from an attribute or a JavaScript property.">
							Our first component
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="templates.html"
							title="Learn how &lt;template&gt; can be used to create reusable DOM that can be cloned and used within your components.">
							Writing a template
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="map-view.html"
							title="Create a component to hold our Google map view.">
							Map View
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="bus-tracker-component.html"
							title="Build a more complex component that combines the usage of &lt;template&gt; and customElements, and sets up event listeners.">
							bus-tracker component
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="listing-routes.html"
							title="Fetch a list of bus routes from the CTA bus tracker API and add them to the .routes-list element.">
							Listing routes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="select-a-route.html"
							title="Learn how to use event listeners with a custom element to handle user interaction and update the DOM.">
							Selecting a route
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="display-markers.html"
							title="Learn how to listen to changes in properties on your custom elements and how to properly reflect back the property values to the outside world.">
							Display markers for vehicles
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="customize-header.html"
							title="Learn how to use CSS properties to customize the appearance within Shadow DOM.">
							Customize header styles
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="slotted-content.html"
							title="Use slot elements to allow more control over non-critical parts of your component.">
							Slotted content
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="dispatching-events.html"
							title="Learn how to use custom events to provide information on the state of your component to parent elements.">
							Dispatching events
						</a>
						
							

						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Dispatching events <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Learn how to use custom events to provide information on the <em>state</em> of your component to parent elements.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <h2>Overview</h2>
<p>In this part we will:</p>
<ul>
<li>Handle click events on the map markers.</li>
<li>Display the bus destination for selected markers.</li>
</ul>
<h2>Problem</h2>
<p>We want to display the bus destination for the selected marker. This should look similar to how the selected route is displayed as an overlay of the map, but float just below that one. When no routes or markers are selected it should be invisible; when it is clicked it should say <code>Vehicle: DESTINATION</code>, where destination can be gotten from the vehicle object that is used to construct the marker.</p>
<p><img src="../static/img/web-components/bt-display-vehicle.gif"
style="border: solid 1px black; max-width: 100%;"
title="Selecting a marker displays the vehicle associated with that marker." /></p>
<h2>Technical Requirements</h2>
<p>For displaying the selected vehicle use a <code>span</code> element and give it an <code>id</code> of <code>selected-vehicle</code>. It will have mostly the same styles as the selected route. You could use the same CSS but just modify it to work for both. For simplicity here's the full CSS needed:</p>
<pre><code class="language-css">#selected-vehicle:not(.vehicle-selected) {
  display: none;
}
.vehicle-selected {
  line-height: 1;
  position: absolute;
  z-index: 1;
  text-align: right;
  background: rgba(6, 6, 6, 0.6);
  top: 55px;
  font-size: 11px;
  right: 10px;
  padding: 6px 10px;
  color: white;
  border-radius: 2px;
  cursor: pointer;
}
.vehicle-selected small {
  display: block;
  font-size: 14px;
  color: #ddd;
}
</code></pre>
<p>Markers are not DOM elements and therefore don't have all of the same methods. To listen to events you use a slightly different mechanism:</p>
<pre><code class="language-js">marker.addListener('event-name', () =&gt; {
  // Do whatever
});
</code></pre>
<p>Where <code>event-name</code> is the event you're interested in.</p>
<h2>What You Need to Know</h2>
<ul>
<li>Using <code>CustomEvent</code> to create new event types.</li>
<li>Using the <code>detail</code> property to pass information about an event.</li>
<li>How to use <code>handleEvent</code> to listen to events in an easy way.</li>
<li>Using <code>connectedCallback</code> and <code>disconnectedCallback</code> together.</li>
</ul>
<h3>Custom events</h3>
<p>Custom elements can have events associated with them just like any other element. You can listen to events the same way as well; in our case we'll use <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">addEventListener</a>.</p>
<pre><code class="language-js">el.addEventListener('any-event', () =&gt; {
  // Handle this event just like you would any built-in.
});
</code></pre>
<p>To dispatch a <strong>custom event</strong> that contains data pertaining to the event, use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent">CustomEvent</a> constructor. With <code>CustomEvent</code> you can include a <code>detail</code> property. This can contain any sort of data about the event you want to provide. In our case we'll use the <strong>route</strong> object as the detail property.</p>
<p>Events are created using <code>let ev = new CustomEvent({ detail: {...} })</code>. This create an event object. To dispatch it, the element (in our case a custom element) has a <code>dispatchEvent(ev)</code> function that takes the new event.</p>
<pre><code class="language-js">let el = document.createElement('div');

el.addEventListener('favorite-food', ev =&gt; {
  console.log(ev.detail); // -&gt; &quot;pizza&quot;
});

let ev = new CustomEvent('favorite-food', {
  detail: 'pizza'
});
el.dispatchEvent(ev);
</code></pre>
<div class='codepen'></div>
<p>Events created this way do not <a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/bubbles">bubble</a> by default. This means that if you want to listen to events you must place the listener directly on the element from which the event is dispatched. You can enable bubbling by providing <code>{ bubbles: true }</code> when creating the event.</p>
<pre><code class="language-js">let ev = new CustomEvent('my-event', {
  bubbles: true
});
</code></pre>
<h3>Setting up and tearing down listeners</h3>
<p>Most of the time you want to delay setting up event listeners until <code>connectedCallback</code> is called. This is for a few different reasons:</p>
<ul>
<li>Most events deal with user interaction and the user can only interact with elements in the page.</li>
<li>Events can reference elements not contained within the element; for example an event might be placed on the <code>document</code>. This creates a memory leak where the element's memory can never be freed.</li>
</ul>
<p>Use <code>connectedCallback</code> to add event listeners and <code>disconnectedCallback</code> to remove them. disconnectedCallback is called when the element is removed from the page.</p>
<pre><code class="language-js">class MyElement extends HTMLElement {
  constructor() {
    super();

    this.attachShadow({ mode: 'open' });
    this.shadowRoot.append(document.import(template.content), true);

    this.onButtonClick = () =&gt; {
      // Do something when buttons are clicked.
    };
  }

  connectedCallback() {
    this.button = this.shadowRoot.querySelector('button');
    this.button.addEventListener('click', this.onButtonClick);
  }

  disconnectedCallback() {
    this.button.removeEventListener('click', this.onButtonClick);
  }
}
</code></pre>
<h3>handleEvent</h3>
<p>Most people are familiar with using <code>addEventListener</code> with a function like so:</p>
<pre><code class="language-js">element.addEventListener('click', callback);
</code></pre>
<p>In a custom element class you'll often want to call some method on your class when an event occurs, but that might not do what you expect:</p>
<pre><code class="language-js">class MyElement extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.append(document.import(template.content), true);

    this.button = this.shadowRoot.querySelector('button');
  }

  connectedCallback() {
    this.button.addEventListener('click', this.handleButtonClick);
  }

  handleButtonClick() {
    // Oh no! `this` is not what you expected.
  }
}
</code></pre>
<p>In the above example we are listening for when a button gets a <code>click</code> event and calling <code>this.handleButtonClick</code>. However this doesn't do what you expect; the <code>this</code> value when <code>handleButtonClick</code> is called will be the <em>button</em>, not your element.</p>
<p>You can fix this by using an arrow function instead (as shown in the previous section):</p>
<pre><code class="language-js">this.button.addEventListener('click', ev =&gt; this.handleButtonClick(ev));
</code></pre>
<p>However this creates a <em>new function</em>. To tear this down in <code>disconnectedCallback</code> you'll have to keep a reference to it.</p>
<p>A way to avoid this is to use <code>handleEvent</code>. <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventListener/handleEvent">handleEvent</a> is a special method you can add to any object (not just elements) that makes that object an <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget">EventTarget</a>. You use it like this:</p>
<pre><code class="language-js">var eventTarget = {
  handleEvent(ev) {
    // My `this` is correct!
  }
};

window.addEventListener('scroll', eventTarget);
</code></pre>
<p>Instead of passing a <strong>function</strong> to addEventListener you pass an object with a <code>handleEvent</code> method. This can work for custom elements to. Our previous example becomes:</p>
<pre><code class="language-js">class MyElement extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.append(document.import(template.content), true);

    this.button = this.shadowRoot.querySelector('button');
  }

  connectedCallback() {
    this.button.addEventListener('click', this);
  }

  disconnectedCallback() {
    this.button.addEventListener('click', this);
  }

  handleEvent(ev) {
    // Our `this` is correct and we can do whatever we need.
  }
}
</code></pre>
<p><code>handleEvent</code> is convenient when you only have a few events you're curious about, but when you have many events it can be difficult to differentiate between the events since they are all on the same method.</p>
<h2>Solution</h2>
<p>✏️ Add <code>&lt;span id=&quot;selected-vehicle&quot;&gt;&lt;/span&gt;</code> inside of the <code>footer</code> element below the button. In the <code>google-map-view</code> when creating markers add an event listeners to the markers click.</p>
<p>Using <code>CustomEvent</code>, display a <code>vehicle-selected</code> event with a <code>detail</code> of the vehicle. Now in the <code>bus-tracker</code> component, listen to event and set the vehicle destination on the <code>#selected-vehicle</code> element.</p>
<pre><code class="language-html">&lt;style&gt;
  html,
  body {
    height: 100%;
  }
  body {
    font-family: &quot;Catamaran&quot;, sans-serif;
    background-color: #f2f2f2;
    display: flex;
    flex-direction: column;
    margin: 0;
  }
  bus-tracker {
    --header-background: salmon;
    --header-text-transform: capitalize;
  }
  header[slot=header] {
    background: crimson;
    color: wheat;
    text-align: center;
  }
&lt;/style&gt;
&lt;script src=&quot;https://maps.googleapis.com/maps/api/js?key=AIzaSyD7POAQA-i16Vws48h4yRFVGBZzIExOAJI&quot;&gt;&lt;/script&gt;

&lt;bus-tracker&gt;
  &lt;header slot=&quot;header&quot;&gt;
    &lt;h1&gt;My Bus Tracker!&lt;/h1&gt;
  &lt;/header&gt;
&lt;/bus-tracker&gt;

&lt;template id=&quot;bt-template&quot;&gt;
  &lt;style&gt;
    :host {
      display: flex;
      flex-direction: column;
    }

    .top {
      flex-grow: 1;
      overflow-y: auto;
      height: 10%;
      display: flex;
      flex-direction: column;
    }

    footer {
      height: 250px;
      position: relative;
    }
    .gmap {
      width: 100%;
      height: 250px;
      background-color: grey;
    }

    header {
      box-shadow: 0px 3px 5px 0px rgba(0, 0, 0, 0.1);
      background-color: var(--header-background, #313131);
      color: white;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.2;
    }

    header h1 {
      text-align: center;
      font-size: 18px;
      text-transform: var(--header-text-transform, uppercase);
      letter-spacing: 1px;
      margin: 0;
    }
    #selected-route:not(.route-selected) {
      display: none;
    }
    .route-selected {
      line-height: 1;
      position: absolute;
      z-index: 1;
      text-align: right;
      background: rgba(6, 6, 6, 0.6);
      top: 10px;
      right: 10px;
      padding: 6px 10px;
      color: white;
      border-radius: 2px;
      cursor: pointer;
    }
    .route-selected small {
      display: block;
      font-size: 14px;
      color: #ddd;
    }
    .route-selected .error-message {
      font-size: 14px;
      background-color: #ff5722;
      border-radius: 10px;
      padding: 4px 8px 1px;
      margin-top: 5px;
    }
    #selected-vehicle:not(.vehicle-selected) {
      display: none;
    }
    .vehicle-selected {
      line-height: 1;
      position: absolute;
      z-index: 1;
      text-align: right;
      background: rgba(6, 6, 6, 0.6);
      top: 55px;
      font-size: 11px;
      right: 10px;
      padding: 6px 10px;
      color: white;
      border-radius: 2px;
      cursor: pointer;
    }
    .vehicle-selected small {
      display: block;
      font-size: 14px;
      color: #ddd;
    }
    .routes-list {
      padding: 20px 0;
      margin: 0;
      overflow-y: auto;
    }
    .routes-list li {
      list-style: none;
      cursor: pointer;
      background: white;
      border: 1px solid #dedede;
      margin: 1% 2%;
      border-radius: 25px;
      color: #2196f3;
      width: 41%;
      display: inline-flex;
      font-size: 14px;
      line-height: 1.2;
    }
    .routes-list li:hover {
      border-color: transparent;
      background-color: #008eff;
      color: white;
      box-shadow: 0px 5px 20px 0px rgba(0, 0, 0, 0.2);
    }
    .routes-list li .check {
      display: none;
    }
    .routes-list li.active {
      color: #666;
      background-color: #e8e8e8;
    }
    .routes-list li.active .check {
      display: inline-block;
      margin-left: 5px;
      color: #2cc532;
    }
    .routes-list li.active:hover {
      border-color: #dedede;
      box-shadow: none;
    }
    .routes-list button {
      width: 100%;
      padding: 8px 8px 6px;
      border: none;
      border-radius: 25px;
      background: transparent;
      text-align: left;
      font: inherit;
      color: inherit;
    }
    .route-number {
      display: inline-block;
      border-right: 1px solid #dedede;
      padding-right: 5px;
      margin-right: 5px;
      min-width: 18px;
      text-align: right;
    }
    p {
      text-align: center;
      margin: 0;
      color: #ccc;
      font-size: 14px;
    }
  &lt;/style&gt;
  &lt;div class=&quot;top&quot;&gt;
    &lt;slot name=&quot;header&quot;&gt;
      &lt;header&gt;
        &lt;h1&gt;Chicago CTA Bus Tracker&lt;/h1&gt;
        &lt;p id=&quot;loading-routes&quot;&gt;Loading routes…&lt;/p&gt;
      &lt;/header&gt;
    &lt;/slot&gt;

    &lt;ul class=&quot;routes-list&quot;&gt;&lt;/ul&gt;
  &lt;/div&gt;
  &lt;footer&gt;
    &lt;button id=&quot;selected-route&quot; type=&quot;button&quot;&gt;
    &lt;/button&gt;
    &lt;span id=&quot;selected-vehicle&quot;&gt;&lt;/span&gt;

    &lt;google-map-view&gt;&lt;/google-map-view&gt;
  &lt;/footer&gt;
&lt;/template&gt;
&lt;template id=&quot;error-template&quot;&gt;
  &lt;div class=&quot;error-message&quot;&gt;
    No vehicles available for this route
  &lt;/div&gt;
&lt;/template&gt;
&lt;template id=&quot;gmap-template&quot;&gt;
  &lt;style&gt;
    .gmap {
      width: 100%;
      height: 250px;
      background-color: grey;
    }
  &lt;/style&gt;
  &lt;div class=&quot;gmap&quot;&gt;&lt;/div&gt;
&lt;/template&gt;
&lt;template id=&quot;route-template&quot;&gt;
  &lt;li&gt;
    &lt;button type=&quot;button&quot;&gt;
      &lt;span class=&quot;route-number&quot;&gt;&lt;/span&gt;
      &lt;span class=&quot;route-name&quot;&gt;&lt;/span&gt;
      &lt;span class=&quot;check&quot;&gt;✔&lt;/span&gt;
    &lt;/button&gt;
  &lt;/li&gt;
&lt;/template&gt;
&lt;script type=&quot;module&quot;&gt;
const template = document.querySelector('#gmap-template');

class GoogleMapView extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });

    let nodes = document.importNode(template.content, true);
    this.shadowRoot.append(nodes);

    this.markers = null;
    this._vehicles = null;
  }

  connectedCallback() {
    let gmap = this.shadowRoot.querySelector('.gmap');
    this.map = new google.maps.Map(gmap, {
      zoom: 10,
      center: {
        lat: 41.881,
        lng: -87.623
      }
    });
  }

  get vehicles() {
    return this._vehicles;
  }

  set vehicles(newVehicles) {
    this._vehicles = newVehicles;
    if (Array.isArray(this.markers)) {
      this.markers.forEach(marker =&gt; {
        marker.setMap(null);
      });
      this.markers = null;
    }
    if (newVehicles) {
      this.markers = newVehicles.map(vehicle =&gt; {
        let marker = new google.maps.Marker({
          position: {
            lat: parseFloat(vehicle.lat),
            lng: parseFloat(vehicle.lon)
          },
          map: this.map
        });

        marker.addListener('click', () =&gt; {
          this.dispatchVehicle(vehicle);
        });

        return marker;
      });
    }
  }

  dispatchVehicle(vehicle) {
    let event = new CustomEvent('vehicle-selected', {
      detail: vehicle
    });
    this.dispatchEvent(event);
  }
}

customElements.define('google-map-view', GoogleMapView);

const proxyUrl = &quot;https://can-cors.herokuapp.com/&quot;;
const token = &quot;?key=piRYHjJ5D2Am39C9MxduHgRZc&amp;format=json&quot;;
const apiRoot = &quot;http://www.ctabustracker.com/bustime/api/v2/&quot;;
const getRoutesEndpoint = apiRoot + &quot;getroutes&quot; + token;
const getVehiclesEndpoint = apiRoot + &quot;getvehicles&quot; + token;

const btTemplate = document.querySelector('#bt-template');
const routeTemplate = document.querySelector('#route-template');
const errorTemplate = document.querySelector('#error-template');

class BusTracker extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: &quot;open&quot; });

    let frag = document.importNode(btTemplate.content, true);
    this.shadowRoot.append(frag);

    this.routesList = this.shadowRoot.querySelector('.routes-list');
    this.selectedRouteBtn = this.shadowRoot.querySelector('#selected-route');
    this.googleMapView = this.shadowRoot.querySelector('google-map-view');
    this.selectedVehicle = this.shadowRoot.querySelector('#selected-vehicle');
  }

  connectedCallback() {
    this.getRoutes();

    this.googleMapView.addEventListener('vehicle-selected', this);
  }

  disconnectedCallback() {
    this.googleMapView.removeEventListener('vehicle-selected', this);
  }

  handleEvent(ev) {
    let vehicle = ev.detail;
    this.selectedVehicle.innerHTML = `&lt;small&gt;Vehicle:&lt;/small&gt; ${vehicle.des}`;
    this.selectedVehicle.classList.add('vehicle-selected');
  }

  async getRoutes() {
    let response = await fetch(proxyUrl + getRoutesEndpoint);
    let data = await response.json();
    let routes = data[&quot;bustime-response&quot;].routes;

    for(let route of routes) {
      let frag = document.importNode(routeTemplate.content, true);

      frag.querySelector('.route-number').textContent = route.rt;
      frag.querySelector('.route-name').textContent = route.rtnm;

      frag.querySelector('button').addEventListener('click', ev =&gt; {
        this.pickRoute(route, ev.currentTarget.parentNode);
      });

      this.routesList.append(frag);
    }

    this.shadowRoot.querySelector('#loading-routes').remove();
  }

  async getVehicles(route) {
    let response = await fetch(proxyUrl + getVehiclesEndpoint + '&amp;rt=' + route.rt);
    let data = await response.json();

    this.selectedRouteBtn.innerHTML = `
      &lt;small&gt;Route ${this.route.rt}:&lt;/small&gt; ${this.route.rtnm}
    `;

    if (data['bustime-response'].error) {
      let frag = document.importNode(errorTemplate.content, true);
      this.selectedRouteBtn.append(frag);
      this.googleMapView.vehicles = [];
    } else {
      let vehicles = data['bustime-response'].vehicle;
      this.googleMapView.vehicles = vehicles;
    }

    this.selectedRouteBtn.classList.add('route-selected');
  }

  pickRoute(route, li) {
    this.route = route;
    this.getVehicles(route);

    if(this.activeRoute) {
      this.activeRoute.classList.remove('active');
    }
    this.activeRoute = li;
    this.activeRoute.classList.add('active');
  }
}

customElements.define(&quot;bus-tracker&quot;, BusTracker);
&lt;/script&gt;

</code></pre>
<div line-highlight='102-123,202,270,279-283,288-293,319,325,328-330,332-336,only'></div>
<div class='codepen'></div>

</section>

  			
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout slack">
          <h6>Get help</h6>
          <p>If you need <a href="https://join.slack.com/t/bitovi-community/shared_invite/enQtNTIzMTE5NzYxMjA3LWMwMzE4MjFkMTI5ZmZjNzllYjc2MzcxOWNmOTg3YjI4NjE0MGFkZGNkOTNlZjlkNDBhNTlmYTcwMzJlZDZjY2Y">help</a> with an exercise, please reach out to us on
             <a href="https://join.slack.com/t/bitovi-community/shared_invite/enQtNTIzMTE5NzYxMjA3LWMwMzE4MjFkMTI5ZmZjNzllYjc2MzcxOWNmOTg3YjI4NjE0MGFkZGNkOTNlZjlkNDBhNTlmYTcwMzJlZDZjY2Y">Slack</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com<a/></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/web-components/10-custom-events/custom-events.md"},"description":"Learn how to use custom events to provide information on the *state* of your component to parent elements. \n","name":"learn-web-components/dispatching-events","title":"Dispatching events","type":"page","parent":"learn-web-components","order":10,"comment":" ","codepen":[["\"can\"","\"//unpkg.com/can@5/core.mjs\""],["\"can/everything\"","\"//unpkg.com/can@5/everything.mjs\""]],"pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
</body>
</html>
