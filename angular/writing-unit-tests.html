<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE â€” ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/angular/11-writing-unit-tests/writing-unit-tests.md
	@page angular/writing-unit-tests
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Bitovi University - Writing Unit Tests</title>
	
	<link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
	
</head>

<body>
	<header></header>
	<div class="content">
	
		<nav class="sidebar">
	
		
			<ul>
				<li class="">
					<a class="home" href="../index.html" title="Home">
						Home
					</a>
				</li>
			</ul>
		
		
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../advanced-javascript-training.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../dom-jquery-training.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../debugging-javascript-training.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../react.html"
							title="This guide introduces React, the things you should learn before approaching React, and some advanced React topics.">
							React
						</a>
						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../RxJS.html"
							title="Learn RxJS by creating a validating credit card form.">
							RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../angular.html"
							title="Learn the basics of Angular.">
							Angular
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="why-angular.html"
							title="Why Angular is a great choice for modern web application development.">
							Why Angular
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-our-first-app.html"
							title="Building Our First App">
							Building Our First App
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-components.html"
							title="Creating Our First Components">
							Creating Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="adding-routing.html"
							title="Adding Routing">
							Adding Routing
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="creating-navigation.html"
							title="Creating Navigation">
							Creating Navigation
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="restaurant-service.html"
							title="Writing a Restaurant Service">
							Writing a Restaurant Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="pull-restaurant-data-into-view.html"
							title="Pulling Restaurant Data into Our View">
							Use Restaurant API data
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="state-city-options.html"
							title="Creating city &amp; state options for filtering restaurants">
							City &amp; State Options
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="form-value-changes.html"
							title="Listening to Form Value Changes">
							Listening to Form Value Changes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="updating-service-params.html"
							title="Updating Restaurant Service to use params">
							Filtering Cities &amp; Restaurants
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="writing-unit-tests.html"
							title="Write a service unit test">
							Writing Unit Tests
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="nested-routes.html"
							title="Creating nested restaurant routes">
							Nested Restaurant Routes
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="building-order-form.html"
							title="Building the Order Form">
							Building the Order Form
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-service.html"
							title="Writing the Order Service">
							Order Service
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="order-history-component.html"
							title="Writing the Order History Component">
							Order History Component
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="real-time-connection.html"
							title="Updating Order History View with Real Time Connection">
							Real Time Connections
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="deploy-app.html"
							title="Deploying App">
							Deploy App
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
	</ul>


	
</nav>

	
	<article class="main">
		
			<section class="title">
	<h1>Writing Unit Tests <code>page</code></h1>
</section>

		

		
			
				<section class="description">
    <p>Write a service unit test</p>

</section>

			
		

		
			
				
			
			
				<section class="body">
    <h2>Overview</h2>
<p>In this part, we will:</p>
<ul>
<li>Get our existing tests to pass</li>
<li>Run our tests</li>
<li>Write a test to get cities and states</li>
</ul>
<h2>Get our unit tests to work again</h2>
<p>Update the following three files:</p>
<ol>
<li><strong>src/app/app.component.spec.ts</strong></li>
</ol>
<pre><code class="language-ts">import { TestBed, async } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';
import { AppComponent } from './app.component';

describe('AppComponent', () =&gt; {
  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      imports: [
        RouterTestingModule
      ],
      declarations: [
        AppComponent
      ],
    }).compileComponents();
  }));

  it('should create the app', () =&gt; {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.debugElement.componentInstance;
    expect(app).toBeTruthy();
  });

  it(`should have as title 'place-my-order'`, () =&gt; {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.debugElement.componentInstance;
    expect(app.title).toEqual('place-my-order');
  });

  it('should render title in a h1 tag', () =&gt; {
    const fixture = TestBed.createComponent(AppComponent);
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    expect(compiled.querySelector('h1').textContent).toContain('place-my-order.com');
  });
});

</code></pre>
<ol start="2">
<li><strong>src/app/image-url.pipe.spec.ts</strong></li>
</ol>
<pre><code class="language-ts">import { ImageUrlPipe } from './image-url.pipe';

describe('ImageUrlPipe', () =&gt; {
  it('create an instance', () =&gt; {
    const pipe = new ImageUrlPipe();
    expect(pipe).toBeTruthy();
  });

  it('returns a string with proper assets path', () =&gt; {
    const pipe = new ImageUrlPipe();
    expect(pipe.transform('node_modules/place-my-order-assets/tacos.png')).toBe('./assets/tacos.png');
  })
});
</code></pre>
<ol start="3">
<li><strong>src/app/restaurant.component.spec.ts</strong></li>
</ol>
<pre><code class="language-ts">import { async, ComponentFixture, TestBed } from '@angular/core/testing';

import { RestaurantComponent } from './restaurant.component';
import { RestaurantService } from './restaurant.service';
import { ReactiveFormsModule } from '@angular/forms';
import { ImageUrlPipe } from '../image-url.pipe';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';

describe('RestaurantComponent', () =&gt; {
  let component: RestaurantComponent;
  let fixture: ComponentFixture&lt;RestaurantComponent&gt;;

  let fakeRestaurants = [{
    name: 'Burger Shack',
    slug: 'burger-shack',
    images: {},
    menu: [{
      name: 'fries',
      price: 3.99
    }],
    address: {},
    _id: '12233asdas11'
  }];

  class restaurantServiceStub {
    getRestaurants() {
      return fakeRestaurants
    }
    getStates() {
      return of({
        data: [
          {name: 'Missouri', short: 'MO'}
        ]
      })
    }
    getCities() {
      return of({
        data: [
          {name: 'Kansas City', state: 'MO', }
        ]
      })
    }
  }

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ RestaurantComponent, ImageUrlPipe ],
      imports: [ReactiveFormsModule, RouterTestingModule],
      providers: [
        {provide: RestaurantService, useClass: restaurantServiceStub } 
      ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(RestaurantComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});

</code></pre>
<h2>Run our tests</h2>
<p>Run the following in your terminal:</p>
<pre><code class="language-shell">ng test
</code></pre>
<h2>Exercise: Write restaurant service test</h2>
<p><strong>src/app/restaurant.service.spec.ts</strong></p>
<pre><code class="language-ts">import { TestBed } from '@angular/core/testing';

import { RestaurantService } from './restaurant.service';
import { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';

describe('RestaurantService', () =&gt; {
  let httpMock : HttpTestingController;
  let restaurantService: RestaurantService;

  beforeEach(() =&gt; TestBed.configureTestingModule({
    imports: [HttpClientTestingModule],
    providers: [
      RestaurantService
    ]
  }));

  beforeEach(() =&gt; {
    httpMock = TestBed.get(HttpTestingController);
    restaurantService = TestBed.get(RestaurantService);
  })

  it('should be created', () =&gt; {
    expect(restaurantService).toBeTruthy();
  });

  it('should make a get request to states', () =&gt; {
    const mockStates = {
      data: [
        {name: 'Missouri', short: 'MO'}
      ]
    };

    restaurantService.getStates().subscribe((states) =&gt; {
      expect(states).toEqual(mockStates);
    });

    let url = '/api/states';
    const req = httpMock.expectOne(url);

    expect(req.request.method).toEqual('GET');
    req.flush(mockStates);

    httpMock.verify();
  });

  it('should make a get request to cities', () =&gt; {
    const mockCities = {
      data: [
        {name: 'Kansas City', state: 'MO'}
      ]
    };

    restaurantService.getCities('MO').subscribe((cities) =&gt; {
      expect(cities).toEqual(mockCities);
    });

    let url = '/api/cities?state=MO';
    const req = httpMock.expectOne(url);
    expect(req.request.method).toEqual('GET');
    req.flush(mockCities);

    httpMock.verify();
  })


});

</code></pre>
<h2>Other tests to get working later</h2>
<p><strong>src/app/restaurant/detail/detail.component.spec.ts</strong></p>
<pre><code class="language-ts">import { async, ComponentFixture, TestBed } from '@angular/core/testing';

import { RestaurantDetailComponent } from './detail.component';
import { ImageUrlPipe } from 'src/app/image-url.pipe';
import { ActivatedRoute } from '@angular/router';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant.service';
import { RouterTestingModule } from '@angular/router/testing';

describe('RestaurantDetailComponent', () =&gt; {
  let component: RestaurantDetailComponent;
  let fixture: ComponentFixture&lt;RestaurantDetailComponent&gt;;

  let fakeRestaurants = [
    {&quot;name&quot;:&quot;Brunch Place&quot;,
    &quot;slug&quot;:&quot;brunch-place&quot;,
    &quot;images&quot;:{
      &quot;thumbnail&quot;:&quot;node_modules/place-my-order-assets/images/4-thumbnail.jpg&quot;,
      &quot;owner&quot;:&quot;node_modules/place-my-order-assets/images/2-owner.jpg&quot;,
      &quot;banner&quot;:&quot;node_modules/place-my-order-assets/images/2-banner.jpg&quot;},
      &quot;menu&quot;:{
        &quot;lunch&quot;:[
          {&quot;name&quot;:&quot;Ricotta Gnocchi&quot;,&quot;price&quot;:15.99},
          {&quot;name&quot;:&quot;Garlic Fries&quot;,&quot;price&quot;:15.99},
          {&quot;name&quot;:&quot;Charred Octopus&quot;,&quot;price&quot;:25.99}
        ],
        &quot;dinner&quot;:[
          {&quot;name&quot;:&quot;Steamed Mussels&quot;,&quot;price&quot;:21.99},
          {&quot;name&quot;:&quot;Roasted Salmon&quot;,&quot;price&quot;:23.99},
          {&quot;name&quot;:&quot;Crab Pancakes with Sorrel Syrup&quot;,&quot;price&quot;:35.99}
        ]
      },
      &quot;address&quot;:{
        &quot;street&quot;:&quot;2451 W Washburne Ave&quot;,
        &quot;city&quot;:&quot;Ann Arbor&quot;,&quot;state&quot;:&quot;MI&quot;,&quot;zip&quot;:&quot;53295&quot;},
        &quot;_id&quot;:&quot;xugqxQIX5rPJTLBv&quot;
      }
    ];

  class restaurantServiceStub {
    getRestaurant() {
      return of(fakeRestaurants[0])
    }
  }

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ RestaurantDetailComponent, ImageUrlPipe ],
      imports: [ RouterTestingModule ],
      providers: [
        { provide: RestaurantService, useClass: restaurantServiceStub },
        {
          provide: ActivatedRoute,
          useValue: {
            snapshot: {
              paramMap: {
                get() {
                  return of({slug: 'crab-palace'})
                }
              }
            }
          }
        }
      ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(RestaurantDetailComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});

</code></pre>
<p><strong>src/app/order/order.component.spec.ts</strong></p>
<pre><code class="language-ts">import { async, ComponentFixture, TestBed } from '@angular/core/testing';
import { NO_ERRORS_SCHEMA, forwardRef } from '@angular/core';

import { OrderComponent } from './order.component';
import { ReactiveFormsModule, NG_VALUE_ACCESSOR, FormBuilder } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { of } from 'rxjs';
import { RestaurantService } from '../restaurant/restaurant.service';
import { OrderService } from './order.service';
import { MenuItemsComponent } from './menu-items/menu-items.component';

describe('OrderComponent', () =&gt; {
  let component: OrderComponent;
  let fixture: ComponentFixture&lt;OrderComponent&gt;;

  class restaurantServiceStub {
    getRestaurant() {
      return of({
        name: 'crab palace', 
        menu: {
          lunch: [
            {
              name: 'tacos',
              price: 3.99
            }
          ],
          dinner: [
            {
              name: 'burrito',
              price: 7.99
            }
          ]
        }
      })
    }
  }

  class orderServiceStub {
    createOrder() {
      return of({
        name: 'hungry hungry hippo',
        items: [
          {
            name: 'tacos',
            price: 3.99
          }
        ]
      })
    }
  }

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ OrderComponent, MenuItemsComponent ],
      imports: [ ReactiveFormsModule, ],
      schemas: [ NO_ERRORS_SCHEMA ],
      providers: [
        {
          provide: ActivatedRoute,
          useValue: {
            snapshot: {
              paramMap: {
                get() {
                  return of({slug: 'crab-palace'})
                }
              }
            }
          }
        },
        { provide: RestaurantService, useClass: restaurantServiceStub },
        { provide: OrderService, useClass: orderServiceStub }
      ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(OrderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});

</code></pre>
<p><strong>src/app/order/order.service.spec.ts</strong></p>
<pre><code class="language-ts">import { TestBed } from '@angular/core/testing';

import { OrderService } from './order.service';
import { HttpClientTestingModule } from '@angular/common/http/testing';
import { HttpClient } from '@angular/common/http';

describe('OrderService', () =&gt; {
  beforeEach(() =&gt; TestBed.configureTestingModule({
    providers: [ {provide: HttpClient, useClass: HttpClientTestingModule} ]
  }));

  it('should be created', () =&gt; {
    const service: OrderService = TestBed.get(OrderService);
    expect(service).toBeTruthy();
  });
});

</code></pre>
<p><strong>src/app/order/history/history.component.spec.ts</strong></p>
<pre><code class="language-ts">import { async, ComponentFixture, TestBed } from '@angular/core/testing';
import { of } from 'rxjs'
import { HistoryComponent } from './history.component';
import { NO_ERRORS_SCHEMA } from '@angular/core';
import { OrderService } from '../order.service';

describe('HistoryComponent', () =&gt; {
  let component: HistoryComponent;
  let fixture: ComponentFixture&lt;HistoryComponent&gt;;

  let fakeOrders = {data: [
    {
      &quot;status&quot;: &quot;delivered&quot;,
      &quot;items&quot;: [
        {
          &quot;name&quot;: &quot;Truffle Noodles&quot;,
          &quot;price&quot;: 14.99
        },
        {
          &quot;name&quot;: &quot;Garlic Fries&quot;,
          &quot;price&quot;: 15.99
        },
        {
          &quot;name&quot;: &quot;Gunthorp Chicken&quot;,
          &quot;price&quot;: 21.99
        }
      ],
      &quot;name&quot;: &quot;Justin Meyer&quot;,
      &quot;address&quot;: &quot;3108 Winchester Ct.&quot;,
      &quot;slug&quot;: &quot;poutine-palace&quot;,
      &quot;_id&quot;: &quot;6spxPX078VcOcohU&quot;
    }
  ]};

  class orderServiceStub {
    getOrders() {
      return of(fakeOrders)
    }
  }

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ HistoryComponent ],
      schemas: [NO_ERRORS_SCHEMA],
      providers: [
        {provide: OrderService, useClass: orderServiceStub } 
      ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(HistoryComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});

</code></pre>
<p><strong>src/app/order/list/list.component.spec.ts</strong></p>
<pre><code class="language-ts">import { async, ComponentFixture, TestBed } from '@angular/core/testing';

import { ListComponent } from './list.component';
import { OrderService } from '../order.service';
import { of } from 'rxjs';

class orderServiceStub {
  updateOrder() {
    return of({data: 'updated'})
  }
  delete() {
    return of({data: 'deleted'})
  }
}

describe('ListComponent', () =&gt; {
  let component: ListComponent;
  let fixture: ComponentFixture&lt;ListComponent&gt;;

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ ListComponent ],
      providers: [
        {provide: OrderService, useClass: orderServiceStub}
      ]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(ListComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});

</code></pre>
<h2>Running Tests</h2>
<p>When using the angular cli, any new component, service, pipe, etc, will have a .spec file generated alongside it with a default &quot;this thing exists and can be initialized&quot; type test.</p>
<p>Tests are run from the command <code>npm test</code>.</p>
<h2>Testing Components</h2>
<p>Let's look at the base app component the angular cli created, <code>src/app/app.component.ts</code>. We made some changes to the markup of this component but never updated our tests. The test is currently failing, because it's expecting the h1 tag to contain &quot;PlaceMyOrder&quot;. At this point in our development, the h1 in the home page currently contains &quot;place-my-order.com&quot;, so let's update the test to expect that by changing the <code>src/app/app.component.spec.ts</code> file.</p>
<h2>Testing Components with Child Components</h2>
<pre><code class="language-typescript">import { async, ComponentFixture, TestBed } from '@angular/core/testing';

import { HistoryComponent } from './history.component';
import { NO_ERRORS_SCHEMA } from '@angular/core';

describe('HistoryComponent', () =&gt; {
  let component: HistoryComponent;
  let fixture: ComponentFixture&lt;HistoryComponent&gt;;

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ HistoryComponent ],
      schemas: [NO_ERRORS_SCHEMA]
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(HistoryComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});
</code></pre>
<h2>Testing Components with Services</h2>
<h2>Updating base passing tests</h2>
<p><details>
<summary>Click to view tests</summary></p>
<p></details></p>

</section>

			
		
	</article>
</div>

	<footer></footer>

	<script type="text/javascript">
		var docObject = {"src":{"path":"src/angular/11-writing-unit-tests/writing-unit-tests.md"},"description":"Write a service unit test \n","name":"angular/writing-unit-tests","title":"Writing Unit Tests","type":"page","parent":"angular","order":11,"comment":" ","pathToRoot":"../.."};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/bit-docs-site/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="bit-docs-site/static"
				src="../static/steal.production.js"></script>
	

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-29"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-2302003-29');
</script>

</body>

</html>
