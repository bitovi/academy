<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE â€” ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/docker/7-docker-compose/docker-compose.md
	@page learn-docker/docker-compose
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Make Docker easier to use and orchestrate multiple containers. 
">
  <title>Bitovi Academy - Docker Compose</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building a feature-rich Tic-Tac-Toe game in this beginner React guide. This hands-on course will introduce both fundamental and more advanced React concepts! By the end of this course, you will have mastered functional components, hooks, and component optimization.">
							Learn React
						</a>
						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a NodeJS app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="what-is-docker.html"
							title="Explore Docker concepts and architecture.">
							What is Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="build-node-app.html"
							title="Build a simple Express API to use for the rest of the course.">
							Build a NodeJS App
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="writing-a-dockerfile.html"
							title="Write a Dockerfile to containerize the NodeJS app.">
							Writing a Dockerfile
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="build-and-run-image.html"
							title="Build an image and run a container for our NodeJS app.">
							Build and Run An Image
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="volumes-and-local-development.html"
							title="Streamline local development with bind mounts.">
							Volumes and Local Development
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="production-readiness.html"
							title="Learn to reduce the size of docker images.">
							Production Readiness
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="docker-compose.html"
							title="Make Docker easier to use and orchestrate multiple containers.">
							Docker Compose
						</a>
						
							

						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to perform technology consulting.">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../advanced-typescript.html"
							title="This course covers advanced features of TypeScript.">
							Advanced TypeScript
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Docker Compose <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Make Docker easier to use and orchestrate multiple containers.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/HLPEIKVaZeE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2>Overview</h2>
<p>At this point, we are building our image with</p>
<pre><code class="language-bash">$ MY_ENV=dev
$ docker build -t my-node-app:$MY_ENV --target $MY_ENV .
</code></pre>
<p>and running it with</p>
<pre><code class="language-bash">$ MY_PORT=9000
$ docker run \
--name my-container \
-p 8000:$MY_PORT \
-e PORT=$MY_PORT \
-v &quot;$(pwd)&quot;/src:/app/src \
my-node-app:dev
</code></pre>
<p>That's a lot of typing and memorization to run a container. Docker compose condenses all of this into one command: <code>docker-compose up</code>.</p>
<h2>Docker Compose</h2>
<p>Docker Compose is a cli included with Docker that provides a declarative way to building and running multiple Docker containers. When Docker Compose manages a container, it is called a &quot;service&quot;.</p>
<p>Docker Compose reads a special file called <code>docker-compose.yml</code> that defines any number of services' port mappings, volumes, interdependencies and more. Docker Compose ensures containers are run in a consistent way without needing to type <code>docker build</code> and <code>docker run</code> along with numerous arguments into the console.</p>
<h2>Replacing docker run</h2>
<p>Instead of running</p>
<pre><code class="language-bash">$ MY_PORT=9000
$ docker run \
--name my-container \
-p 8000:$MY_PORT \
-e PORT=$MY_PORT \
-v &quot;$(pwd)&quot;/src:/app/src \
my-node-app:dev
</code></pre>
<p>we can capture all of these arguments in a <code>docker-compose.yml</code> file.</p>
<p>First create a <code>.env</code> file with the following content. <code>docker-compose</code> will automatically read these environment variables and allow us to use them throughout <code>docker-compose.yml</code>.</p>
<pre><code class="language-bash">MY_PORT=8000
MY_ENV=dev
</code></pre>
<p>Create a <code>docker-compose.yml</code> in the root of your application repo and paste the following content:</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  my-app:
    image: my-node-app:${MY_ENV}
    ports:
      - &quot;9000:${MY_PORT}&quot;
    volumes:
      - ./src:/app/src
    environment:
      PORT: ${MY_PORT}
</code></pre>
<p>Hopefully, this file is self-explanatory. It creates a service called &quot;my-app&quot; that creates an instance of our <code>my-node-app</code> image with the desired port mapping, volumes and environment variables defined.</p>
<p>Run <code>docker-compose up</code> and watch the magic.</p>
<pre><code class="language-bash">$ docker-compose up
Starting nodeapp_my-app_1 ... done
Attaching to nodeapp_my-app_1
my-app_1  | 
my-app_1  | &gt; bitovi-academy-app@1.0.0 start
my-app_1  | &gt; nodemon src/index.js
my-app_1  | 
my-app_1  | [nodemon] 2.0.6
my-app_1  | [nodemon] to restart at any time, enter `rs`
my-app_1  | [nodemon] watching path(s): *.*
my-app_1  | [nodemon] watching extensions: js,mjs,json
my-app_1  | [nodemon] starting `node src/index.js`
my-app_1  | Example app listening at http://localhost:8000
</code></pre>
<p>You can press <code>ctrl+c</code> or run <code>docker-compose down</code> from a separate tab to kill your container(s).</p>
<h2>Replacing docker build</h2>
<p>Now that we've replaced <code>docker run</code> with <code>docker-compose up</code>, Let's update <code>docker-compose.yml</code> to allow Docker Compose to manage builds too.</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  my-app:
    build:
        context: .
        target: ${MY_ENV}
    image: my-node-app:${MY_ENV}
    ports:
      - &quot;9000:${MY_PORT}&quot;
    volumes:
      - ./src:/app/src
    environment:
      PORT: ${MY_PORT}
</code></pre>
<p>We've added a <code>build</code> section to our <code>my-app</code> service.</p>
<ul>
<li><code>context: .</code> tells Docker Compose where to find the Dockerfile</li>
<li><code>target: ${MY_ENV}</code> tells Docker to build either a dev or prod image
Run <code>docker-compose build</code> to build a fresh copy of <code>my-node-app</code>.</li>
</ul>
<h2>Customizing Behaviour</h2>
<p>Now we can control how our image is built and run from <code>.env</code>.</p>
<p>Changing <code>MY_ENV=dev</code> to <code>MY_ENV=prod</code> will cause <code>docker-compose up</code> to create a container in the production mode. If an image does not exist, <code>docker-compose up</code> will automatically run <code>docker-compose build</code> for us!</p>
<h2>Let's add more containers!</h2>
<p>Let's add a MySQL database and ensure it is running before starting the <code>my-app</code> service.</p>
<p>We'll use the <code>mysql:5.7</code> image from <a href="https://hub.docker.com/_/mysql">Dockerhub</a>.</p>
<h3>.env</h3>
<p>The Dockerhub page specifies several required environment variables to pass in to the container. We'll add these to <code>.env</code></p>
<pre><code class="language-yaml"># My App
MY_ENV=prod
MY_PORT=8000

# MySQL
MYSQL_ROOT_PASSWORD=S3cure!
MYSQL_DATABASE=my_db
MYSQL_USER=my_user
MYSQL_PASSWORD=S3cure!_user
</code></pre>
<h3>docker-compose.yml</h3>
<p>The <code>db</code> service we're adding below should be intuitive based on what's been covered so far. The exception is the <code>volumes:</code> section.</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  my-app:
    build:
        context: .
        target: ${MY_ENV}
    image: my-node-app:${MY_ENV}
    ports:
      - &quot;9000:${MY_PORT}&quot;
    volumes:
      - ./src:/app/src
    environment:
      PORT: ${MY_PORT}
    depends_on: 
      - db
  db:
     image: mysql:5.7
     volumes:
       - db_data:/var/lib/mysql
     environment:
       MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
       MYSQL_DATABASE: ${MYSQL_DATABASE}
       MYSQL_USER: ${MYSQL_USER}
       MYSQL_PASSWORD: ${MYSQL_PASSWORD}
volumes:
    db_data: {}
</code></pre>
<h4>Volumes</h4>
<p>As mentioned in [volumes-and-local-development](Volumes and Local Development), volumes are used to persist state outside container creation and destruction.</p>
<p>We are creating a volume called <code>db_data</code>. Docker Compose <a href="https://docs.docker.com/compose/compose-file/#volumes">documentation</a> specifies configuration parameters available when declaring a volume, but more often than not, it is sufficient to use the default configuration as shown below:</p>
<pre><code>volumes:
    db_data: {}
</code></pre>
<p>Lastly, we use the volume as the <code>&lt;src&gt;</code> side of the <code>volumes</code> block of the <code>db</code> service. This ensures the contents of <code>/var/lib/mysql</code> are saved to the <code>db_data</code> volume preventing data loss on container destruction and restarts.</p>
<pre><code>volumes:
- db_data:/var/lib/mysql
</code></pre>
<h3>Test</h3>
<p>Finally, let's start everything up</p>
<pre><code class="language-bash">$ docker-compose up
Creating network &quot;nodeapp_default&quot; with the default driver
Creating nodeapp_db_1 ... done
Creating nodeapp_my-app_1 ... done
Attaching to nodeapp_db_1, nodeapp_my-app_1
...
my-app_1  | 
my-app_1  | &gt; bitovi-academy-app@1.0.0 start:prod
my-app_1  | &gt; node src/index.js
my-app_1  | 
db_1      | 2020-11-24T20:43:30.390198Z 0 [Note] Event Scheduler: Loaded 0 events
db_1      | 2020-11-24T20:43:30.390526Z 0 [Note] mysqld: ready for connections.
db_1      | Version: '5.7.32'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server (GPL)
my-app_1  | Example app listening at http://localhost:8000
</code></pre>
<h2>Review</h2>
<p>This course has taken you through Docker fundamentals and has only scratched the surface of container orchestration. Docker Compose has a large list of commands (<code>docker-compose --help</code>) and an extensive <a href="https://docs.docker.com/compose/compose-file">compose file reference</a> for all your container needs. It could be an entire course in itself.</p>
<p>I hope this course has whet your appetite on containers and orchestration. What do you want to see next? Kubernetes? AWS? Load Testing? CI/CD? <a href="https://github.com/bitovi/academy/issues">Let us know</a>!</p>

</section>

  			
  			<bit-prev-next class="footer" list-selector=".sidebar-left ul li.parent.expanded ul"></bit-prev-next>
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout slack">
          <h6>Get help</h6>
          <p>If you need <a href="https://www.bitovi.com/community/slack">help</a> with an exercise, please reach out to us on
             <a href="https://www.bitovi.com/community/slack">Slack</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com</a></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/docker/7-docker-compose/docker-compose.md"},"description":"Make Docker easier to use and orchestrate multiple containers. \n","name":"learn-docker/docker-compose","title":"Docker Compose","type":"page","parent":"learn-docker","order":7,"comment":" ","pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
  <div id="email-modal" style="display: none;">
    <div aria-hidden="true" class="email-modal-backdrop"></div>
    <div role="region" class="email-modal-content">
      <h2>Join the Bitovi Newsletter</h2>
      <p>
        To start the course, please provide an email.<br />
        <i style="font-size: 0.8rem;">By providing your email you agree to receive communications from Bitovi</i>
      </p>
      <div id="academy-hubspot-form-embed"></div>
      <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
    </div>
  </div>
</body>
</html>
