<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: src/docker/3-writing-a-dockerfile/writing-a-dockerfile.md
	@page learn-docker/writing-a-dockerfile
######################################################################## -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="UMCgjrWAjJW_tHmYo6AerdZvVdmh8QHdY9Ywb59tpHw" />
  <meta name="description" content="Write a Dockerfile to containerize the NodeJS app. 
">
  <title>Bitovi Academy - Writing a Dockerfile</title>
  
  <link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
  
</head>

<body>
  <div class="header">
    <div class="logo">
      <a href="https://www.bitovi.com/">Bitovi</a>
    </div>
    <ul>
      <li><a href="https://www.bitovi.com/services">Services</a></li>
      <li><a href="https://www.bitovi.com/client-work">Client Work</a></li>
      <li><a href="https://www.bitovi.com/about">Our Team</a></li>
      <li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
      <li><a href="https://www.bitovi.com/blog">Blog</a></li>
      <li><a href=".." class="active">Academy</a></li>
     </ul>
     <a class="contact-popup hs-button brand button-smallest" href="https://www.bitovi.com/contact">Contact Us</a>
  </div>

  <div class="content">
	
		<div class="sidebar-left">
  
    
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-advanced-javascript.html"
							title="This course covers all the hard but important stuff you should know when learning JavaScript.">
							Advanced JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-dom-jquery.html"
							title="Learn jQuery and the DOM APIs by building your own version of jQuery and using it to make a basic tabs widget.">
							DOM and jQuery
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-to-debug-javascript.html"
							title="This course covers the basics of JavaScript debugging.">
							Debug JavaScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-typescript.html"
							title="This course covers the basic essentials of TypeScript. At the end, you should be ready to develop projects in TypeScript.">
							Learn TypeScript
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-react.html"
							title="Learn React by building a feature-rich Tic-Tac-Toe game in this beginner React guide. This hands-on course will introduce both fundamental and more advanced React concepts! By the end of this course, you will have mastered functional components, hooks, and component optimization.">
							Learn React
						</a>
						
					</li>
				
			
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-web-components.html"
							title="">
							Learn Web Components
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-rxjs.html"
							title="Learn RxJS by creating a validating credit card form.">
							Learn RxJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../learn-docker.html"
							title="Build and containerize a NodeJS app then orchestrate multiple containers with docker-compose in this Docker guide.">
							Learn Docker
						</a>
						
							
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="what-is-docker.html"
							title="Explore Docker concepts and architecture.">
							What is Docker
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="build-node-app.html"
							title="Build a simple Express API to use for the rest of the course.">
							Build a NodeJS App
						</a>
						
					</li>
				
			
		
			
				
					<li class="current
           						parent
           						expanded">
						<a class="page"
							href="writing-a-dockerfile.html"
							title="Write a Dockerfile to containerize the NodeJS app.">
							Writing a Dockerfile
						</a>
						
							

						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="build-and-run-image.html"
							title="Build an image and run a container for our NodeJS app.">
							Build and Run An Image
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="volumes-and-local-development.html"
							title="Streamline local development with bind mounts.">
							Volumes and Local Development
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="production-readiness.html"
							title="Learn to reduce the size of docker images.">
							Production Readiness
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="docker-compose.html"
							title="Make Docker easier to use and orchestrate multiple containers.">
							Docker Compose
						</a>
						
					</li>
				
			
		
	</ul>


						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../training.html"
							title="Learn how to prepare and give a training.">
							Giving a Training
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-technology-consulting.html"
							title="Learn how to perform technology consulting.">
							Learn Technology Consulting
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-canjs.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							Learn CanJS
						</a>
						
					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../learn-angular.html"
							title="Learn how to build a moderately complex application with Angular.">
							Learn Angular
						</a>
						
					</li>
				
			
		
	</ul>


  
  <p class="border">
      <a href="..#courses">View More Courses</a>
      <a class='bit-academy-fullscreen' title='fullscreen' href="javascript://">[ ]</a>
  </p>
</div>

	
	<article class="main">
    <div class="main-content">
  		
  			<section class="title">
	<h1>Writing a Dockerfile <code>page</code></h1>
</section>

  		

  		
  			
  				<section class="description">
    <p>Write a Dockerfile to containerize the NodeJS app.</p>

</section>

  			
  		

  		
  			
  				
  			
  			
  				<section class="body">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/LiAkpRc6z0Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2>Our Dockerfile</h2>
<p>Starting with the solution, the <code>Dockerfile</code> for our NodeJS app should look like this.</p>
<p>✏️ Copy and paste this to the root of your project and name the file <code>Dockerfile</code>:</p>
<pre><code class="language-dockerfile">FROM node:15

ARG PORT=8000
ENV PORT=$PORT

WORKDIR app
COPY src src
COPY package.json .

RUN npm install
EXPOSE $PORT
CMD npm start
</code></pre>
<p>Let's break down each line.</p>
<h2>FROM instruction</h2>
<p>The <code>FROM</code> instruction is the first line of any Dockerfile. It sets the base image to be used as a starting point for all other instructions. Using base images allows deferring:</p>
<ul>
<li>installation of a kernel and</li>
<li>installtion of low level packages</li>
</ul>
<p>to the provider of the base image.</p>
<p>In our case, We are using <code>node:15</code>. <code>node</code> specifies the name of the base image and <code>15</code> is a tag specifying the version of the image. This base image has the latest version of NodeJS 15 pre-installed, allowing the rest of the <code>Dockerfile</code> to focus on logic specific to our application. The <code>node:15</code> image also has a <code>Dockerfile</code> which means it also has a <code>FROM</code> instruction. <code>node:15</code> uses <a href="https://hub.docker.com/_/debian">Debian</a> as its base image. This layering of Docker images repeats until a Dockerfile uses <code>FROM scratch</code> as its base image.</p>
<p>By default, Docker will look for images  on <a href="https://hub.docker.com/">Dockerhub</a>. For example, the <code>node</code> image we are using is pulled from <a href="https://hub.docker.com/_/node">here</a>, but you can create your own base images and share them publicly or privately to Dockerhub or other package registries.</p>
<p><a href="https://docs.docker.com/engine/reference/builder/#from">Official Docs</a></p>
<h2>ARG instruction</h2>
<p>The <code>ARG</code> instruction is used to define variables that are only available during the image build process. The instruction follows the syntax <code>ARG &lt;name&gt; [=&lt;default value&gt;]</code>.</p>
<p>In our case, <code>ARG PORT=8000</code> is defining an argument called <code>PORT</code> with a default value of <code>8000</code>. It can be accessed in later instructions in the <code>Dockerfile</code> like a standard environment variable (<code>$PORT</code>) and overwritten during the build process with the <code>--build-arg</code> cli argument (<a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg">Docs</a>).</p>
<p><a href="https://docs.docker.com/engine/reference/builder/#arg">Official Docs</a></p>
<h2>ENV instruction</h2>
<p>The <code>ENV</code> instruction is used to define environment variables. Like <code>ARG</code>, it follows the syntax <code>ENV &lt;name&gt; [=&lt;default value&gt;]</code>. The difference between <code>ARG</code> and <code>ENV</code> is that variables defined with the <code>ENV</code> instruction can be used during the image build process and also when the container is running as standard environment variables. However, only <code>ARG</code> defined variables can be actually overwritten during the build process with the <code>--build-arg</code> cli argument. <code>ENV</code> can be overwritten at run time with the <code>-e</code> cli argument or an env file (<a href="https://docs.docker.com/engine/reference/run/#env-environment-variables">Docs</a>).</p>
<p>To give us the flexibility to set and use variables at build time and run time, we use both <code>ARG</code> and <code>ENV</code> instructions together:</p>
<pre><code class="language-dockerfile">ARG PORT=8000
ENV PORT=$PORT
</code></pre>
<h3>ARG vs ENV</h3>
<table>
   <tr>
      <th>Capability</th>
      <th>ARG</th>
      <th>ENV</th>
   </tr>
   <tr>
      <td>Set during build time</td>
      <td>&check;</td>
      <td>&cross;</td>
   </tr>
   <tr>
      <td>Set during run time</td>
      <td>&cross;</td>
      <td>&check;</td>
   </tr>
   <tr>
      <td>Use during build time</td>
      <td>&check;</td>
      <td>&check;</td>
   </tr>
   <tr>
      <td>Use during run time</td>
      <td>&cross;</td>
      <td>&check;</td>
   </tr>
   </table>
</table>
<p><a href="https://docs.docker.com/engine/reference/builder/#env">Official Docs</a></p>
<h2>WORKDIR instruction</h2>
<p>The <code>WORKDIR</code> instruction sets the working directory for any subsequent instructions. If the directory does not exist, it will be automatically created.</p>
<p>The <code>WORKDIR</code> instruction can be used multiple times.</p>
<pre><code class="language-dockerfile">WORKDIR x
WORKDIR y
WORKDIR z
RUN pwd
</code></pre>
<p>Will result in <code>RUN pwd</code> and any later instruction being run in the <code>/x/y/z/</code> directory.</p>
<p>In our case, <code>WORKDIR app</code> will create the <code>/app/</code> directory for us to copy our source code in to.</p>
<p><a href="https://docs.docker.com/engine/reference/builder/#workdir">Official Docs</a></p>
<h2>COPY instruction</h2>
<p>The <code>COPY</code> instruction follows the syntax <code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code>.</p>
<ul>
<li><code>--chown=&lt;user&gt;:&lt;group&gt;</code> allows setting the ownership of the target file or directory using <a href="https://linux.die.net/man/1/chown">chown</a>. This is only available to Linux based images</li>
<li><code>&lt;src&gt;...</code> specifies what file(s) or directories should be copied in to the docker image.
<ul>
<li>Each file/directory should be separated by a space (<code></code>)</li>
<li>Each entry supports wildcards and matching. For example: <code>COPY hom* .</code> Will match all files starting with &quot;hom&quot;</li>
</ul></li>
<li><code>&lt;dest&gt;</code> specifies where each src entry should be copied to in the docker image. <code>.</code> will put each entry in the <code>WORKDIR</code> or the root directory if no <code>WORKDIR</code> is specified.</li>
</ul>
<p>In our case, we have</p>
<pre><code class="language-dockerfile">WORKDIR app
COPY src src
COPY package.json .
</code></pre>
<p>This will result in our <code>src/</code> directory being copied to <code>/app/src/</code> and <code>package.json</code> file to <code>/app/package.json</code> within the image. Using two <code>COPY</code> instructions instead of one is just preference and has no functional difference one way or another.</p>
<p>There are more complex cases on when a trailing slash is required on a <code>&lt;src&gt;</code> or <code>&lt;dest&gt;</code> and how to handle whitespace. These advanced rules can be found in the official docs.</p>
<p><a href="https://docs.docker.com/engine/reference/builder/#copy">Official Docs</a></p>
<h2>RUN instruction</h2>
<p>The <code>RUN</code> instruction allows arbitrary commands to be run during build time.</p>
<p>In our case, we are using <code>RUN npm install</code> to install dependencies from the <code>package.json</code> file copied in to our image. As a reminder, <code>npm</code> is pre-installed as a part of our <code>node:15</code> base image.</p>
<p><a href="https://docs.docker.com/engine/reference/builder/#run">Official Docs</a></p>
<h2>EXPOSE instruction</h2>
<p><code>EXPOSE</code> specifies which ports the when running the container. Each port is separated by a space (<code></code>). By default the container listens using TCP, but UDP can be used by adding <code>/udp</code> after the port.</p>
<p>For example:</p>
<pre><code class="language-dockerfile">EXPOSE 80/udp
</code></pre>
<p>In our case, we want the port exposed by our container to match the port our application is running on (remember: <code>const port = process.env.PORT || 3000</code> in <code>src/index.js</code>), therefore, we are publishing the value of our <code>PORT</code> environment variable.</p>
<pre><code class="language-dockerfile">ARG PORT=8000
ENV PORT=$PORT
...
EXPOSE $PORT
</code></pre>
<p><code>EXPOSE</code> does not actually publish the port. When running the container with <code>docker run</code>, the <code>-p</code> flag needs to be used to access the port from your host machine. More on this in the next section.
<a href="https://docs.docker.com/engine/reference/builder/#expose">Official Docs</a></p>
<h2>CMD instruction</h2>
<p><code>CMD</code> is a special instruction. It is not run during build time like a <code>RUN</code> instruction. Instead, it is run at runtime. When the <code>CMD</code> instruction finishes, the docker container will be destroyed.</p>
<p>In our case, we are running our express server with <code>CMD npm start</code>. This will cause our container to run until a fatal error occurs or it is manually killed.</p>
<p><a href="https://docs.docker.com/engine/reference/builder/#cmd">Official Docs</a></p>
<h2>What's next</h2>
<p>That was a lot on Dockerfiles. Next we'll be looking at actually building and running our image!</p>

</section>

  			
  			<bit-prev-next class="footer" list-selector=".sidebar-left ul li.parent.expanded ul"></bit-prev-next>
  		
    </div>

    
      <div class="sidebar-right">
        <div class="content-nav on-this-page-container">
          <h6>On this page...</h6>
          <div class="list-items" id="scroll-toc">
            <bit-toc heading-container-selector="article.main" scroll-selector="#scroll-toc"></bit-toc>
          </div>
        </div>
        <div class="pullout slack">
          <h6>Get help</h6>
          <p>If you need <a href="https://www.bitovi.com/community/slack">help</a> with an exercise, please reach out to us on
             <a href="https://www.bitovi.com/community/slack">Slack</a></p>
        </div>
        <div class="pullout bug">
          <p>If you find a bug, please
             <a href="https://github.com/bitovi/academy/issues/new">create an issue</a> or email
             <a href="mailto:contact@bitovi.com?Subject=Training%20Suggestion" target="_blank">contact@bitovi.com<a/></p>
        </div>
      </div>
    

	</article>
</div>



  <footer></footer>

  <div id="scripts">
    <script type="text/javascript">
      var docObject = {"src":{"path":"src/docker/3-writing-a-dockerfile/writing-a-dockerfile.md"},"description":"Write a Dockerfile to containerize the NodeJS app. \n","name":"learn-docker/writing-a-dockerfile","title":"Writing a Dockerfile","type":"page","parent":"learn-docker","order":3,"comment":" ","pathToRoot":"../.."};
    </script>

    
      <script>
        steal = {
          instantiated: {
            "bundles/bit-docs-site/static.css!$css" : null
          }
        }
      </script>
      <script type='text/javascript'
          data-main="bit-docs-site/static"
          src="../static/steal.production.js"></script>
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2302003-12"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-2302003-12');
    </script>

  </div>
</body>
</html>
